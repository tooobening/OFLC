angular.module('gettext',[]);angular.module('gettext').constant('gettext',function(str){return str;});angular.module('gettext').service('translate',["gettextCatalog",function(gettextCatalog){return function(input,additionalScope,additionalContext){return gettextCatalog.getString(input,additionalScope,additionalContext);}}]);angular.module('gettext').service('translatePlural',["gettextCatalog",function(gettextCatalog){return function(count,string,stringPlural,additionalScope){return gettextCatalog.getPlural(count,string,stringPlural,additionalScope);}}]);angular.module('gettext').factory('gettextCatalog',["gettextPlurals","gettextFallbackLanguage","$http","$cacheFactory","$interpolate","$rootScope",function(gettextPlurals,gettextFallbackLanguage,$http,$cacheFactory,$interpolate,$rootScope){var catalog;var noContext='$$noContext';var test='<span id="test" title="test" class="tested">test</span>';var isHTMLModified=(angular.element('<span>'+test+'</span>').html()!==test);var prefixDebug=function(string){if(catalog.debug&&catalog.currentLanguage!==catalog.baseLanguage){return catalog.debugPrefix+string;}else{return string;}};var addTranslatedMarkers=function(string){if(catalog.showTranslatedMarkers){return catalog.translatedMarkerPrefix+string+catalog.translatedMarkerSuffix;}else{return string;}};function broadcastUpdated(){$rootScope.$broadcast('gettextLanguageChanged');}
catalog={debug:false,debugPrefix:'[MISSING]: ',showTranslatedMarkers:false,translatedMarkerPrefix:'[',translatedMarkerSuffix:']',strings:{},baseLanguage:'en',currentLanguage:'en',cache:$cacheFactory('strings'),setCurrentLanguage:function(lang){this.currentLanguage=lang;broadcastUpdated();},getCurrentLanguage:function(){return this.currentLanguage;},setStrings:function(language,strings){if(!this.strings[language]){this.strings[language]={};}
for(var key in strings){var val=strings[key];if(isHTMLModified){key=angular.element('<span>'+key+'</span>').html();}
if(angular.isString(val)||angular.isArray(val)){var obj={};obj[noContext]=val;val=obj;}
var defaultPlural=gettextPlurals(language,1);for(var context in val){var str=val[context];if(!angular.isArray(str)){val[context]=[];val[context][defaultPlural]=str;}}
this.strings[language][key]=val;}
broadcastUpdated();},getStringFormFor:function(language,string,n,context){if(!language){return null;}
var stringTable=this.strings[language]||{};var contexts=stringTable[string]||{};var plurals=contexts[context||noContext]||[];return plurals[gettextPlurals(language,n)];},getString:function(string,scope,context){var fallbackLanguage=gettextFallbackLanguage(this.currentLanguage);string=this.getStringFormFor(this.currentLanguage,string,1,context)||this.getStringFormFor(fallbackLanguage,string,1,context)||prefixDebug(string);string=scope?$interpolate(string)(scope):string;return addTranslatedMarkers(string);},getPlural:function(n,string,stringPlural,scope,context){var fallbackLanguage=gettextFallbackLanguage(this.currentLanguage);string=this.getStringFormFor(this.currentLanguage,string,n,context)||this.getStringFormFor(fallbackLanguage,string,n,context)||prefixDebug(n===1?string:stringPlural);if(scope){scope.$count=n;string=$interpolate(string)(scope);}
return addTranslatedMarkers(string);},loadRemote:function(url){return $http({method:'GET',url:url,cache:catalog.cache}).then(function(response){var data=response.data;for(var lang in data){catalog.setStrings(lang,data[lang]);}
return response;});}};return catalog;}]);angular.module('gettext').directive('translate',["gettextCatalog","$parse","$animate","$compile","$window","$sce",function(gettextCatalog,$parse,$animate,$compile,$window,$sce){var trim=(function(){if(!String.prototype.trim){return function(value){return(typeof value==='string')?value.replace(/^\s*/,'').replace(/\s*$/,''):value;};}
return function(value){return(typeof value==='string')?value.trim():value;};})();var compact=(function(){return function(value){if(typeof value!=='string'){return value;}
value=trim(value);value=value.replace("\n"," ");while(value.indexOf("  ")>-1){value=value.replace("  "," ");}
return value;};})();function assert(condition,missing,found){if(!condition){throw new Error('You should add a '+missing+' attribute whenever you add a '+found+' attribute.');}}
var msie=parseInt((/msie (\d+)/.exec($window.navigator.userAgent.toLowerCase())||[])[1],10);return{restrict:'AE',compile:function compile(element,attrs){assert(!attrs.translatePlural||attrs.translateN,'translate-n','translate-plural');assert(!attrs.translateN||attrs.translatePlural,'translate-plural','translate-n');var msgid,attrToTranslate;if(attrs.translate){attrToTranslate=attrs.$normalize(attrs.translate)
msgid=compact(attrs[attrToTranslate]);}else{msgid=compact(element.html());}
var translatePlural=$sce.getTrustedHtml(attrs.translatePlural);var translateContext=attrs.translateContext;if(msie<=8){if(msgid.slice(-13)==='<!--IE fix-->'){msgid=msgid.slice(0,-13);}}
return{post:function(scope,element,attrs){var countFn=$parse(attrs.translateN);var pluralScope=null;var linking=true;function update(){var translated;if(translatePlural){scope=pluralScope||(pluralScope=scope.$new());scope.$count=countFn(scope);translated=gettextCatalog.getPlural(scope.$count,msgid,translatePlural,null,translateContext);}else{translated=gettextCatalog.getString(msgid,null,translateContext);}
if(attrs.translate){if(element.attr(attrs.translate)===translated){return;}
element.attr(attrs.translate,translated);}else{var oldContents=element.contents();if(oldContents.length===0){return;}
if(translated===compact(oldContents.html())){if(linking){$compile(oldContents)(scope);}
return;}
var newWrapper=angular.element('<span>'+translated.replace(/{{( *)count\$( *)}}/,"{{$1$$count$2}}")+'</span>');$compile(newWrapper.contents())(scope);var newContents=newWrapper.contents();$animate.enter(newContents,element);$animate.leave(oldContents);}}
if(attrs.translateN){scope.$watch(attrs.translateN,update);}
scope.$on('gettextLanguageChanged',update);update();linking=false;}};}};}]);angular.module("gettext").factory("gettextFallbackLanguage",function(){var cache={};var pattern=/([^_]+)_[^_]+$/;return function(langCode){if(cache[langCode]){return cache[langCode];}
var matches=pattern.exec(langCode);if(matches){cache[langCode]=matches[1];return matches[1];}
return null;};});angular.module('gettext').filter('translate',["gettextCatalog",function(gettextCatalog){function filter(input,context){return gettextCatalog.getString(input,null,context);}
filter.$stateful=true;return filter;}]);angular.module("gettext").factory("gettextPlurals",function(){return function(langCode,n){switch(langCode){case"ay":case"bo":case"cgg":case"dz":case"fa":case"id":case"ja":case"jbo":case"ka":case"kk":case"km":case"ko":case"ky":case"lo":case"ms":case"my":case"sah":case"su":case"th":case"tt":case"ug":case"vi":case"wo":case"zh":return 0;case"is":return(n%10!=1||n%100==11)?1:0;case"jv":return n!=0?1:0;case"mk":return n==1||n%10==1?0:1;case"ach":case"ak":case"am":case"arn":case"br":case"fil":case"fr":case"gun":case"ln":case"mfe":case"mg":case"mi":case"oc":case"pt_BR":case"tg":case"ti":case"tr":case"uz":case"wa":case"zh":return n>1?1:0;case"lv":return(n%10==1&&n%100!=11?0:n!=0?1:2);case"lt":return(n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2);case"be":case"bs":case"hr":case"ru":case"sr":case"uk":return(n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);case"mnk":return(n==0?0:n==1?1:2);case"ro":return(n==1?0:(n==0||(n%100>0&&n%100<20))?1:2);case"pl":return(n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2);case"cs":case"sk":return(n==1)?0:(n>=2&&n<=4)?1:2;case"sl":return(n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0);case"mt":return(n==1?0:n==0||(n%100>1&&n%100<11)?1:(n%100>10&&n%100<20)?2:3);case"gd":return(n==1||n==11)?0:(n==2||n==12)?1:(n>2&&n<20)?2:3;case"cy":return(n==1)?0:(n==2)?1:(n!=8&&n!=11)?2:3;case"kw":return(n==1)?0:(n==2)?1:(n==3)?2:3;case"ga":return n==1?0:n==2?1:n<7?2:n<11?3:4;case"ar":return(n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5);default:return n!=1?1:0;}}});;(function(){'use strict';var mod=angular.module('ods.core',['gettext','ods.core.config','ng-sortable','ngSanitize']);mod.directive('autofocus',['$timeout',function($timeout){return{restrict:'A',link:function(scope,element,attrs){if(attrs.autofocus!=="false"){$timeout(function(){element[0].focus();},0);}}};}]);mod.directive('odsAutofocus',['$timeout',function($timeout){return{restrict:'A',scope:false,link:function(scope,element,attrs){var focusable='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';if(element.is(focusable)&&scope.$eval(attrs.odsAutofocus)){$timeout(function(){element[0].focus();},0);}}};}]);mod.directive('delayedApplyModel',['$parse',function($parse){return{restrict:'A',link:function(scope,element,attrs){var model=attrs.delayedApplyModel;var delayedApplyModelGet=$parse(model);var applyChange=function(){scope.$apply(function(){delayedApplyModelGet.assign(scope,element.val());});};element.bind('keypress',function(e){var code=(e.keyCode?e.keyCode:e.which);if(code==13){applyChange();}});var valueOnFocus=element.val();element.bind('focus',function(){valueOnFocus=element.val();});element.bind('blur',function(){if(valueOnFocus!==element.val()){applyChange();}});scope.$watch(model,function(newValue,oldValue){element.val(newValue);});}};}]);mod.directive('ngModelOnchange',function(){return{restrict:'A',priority:100,require:'ngModel',link:function(scope,elm,attr,ngModelCtrl){if(attr.type==='radio'||attr.type==='checkbox')return;elm.off('input').off('keydown').off('change');elm.on('change',function(){scope.$apply(function(){ngModelCtrl.$setViewValue(elm.val());});});}};});mod.directive('debug',['config',function(config){return{restrict:'E',template:'<div class="ods-debug"><div class="ods-debug__json-container" contenteditable="true" ods-json-formatter="debugData" ods-json-formatter-live-update="liveUpdate"></div></div>',scope:{data:'=',liveUpdate:'=?'},replace:true,link:function(scope){scope.debugData=null;angular.element(document).bind('debugToggle',function(){if(scope.debugData===null){scope.debugData=scope.data;}else{scope.debugData=null;}
scope.$apply();});}};}]);$(window).on('load',function(){$(document.body).on('keypress',function(e){if(e.charCode==68&&e.shiftKey&&!$(e.target).is('input, select, textarea')&&$(e.target).attr('contenteditable')!=='true'){$(document.body).toggleClass('js-show-debug');$(document).trigger('debugToggle');}});});mod.directive('currentItem',function(){return{restrict:'A',scope:true,link:function(scope,element,attrs,ngModel){scope.currentItem=undefined;scope.toggleCurrentItem=function(item){if(scope.currentItem==item){scope.currentItem=undefined;}else{scope.currentItem=item;}};}};});mod.directive('dateTimePicker',function(){var lpad=function(val){val=val.toString();while(val.length<2){val='0'+val;}
return val;};return{restrict:'E',replace:true,scope:{ngModel:'=',format:'@',odsDisabled:'='},require:'ngModel',template:'<div class="date-time-picker">'+'<div ng-class="{\'date\': true, \'input-append\': !odsDisabled}">'+'<input type="text" class="input-medium" type="text" ng-disabled="odsDisabled" ng-model="internalModel" placeholder="{{ format }}" readonly></input>'+'<span class="add-on" ng-hide="odsDisabled">'+'<i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>'+'</span>'+'</div>'+'<span ng-if="timezone" class="timezone" translate>Local time ({{timezone}})</span>'+'</div>',link:function(scope,element,attrs,ngModel){element.datetimepicker({maskInput:true,todayHighlight:true,format:scope.format,weekStart:1});var isDateTime=scope.format.indexOf(' ')>-1;scope.timezone=null;if(isDateTime){var offset=new Date().getTimezoneOffset();scope.timezone=((offset<0?'+':'-')+
lpad(parseInt(Math.abs(offset/60),10))+':'+
lpad(Math.abs(offset%60)));}
scope.$watch('internalModel',function(nv,ov){if(nv){if(isDateTime){scope.ngModel=(moment(nv,"YYYY-MM-DD HH:mm:ss")).toISOString().replace('.000','').replace('Z',"+00:00");}else{scope.ngModel=nv;}}});scope.$watch('ngModel',function(nv,ov){var date;if(nv){if(isDateTime){date=moment(nv);scope.internalModel=date.format('YYYY-MM-DD HH:mm:ss');}else{date=moment(nv);scope.internalModel=date.format('YYYY-MM-DD');}
element.datetimepicker('setValue',scope.internalModel);}});var source=element.find('input');element.bind('changeDate',function(){scope.$apply(function(){scope.internalModel=source.val();});});}};});mod.directive('slugfield',['$filter',function($filter){return{require:'ngModel',restrict:'A',link:function(scope,element,attrs,ngModel){scope.$watch(attrs.slugfield,function(nv,ov){if(nv!==ov){var slug=$filter('slugify')($filter('normalize')(nv));ngModel.$viewValue=slug;ngModel.$setViewValue(ngModel.$viewValue);element.val(slug);}},true);}};}]);mod.directive('odsForm',function(){return{restrict:'E',replace:true,scope:{model:'=',overrideModel:'=',formDefinition:'=',errors:'=',valuesLanguage:'=',context:'='},template:''+'<form class="ODSForm">'+'   <ods-form-content model="model"'+'                     override-model="overrideModel"'+'                     form-definition="formDefinition"'+'                     errors="errors"'+'                     values-language="valuesLanguage"'+'                     context="context"></ods-form-content>'+'</form>'}});mod.directive('odsFormContent',function(){var formUniqueId=0;return{templateUrl:'/static/ods/html/ods_form.html',replace:true,restrict:'E',scope:{model:'=',overrideModel:'=',formDefinition:'=',errors:'=',valuesLanguage:'=',context:'='},link:function(scope,element,attrs){scope.field_pattern=/^{{.*}}$/;if(typeof scope.model==="undefined"){scope.model={};}
scope.$watch('formDefinition',function(nv,ov){if(nv){scope.has_advanced=$.grep(scope.formDefinition,function(elt){return elt.advanced;}).length>0;$.each(scope.formDefinition,function(index,field){if(field.hasOwnProperty('default')&&!scope.model.hasOwnProperty(field.name)){scope.model[field.name]=angular.copy(field['default']);}
if(field.depends_on){if(!angular.isArray(field.depends_on_value)){field.depends_on_value=[field.depends_on_value];}}});}});if(attrs.name){scope.$parent[attrs.name]=scope[attrs.name];}
scope.showAdvanced=false;scope.toggleAdvanced=function(e){e.preventDefault();scope.showAdvanced=!scope.showAdvanced;};scope.isOverridden=function(field){return scope.overrideModel&&angular.isDefined(scope.overrideModel[field.name]);};},controller:function($scope){$scope.form_id="form"+(++formUniqueId);this.isOverridable=function(){return!!$scope.overrideModel;};this.isOverridden=function(field){return $scope.isOverridden(field);};this.override=function(field){if(angular.isDefined($scope.model[field.name])){$scope.overrideModel[field.name]=angular.copy($scope.model[field.name]);}else{var defaultValue='';if(field.type==='list'||field.type==='enumlist'){defaultValue=[];}
$scope.overrideModel[field.name]=defaultValue;}};this.cancelOverride=function(field){delete $scope.overrideModel[field.name];};}};});mod.directive('odsFormField',['APIXHRService','$q',function(APIXHRService,$q){return{restrict:'E',templateUrl:'/static/ods/html/ods_form_field.html',replace:true,require:'^odsFormContent',scope:{model:'=',field:'=',odsDisabled:'=',valuesLanguage:'=',odsFormId:"=",addentrylabel:'=?',context:'='},link:function(scope,element,attrs,formController){if(!scope.addentrylabel){scope.addentrylabel='Add an entry';}
var canceller=null;scope.odsFormSuggestions=function(q,arg){if(canceller){canceller.resolve();}
canceller=$q.defer();return APIXHRService("GET",arg,{query:q},"publish",canceller.promise).then(function(){canceller=null;});};scope.setValue=function(value,field){scope.model[field.name]=value.value;};scope.isOverridable=formController.isOverridable;scope.isOverridden=function(){return formController.isOverridden(scope.field);};scope.mapValues=function(i){return i.value;};scope.override=formController.override;scope.cancelOverride=formController.cancelOverride;scope.id=scope.odsFormId+'-'+scope.field.name;scope.removeObject=function(index){if(angular.isArray(scope.model[scope.field.name])){scope.model[scope.field.name].splice(index,1);}};scope.addEntry=function(){if(scope.field.type==="objectlist"||scope.field.type==="unconfiguredobject"){if(!scope.model[scope.field.name]){scope.model[scope.field.name]=[];}
scope.model[scope.field.name].push({});}};scope.prepareMetaForEnum=function(meta){if(angular.isString(meta)){return{label:meta,value:meta};}
return meta;};}};}]);mod.directive('odsKeyValue',function(){return{restrict:'E',replace:true,template:'<div class="key-value-input"><input ng-model="key" type="text"><span>=</span><input ng-model="value" type="text"></div>',scope:{ngModel:'='},link:function(scope,element,attrs){scope.key='';scope.value='';scope.$watch("ngModel",function(nv){angular.forEach(nv,function(value,key){if(key!=="$$hashKey"){scope.value=value;scope.key=key;}});});scope.$watch("key",function(nv){var item={};item[nv]=scope.value;angular.copy(item,scope.ngModel);},true);scope.$watch("value",function(nv){var item={};item[scope.key]=nv;angular.copy(item,scope.ngModel);},true);}};});mod.directive('main',function(){return{restrict:'E',link:function(scope,element,attrs){scope.toggleAsideLeft=function(){if(scope.showAside=='left'){scope.showAside='';}else{scope.showAside='left';}};scope.toggleAsideRight=function(){if(scope.showAside=='right'){scope.showAside='';}else{scope.showAside='right';}};}};});mod.directive('tagField',['$compile','$timeout',function($compile,$timeout){return{restrict:'A',require:['^?form'],scope:{modelitems:'=ngModel',tagFieldHelp:'=',suggestionsTag:'&',odsDisabled:'='},link:function(scope,element,attrs,ctrls){var formController=ctrls[0];if(attrs.suggestionsTag){element.html($compile('<div class="tagField" ng-class="{\'disabled\': odsDisabled}">'+'<ods-suggestions ng-model="newTag" ods-disabled="odsDisabled" source-callback="suggestionsTag({q:q})" selection-callback="addSuggestion(value)"><span ng-bind-html="item._highlightResult.value.value"></span></ods-suggestions> '+'<i class="icon-question-sign" ods-tooltip="{{ tagFieldHelp }}"></i>'+'<div class="tags">'+'<div class="tag" ng-click="deleteTag($index)" ng-repeat="tag in tags">{{ tag }}</div>'+'</div>'+'</div>')(scope));}else{element.html($compile('<div class="tagField" ng-class="{\'disabled\': odsDisabled}">'+'<input type="text" ng-model="newTag" ng-trim="false" ng-disabled="odsDisabled" /> '+'<i class="icon-question-sign" ods-tooltip="{{ tagFieldHelp }}"></i>'+'<div class="tags">'+'<div class="tag" ng-click="deleteTag($index)" ng-repeat="tag in tags">{{ tag }}</div>'+'</div>'+'</div>')(scope));}
var input=element.find('input');scope.$watch('modelitems',function(nv){if(nv){if(angular.isString(nv)){scope.tags=[nv];}else{scope.tags=nv;}}},true);scope.$watch('tags',function(nv){if(nv&&angular.isArray(nv)){scope.modelitems=nv;}},true);scope.addSuggestion=function(value){scope.addTag(value.value);};scope.addTag=function(value){if(angular.isUndefined(scope.tags)){scope.tags=[];}
if(scope.tags.indexOf(value)===-1){scope.tags.push(value);}
if(formController){formController.$setDirty();}
$timeout(function(){input.focus();},0);};scope.deleteTag=function(index){if(!scope.odsDisabled){scope.tags.splice(index,1);}
if(formController){formController.$setDirty();}};angular.element(input).bind('keydown',function(e){var inputValue=input.val();if(e.keyCode===13&&inputValue!==''){scope.addTag(inputValue);scope.newTag=null;input.val('');scope.$apply();input.focus();return false;}});}};}]);mod.directive('quota',['translate',function(translate){return{restrict:'E',scope:{quota:"=quota",restrictUnit:"@",label:"@"},templateUrl:'/static/ods/html/quota.html',link:function(scope,element,attrs){scope.orderUnits=["second","minute","hour","day","month"];scope.units={"second":translate("second"),"minute":translate("minute"),"hour":translate("hour"),"day":translate("day"),"month":translate("month")};scope.translate=translate;}};}]);mod.directive('enumList',function(){return{restrict:'E',require:'ngModel',scope:{model:'=ngModel',values:'=',uniqueValues:'='},replace:true,template:'<div class="enum-list">'+'<ul ng-sortable ng-model="objectModel" class="unstyled">'+'<li ng-repeat="item in objectModel">'+'<select ng-options="key as value for (key,value) in item.values" ng-model="item.item"></select>'+'<i class="handle icon-move"></i>'+'<i class="icon-remove" ng-click="remove($index)"></i>'+'</li>'+'</ul>'+'<button type="button" class="btn" ng-click="add(\'\')" ng-disabled="addButtonDisabled"><i class="icon-plus"></i></button>'+'</div>',link:function(scope,element,attrs,ngModel){var init=true;var reservedValues=[];scope.addButtonDisabled=false;scope.objectModel=[];if(angular.isArray(scope.values)){var values={};for(var i=0;i<scope.values.length;i++){values[scope.values[i]]=scope.values[i];}
scope.values=values;}
var getSelectValues=function(item){var values={};var reservedValuesWithoutItem=angular.copy(reservedValues);reservedValuesWithoutItem.splice(reservedValuesWithoutItem.indexOf(item),1);angular.forEach(scope.values,function(value,key){if($.inArray(value,reservedValuesWithoutItem)===-1){values[key]=value;}});return values;};var updateSelectValues=function(){var i;if(!scope.uniqueValues)return;reservedValues=[];for(i=0;i<scope.objectModel.length;i++){reservedValues.push(scope.objectModel[i].item);}
for(i=0;i<scope.objectModel.length;i++){var item=scope.objectModel[i];item.values=getSelectValues(item.item);if(item.item===''){item.item=Object.keys(item.values)[0];}}
scope.addButtonDisabled=Object.keys(scope.values).length===reservedValues.length;};scope.add=function(item){scope.objectModel.push({item:!scope.uniqueValues&&item===''?Object.keys(scope.values)[0]:item,values:scope.values});init=false;};scope.remove=function(index){scope.objectModel.splice(index,1);};scope.$watch('model',function(nv,ov){if(nv&&init){for(var i=0;i<scope.model.length;i++){scope.add(scope.model[i]);}
updateSelectValues();}});scope.$watch('objectModel',function(nv,ov){if(nv!==ov){updateSelectValues();scope.model=[];for(var i=0;i<scope.objectModel.length;i++){scope.model.push(scope.objectModel[i].item);}}},true);}};});mod.directive('hierarchicalField',['ModuleLazyLoader','$compile','$timeout',function(ModuleLazyLoader,$compile,$timeout){return{restrict:'E',require:'ngModel',scope:{'hierarchy':'=','model':'=ngModel','readonly':'=ngReadonly'},replace:true,template:'<div class="hierarchical-field ods-form__vertical-controls"></div>',link:function(scope,element){ModuleLazyLoader('html-entities').then(function(){scope.needFocus=-1;scope.addFields=function(defaultValues){var div=$('<div class="field-group ods-align-horizontal ods-form__horizontal-controls"></div>');for(var i=0;i<scope.hierarchy.length;i++){var readonly=scope.readonly?' readonly':'';var value=defaultValues?' value="'+ODS.StringUtils.escapeHTML(defaultValues[i]).replace(/{[\w\s]?{/g,'')+'"':'';var input=$('<input type="text" class="ods-form__control"'+value+readonly+' remove-field>');input.attr('placeholder',scope.hierarchy[i]);if(i===0){input.attr('list','autocomplete-facet');}
input.on('change',function(){if($(this)[0]===element.find('input').last()[0]){scope.addFields();element.find('.field-group').last().find('input').first().focus();}
if($(this).val()===''){var remove=true;if($(this)[0]===$(this).parent().find('input').last()[0]&&$(this).parent()[0]!==$(this).parent().next()){$(this).parent().next().find('input').first().change();}
if(element.find('.field-group').last()[0]===$(this).parent()[0]){if($(this).parent().prev().find('input').last().val()!==''){remove=false;}}
angular.forEach($(this).parent().find('input'),function(input){if($(input).val()!==''){remove=false;}});if(remove){$(this).parent().remove();element.find('.field-group').last().find('input').first().focus();}}
scope.updateModel();});input.on('keydown',function(event){if($(this)[0]===$(this).parent().find('input').last()[0]&&event.keyCode===9){scope.needFocus=scope.getElementPosition($(this))+1;}
if(event.keyCode===13){scope.needFocus=scope.getElementPosition($(this));}});var elem=angular.element(''+'<div class=ods-form__group>');$compile(input)(scope);div.append(input);if(i==scope.hierarchy.length-1){input.keyup();}}
element.append(div);};scope.getElementFromPosition=function(pos){var el=element.find('.field-group input').eq(pos);return el[0]?el:element.find('.field-group').last().find('input').first();};scope.getElementPosition=function(el){for(var i=0;i<element.find('.field-group input').length;i++){if(el[0]===element.find('.field-group input').eq(i)[0]){return i;}}
return-1;};scope.updateModel=function(){var fields={};angular.forEach(element.find('.field-group'),function(inputs){var takeInAccount=true;var keys=[];angular.forEach($(inputs).find('input'),function(input){var val=$(input).val();keys.push(val);if(val===''){takeInAccount=false;}});if(takeInAccount){var value=keys.splice(-1,1);var index=keys.join('.');if(fields[index]){fields[index]=fields[index].concat(value);}else{fields[index]=value;}}});if(!isObjectEmpty(scope.model)||!isObjectEmpty(fields)){scope.model=fields;scope.$apply();}};scope.$watch('model',function(newValue){$timeout(function(){element.find('.field-group').remove();var keyValues;for(var key in newValue){if(newValue[key].length==1){keyValues=[key].concat(newValue[key]);}else{if(!angular.isArray(newValue[key])){var item=[key].concat(newValue[key]);keyValues=item;}else{keyValues=[];angular.forEach(newValue[key],function(value){var item=[key].concat(value);keyValues.push(item);});}}
if(keyValues.length>=scope.hierarchy.length){if(!angular.isArray(keyValues[0])){scope.addFields(keyValues);}else{angular.forEach(keyValues,function(item){scope.addFields(item);});}}else{delete newValue[key];}}
scope.addFields();if(scope.needFocus!==-1){scope.getElementFromPosition(scope.needFocus).focus();scope.needFocus=-1;}},0);},true);});}};}]);mod.directive('removeField',function(){function addIcon(element){if(element.find('i').length)
return;var icon=$('<button class="ods-button ods-form__addon ng-scope" type="button" aria-label="Remove" translate="aria-label"><i class="icon-remove fa fa-remove" aria-hidden="true"></i></button>');icon.on('click',function(){angular.forEach(element.find('input'),function(input){$(input).val('');$(input).change();});});element.append(icon);}
function removeIcon(element){element.find('i').remove();}
return{restrict:'A',link:function(scope,element){if(element.attr('readonly')){return;}
element.on('keyup',function(){if($(this).val()){addIcon(element.parent());}else{var remove=true;angular.forEach(element.parent().find('input'),function(input){if($(input).val()!==''){remove=false;}});if(remove){removeIcon(element.parent());}}});}};});mod.directive('datalistValues',['translate',function(translate){return{restrict:'A',scope:{datalistValues:'=',datalistValuesLanguage:'='},link:function(scope,element,attrs){var build=function(language){var dlist=angular.element('<datalist />');dlist.attr('id',Math.random().toString(36).substring(7)+'-values');if(element.attr('list')){$(document.body).find('datalist#'+element.attr('list')).remove();}
element.attr('list',dlist.attr('id'));for(var i=0;i<scope.datalistValues.length;i++){var item=scope.datalistValues[i];var value,label;var alreadyTranslated=false;if(angular.isObject(item)){if(angular.isObject(item.labels)){alreadyTranslated=true;value=item.labels[language];label='';}else{value=item.value;label=item.label;}}else{value=item;label='';}
if(language&&!alreadyTranslated){value=translate(value,language);}
if(angular.isDefined(value)&&value!==null){dlist.append(angular.element('<option value="'+ODS.StringUtils.escapeHTML(value)+'">'+ODS.StringUtils.escapeHTML(label)+'</option>'));}}
element.after(dlist);};scope.$watch('datalistValuesLanguage',function(){if(angular.isDefined(scope.datalistValues)&&(!angular.isArray(scope.datalistValues)||scope.datalistValues.length>0)){build(scope.datalistValuesLanguage);}});scope.$watch('datalistValues',function(nv){if(angular.isDefined(scope.datalistValues)&&(!angular.isArray(scope.datalistValues)||scope.datalistValues.length>0)){build(scope.datalistValuesLanguage);}});}};}]);mod.directive('datasetFieldSelector',['translate',function(translate){return{restrict:'E',replace:true,template:''+'<div class="dataset-field-selector">'+'   <select ng-disabled="odsDisabled" '+'           ng-model="model">'+'       <option ng-if="allowNone" value="" translate>(none)</option>'+'       <option ng-repeat="item in options" value="{{item.name}}">{{item.label}}</option>'+'   </select>'+'</div>',scope:{'model':'=ngModel','fields':'=','odsDisabled':'=','allowNone':'=?'},link:function(scope,element,attrs){scope.allowNone=Boolean(scope.allowNone)===scope.allowNone?scope.allowNone:true;scope.$watch('fields',function(fields){var options=[];angular.forEach(fields,function(field){options.push({name:field.name,label:format_string('{label} ({type})',{label:field.label,type:translate(field.type)})})});scope.options=options;},true);},};}]);mod.directive('multipleDatasetFieldSelector',['$filter',function($filter){return{restrict:'E',require:'ngModel',replace:true,template:'<div class="multiple-dataset-field-selector">'+'<div ng-show="!odsDisabled">'+'<ul ng-sortable ng-model="selectedFields" class="unstyled">'+'<li ng-repeat="field in selectedFields">'+'<div class="field-label" title="{{ field.label }}">{{ field.label }}</div>'+'<i class="handle icon-reorder"></i>'+'<i class="icon-remove" ng-click="remove(field)"></i>'+'</li>'+'</ul>'+'</div>'+'<ul ng-show="odsDisabled" ng-model="selectedFields" class="unstyled">'+'<li ng-repeat="field in selectedFields">'+'<div class="field-label" title="{{ field.label }}">{{ field.label }}</div>'+'</li>'+'</ul>'+'<ul class="unstyled discarded">'+'<li ng-repeat="field in discardedFields">'+'<div class="field-label" title="{{ field.label }}">{{ field.label }}</div>'+'<i ng-if="!odsDisabled" class="icon-plus" ng-click="add(field)"></i>'+'</li>'+'</ul>'+'</div>',scope:{'model':'=ngModel','fields':'=','visualization':'@','odsDisabled':'='},link:function(scope,element,attrs){scope.discardedFields=[];scope.selectedFields=[];scope.$watch('fields',function(nv,ov){if(nv){scope.selectedFields=[];scope.discardedFields=[];if(scope.model&&scope.model.length>0){var vizFields=scope.fields;if(scope.visualization){vizFields=$filter('fieldsForVisualization')(vizFields,scope.visualization);}
angular.forEach(vizFields,function(f){var index=scope.model.indexOf(f.name);if(index<0){scope.discardedFields.push(f);}else{scope.selectedFields[index]=f;}});}else{var fields=angular.copy(scope.fields);if(scope.visualization){fields=$filter('fieldsForVisualization')(fields,scope.visualization);}
scope.selectedFields=fields;}}},true);scope.$watch('selectedFields',function(nv,ov){if(nv!==ov){scope.selectedFields=scope.selectedFields.filter(function(f){return angular.isDefined(f);});scope.model=$.map(scope.selectedFields,function(f){return f.name;});var vizFields=scope.fields;if(scope.visualization){vizFields=$filter('fieldsForVisualization')(vizFields,scope.visualization);}
if(scope.model&&scope.model.join('||')===$.map(vizFields,function(f){return f.name;}).join('||')){scope.model=[];}}},true);scope.add=function(field){scope.selectedFields.push(field);scope.discardedFields.splice(scope.discardedFields.indexOf(field),1);};scope.remove=function(field){scope.discardedFields.push(field);scope.selectedFields.splice(scope.selectedFields.indexOf(field),1);};}};}]);mod.directive('repeatCount',function(){return{restrict:'A',link:function(scope,element,attrs){var count=attrs.repeatCount;if(count===0){element.css('display','none');}else if(count>1){for(var i=1;i<count;i++){var clone=element.clone();element.after(clone);}}}};});mod.directive('scrollShadow',['$window',function($window){return{scope:{scrollDirection:'@'},link:function(scope,element,attrs){scope.scrollDirection=scope.scrollDirection||'horizontal';function verticalShadows(){if(element[0].scrollTop>0){element.addClass('verticalScrollStart');}else{element.removeClass('verticalScrollStart');}
if(element[0].scrollHeight>element[0].offsetHeight+element[0].scrollTop){element.addClass('verticalScrollEnd');}else{element.removeClass('verticalScrollEnd');}}
function horizontalShadows(){if(element[0].scrollLeft>0){element.addClass('horizontalScrollStart');}else{element.removeClass('horizontalScrollStart');}
if(element[0].scrollWidth>element[0].offsetWidth+element[0].scrollLeft){element.addClass('horizontalScrollEnd');}else{element.removeClass('horizontalScrollEnd');}}
var shadows=scope.scrollDirection=='vertical'?verticalShadows:horizontalShadows;element.on('scroll',shadows);$($window).on('resize.scrollShadow',shadows);if(angular.isUndefined(window.MutationObserver)){scope.$watch(shadows,function(){});}else{var observer=new MutationObserver(shadows);observer.observe(element[0],{childList:true,subtree:true});scope.$on('$destroy',function(){observer.disconnect();});}
scope.$on('$destroy',function(){$($window).off('.scrollShadow');});shadows();}};}]);function initializeMap(element,MapHelper,ODSWidgetsConfig,customOptions){var map=new L.ODSMap(element,customOptions);var defaultLoc=MapHelper.getLocationStructure(ODSWidgetsConfig.defaultMapLocation);map.setView(defaultLoc.center,defaultLoc.zoom);return map;}
mod.directive('odsPointSelector',['ODSWidgetsConfig','MapHelper','config',function(ODSWidgetsConfig,MapHelper,config){return{restrict:'E',require:'ngModel',replace:true,template:'<div class="map-point-selector">'+'<div class="map"></div>'+'</div>',link:function(scope,element,attrs,ctrl){scope.scrollWheelZoom=attrs.scrollWheelZoom!=='false';scope.$watch(attrs.invalidateSize,function(){map.invalidateSize();});var map=initializeMap(element.find('.map')[0],MapHelper,ODSWidgetsConfig,{scrollWheelZoom:scope.scrollWheelZoom,basemapsList:[config.DEFAULT_BASEMAP]});var onMarkerDragged=function(e){scope.$apply(function(){ctrl.$setViewValue(e.target.getLatLng());});};var unwatch=scope.$watch(attrs.ngModel,function(nv,ov){if(nv){map.setView(nv,14);L.marker(nv,{opacity:0.4}).addTo(map);var marker=L.marker(nv,{draggable:true}).addTo(map);marker.on('dragend',onMarkerDragged);}
else{var controlToolbar=new L.Control.Draw({draw:{polyline:false,polygon:false,rectangle:false,circle:false}}).addTo(map);map.on('draw:created',function(e){var marker=e.layer;marker.options.draggable=true;map.addLayer(marker);scope.$apply(function(){ctrl.$setViewValue(marker.getLatLng());});marker.on('dragend',onMarkerDragged);map.removeControl(controlToolbar);});}
unwatch();});}};}]);mod.directive('odsDrawMap',['ODSWidgetsConfig','MapHelper','config',function(ODSWidgetsConfig,MapHelper,config){return{restrict:'E',require:'ngModel',replace:true,template:'<div class="draw-shape-map">'+'<div class="map"></div>'+'</div>',link:function(scope,element,attrs,ctrl){scope.scrollWheelZoom=attrs.scrollWheelZoom!=='false';var map=initializeMap(element.find('.map')[0],MapHelper,ODSWidgetsConfig,{scrollWheelZoom:scope.scrollWheelZoom,basemapsList:[config.DEFAULT_BASEMAP]});var editLayer=new L.FeatureGroup();map.addLayer(editLayer);var oldShapeLayer=new L.FeatureGroup();map.addLayer(oldShapeLayer);var drawControl=new L.Control.Draw({edit:{featureGroup:editLayer}});map.addControl(drawControl);var updateModel=function(){scope.$apply(function(){ctrl.$setViewValue(editLayer.toGeoJSON());});};map.on('draw:created',function(e){e.layer.options.opacity=0.5;editLayer.addLayer(e.layer);updateModel();});map.on('draw:edited',updateModel);map.on('draw:deleted',updateModel);var bounds=null;scope.$watch(attrs.invalidateSize,function(){map.invalidateSize();});var addGeoJsonToGroup=function(geoJson,group){L.geoJson(geoJson,{onEachFeature:function(feature,layer){group.addLayer(layer);}});};var unwatch=scope.$watch(attrs.ngModel,function(nv,ov){if(nv){if(nv.type==="MultiPolygon"){nv.coordinates.forEach(function(shapeCoords,i){addGeoJsonToGroup({type:"Polygon",coordinates:shapeCoords},oldShapeLayer);});}
else{addGeoJsonToGroup(nv,oldShapeLayer);}
bounds=oldShapeLayer.getBounds();map.fitBounds(bounds);}
unwatch();});}};}]);mod.directive('odsMarkerMap',['ODSWidgetsConfig','MapHelper','config',function(ODSWidgetsConfig,MapHelper,config){return{restrict:'E',require:'ngModel',replace:true,template:'<div class="map-point-selector">'+'<div class="map"></div>'+'</div>',link:function(scope,element,attrs,ctrl){var map=initializeMap(element.find('.map')[0],MapHelper,ODSWidgetsConfig,{basemapsList:[config.DEFAULT_BASEMAP]});scope.$watch(attrs.ngModel,function(nv,ov){if(isNullOrUndefined(nv))return;map.setView(nv,14);L.marker(nv).addTo(map);});}};}]);mod.directive('odsGeoshapeMap',['ODSWidgetsConfig','MapHelper','config',function(ODSWidgetsConfig,MapHelper,config){return{restrict:'E',require:'ngModel',replace:true,template:'<div class="geoshape-map">'+'<div class="map"></div>'+'</div>',link:function(scope,element,attrs,ctrl){var map=initializeMap(element.find('.map')[0],MapHelper,ODSWidgetsConfig,{basemapsList:[config.DEFAULT_BASEMAP]});scope.$watch(attrs.ngModel,function(nv,ov){if(isNullOrUndefined(nv))return;var geoshapeLayer=L.geoJson(nv).addTo(map);map.fitBounds(geoshapeLayer.getBounds());});}};}]);mod.directive('virtualDatasetContext',['ODSAPI',function(ODSAPI){return{restrict:'A',link:function(scope,element,attrs){var unwatch=scope.$watch(attrs.virtualDatasetContextDataset,function(nv,ov){if(nv&&nv.datasetid){var contextName=attrs.virtualDatasetContext;var parameters=scope.$eval(attrs.virtualDatasetContextParameters);scope[contextName]={'name':contextName,'type':'dataset','apikey':null,'dataset':nv,'domainUrl':ODSAPI.getDomainURL(null),'parameters':parameters};unwatch();}});}};}]);mod.directive('virtualCatalogContext',['ODSAPI',function(ODSAPI){return{restrict:'A',link:function(scope,element,attrs){var contextName=attrs.virtualCatalogContext;scope[contextName]={'name':contextName,'type':'catalog','domain':null,'domainUrl':ODSAPI.getDomainURL(null),'apikey':null,'parameters':{}};}};}]);mod.directive('keywordLabels',function(){return{restrict:'E',replace:true,template:'<div class="keyword-labels"><span class="label label-info" ng-repeat="keyword in keywords" ng-click="toggleRefine(keyword)" ng-class="{\'active\': isKeywordActive(keyword), \'no-click\': noClick}">{{keyword}}</span></div>',scope:{dataset:'=',apiParams:'=',noClick:'@?'},controller:function($scope){$scope.toggleRefine=function(facetPath){var refineKey="refine.keyword";if(!$scope.apiParams[refineKey]||$scope.apiParams[refineKey]===undefined){$scope.apiParams[refineKey]=[facetPath];}else{var currentRefinements=$scope.apiParams[refineKey];for(var i=0;i<currentRefinements.length;i++){var refinement=currentRefinements[i];if(refinement==facetPath){currentRefinements.splice(i,1);if(currentRefinements.length===0)
delete $scope.apiParams[refineKey];return;}}
$scope.apiParams[refineKey].push(facetPath);}};$scope.isKeywordActive=function(facetPath){if($scope.apiParams["refine.keyword"]){var refinements=$scope.apiParams["refine.keyword"];for(var i=0;i<refinements.length;i++){var ref=refinements[i];if(ref==facetPath){return true;}}}
return false;};if(angular.isArray($scope.dataset.metas.keyword)){$scope.keywords=$scope.dataset.metas.keyword;}else{$scope.keywords=[$scope.dataset.metas.keyword];}}};});mod.directive('datasetIcon',['$filter',function($filter){return{restrict:'AE',replace:true,template:'<li>'+'<a href="{{ url }}{{ searchOptions.headless?\'&headless=\'+searchOptions.headless:\'\' }}" target="_self" title="{{ title||\'\' | capitalize | translate }}">'+'<i class="icon-{{ icons[name] }} icon-large"></i>'+'</a>'+'</li>',scope:true,link:function(scope,element,attrs){scope.icons={'metas':'list','table':'table','map':'globe','calendar':'calendar','images':'picture','analyze':'bar-chart','monitoring':'bar-chart','export':'download-alt','api':'laptop'};scope.name=attrs.name?attrs.name:'';scope.title=!attrs.title?$filter('capitalize')(attrs.name):attrs.title;scope.urlRoot=attrs.urlRoot||'';scope.url=!attrs.url?scope.urlRoot+'dataset/'+scope.dataset.datasetid+'/?tab='+scope.name:attrs.url;}};}]);mod.directive('highlightIfCurrentLocation',function(){return{restrict:'A',controller:function($scope,$element,$attrs,$location,$document){$scope.$on('$locationChangeSuccess',function(event,newUrl){if('/'+$attrs.href===$location.path()){$element.addClass('current-location-highlight');}else{$element.removeClass('current-location-highlight');}});}};});mod.directive('snapshotForm',['ManagementAPI',function(ManagementAPI){return{scope:{dataset_status:'=datasetStatus',dataset:'=',},templateUrl:'/static/greenfloor/html/snapshot_form.html',replace:true,restrict:'E',controller:function($scope){$scope.newSnapshot={};$scope.newSnapshotCreationTime=null;$scope.processingSnapshots=[];$scope.listSnapshots=function(dataset_id){ManagementAPI.datasets.snapshots.list(dataset_id).then(function(response){var data=response.data;$scope.snapshots=data;});};$scope.isDatasetPublished=function(){return $scope.dataset&&$scope.dataset.published&&($scope.dataset_status.status=='idle'||$scope.dataset_status.status=='limit_reached');};$scope.saveSnapshot=function(dataset_id,description){ManagementAPI.datasets.snapshots.save(dataset_id,description).then(function(response){var data=response.data;$scope.newSnapshotCreationTime=new Date();$scope.listSnapshots(dataset_id);$scope.savingSnapshot=true;$scope.$emit('updateStatus',$scope.dataset);});};$scope.deleteSnapshot=function(dataset_id,snapshot_id){$scope.processingSnapshots.push(snapshot_id);ManagementAPI.datasets.snapshots['delete'](dataset_id,snapshot_id).then(function(){var deletedSnapshotProcessingIdx=$scope.processingSnapshots.indexOf(snapshot_id);var deletedSnapshotIdx=-1;for(var i=0;i<$scope.snapshots.length;i++){if($scope.snapshots[i].snapshot_id===snapshot_id){deletedSnapshotIdx=i;}}
if(deletedSnapshotProcessingIdx!==-1){$scope.processingSnapshots.splice(deletedSnapshotProcessingIdx,1);}
if(deletedSnapshotIdx!==-1){$scope.snapshots.splice(deletedSnapshotIdx,1);}},function(){var deletedSnapshotProcessingIdx=$scope.processingSnapshots.indexOf(snapshot_id);if(deletedSnapshotProcessingIdx!==-1){$scope.processingSnapshots.splice(deletedSnapshotProcessingIdx,1);}});};$scope.snapshotIsProcessing=function(snapshot_id){return $scope.processingSnapshots.indexOf(snapshot_id)!==-1;};var unwatchDataset=$scope.$watch('dataset',function(nv,ov){if(nv&&nv.id){$scope.listSnapshots(nv.id);unwatchDataset();}},true);$scope.$watch('dataset_status',function(nv,ov){if(nv==ov){return;}
if($scope.savingSnapshot&&nv.status==='idle'){$scope.savingSnapshot=false;$scope.newSnapshot.description='';$scope.defaultDescriptionModified=false;$scope.listSnapshots($scope.dataset.id);}});}};}]);mod.filter('limitFrom',function(){return function(input,start){if(!input)return;start=+start;return input.slice(start);};});}());function fireDOMEvent(element,eventName){var evt;if(document.createEventObject){evt=document.createEventObject();evt.eventType=eventName;evt.eventName=eventName;element.fireEvent('on'+evt.eventType,evt);}else{evt=document.createEvent("MouseEvents");evt.initEvent(eventName,true,true);return!element.dispatchEvent(evt);}};(function(){'use strict';var mod=angular.module('ods.core');mod.filter('get_full_name',[function(){return function(user){if(user){if(user.first_name||user.last_name){return user.first_name+' '+user.last_name+' ('+user.username+')';}else{return user.username;}}};}]);mod.filter('formatMeta',['$filter',function($filter){return function(input,type){if(!input){return'';}
var separator=', ';if(angular.isArray(input)){input=input.join(separator);}
if(angular.isString(input)){if(type==='date'){input=$filter('moment')(input,'LL');}else if(type==='datetime'){input=$filter('moment')(input,'LLL');}}else{input=input.toString();}
return input;};}]);var fixDateFormat_pattern=/(\d{2})\/(\d{2})\/(\d{4}) (\d{2}):(\d{2}):(\d{2})/;mod.filter('fixDateFormat',[function(){return function(input){var match=fixDateFormat_pattern.exec(input);if(match){input=new Date(parseInt(match[3],10),parseInt(match[1],10)-1,parseInt(match[2],10),parseInt(match[4],10),parseInt(match[5],10),parseInt(match[6],10));}
return input;};}]);var MD5=function(string){function RotateLeft(lValue,iShiftBits){return(lValue<<iShiftBits)|(lValue>>>(32-iShiftBits));}
function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=(lX&0x80000000);lY8=(lY&0x80000000);lX4=(lX&0x40000000);lY4=(lY&0x40000000);lResult=(lX&0x3FFFFFFF)+(lY&0x3FFFFFFF);if(lX4&lY4){return(lResult^0x80000000^lX8^lY8);}
if(lX4|lY4){if(lResult&0x40000000){return(lResult^0xC0000000^lX8^lY8);}else{return(lResult^0x40000000^lX8^lY8);}}else{return(lResult^lX8^lY8);}}
function F(x,y,z){return(x&y)|((~x)&z);}
function G(x,y,z){return(x&z)|(y&(~z));}
function H(x,y,z){return(x^y^z);}
function I(x,y,z){return(y^(x|(~z)));}
function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b);}
function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1%64))/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=(lWordArray[lWordCount]|(string.charCodeAt(lByteCount)<<lBytePosition));lByteCount++;}
lWordCount=(lByteCount-(lByteCount%4))/4;lBytePosition=(lByteCount%4)*8;lWordArray[lWordCount]=lWordArray[lWordCount]|(0x80<<lBytePosition);lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray;}
function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=(lValue>>>(lCount*8))&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);}
return WordToHexValue;}
function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;}
var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=0x67452301;b=0xEFCDAB89;c=0x98BADCFE;d=0x10325476;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,0xD76AA478);d=FF(d,a,b,c,x[k+1],S12,0xE8C7B756);c=FF(c,d,a,b,x[k+2],S13,0x242070DB);b=FF(b,c,d,a,x[k+3],S14,0xC1BDCEEE);a=FF(a,b,c,d,x[k+4],S11,0xF57C0FAF);d=FF(d,a,b,c,x[k+5],S12,0x4787C62A);c=FF(c,d,a,b,x[k+6],S13,0xA8304613);b=FF(b,c,d,a,x[k+7],S14,0xFD469501);a=FF(a,b,c,d,x[k+8],S11,0x698098D8);d=FF(d,a,b,c,x[k+9],S12,0x8B44F7AF);c=FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);b=FF(b,c,d,a,x[k+11],S14,0x895CD7BE);a=FF(a,b,c,d,x[k+12],S11,0x6B901122);d=FF(d,a,b,c,x[k+13],S12,0xFD987193);c=FF(c,d,a,b,x[k+14],S13,0xA679438E);b=FF(b,c,d,a,x[k+15],S14,0x49B40821);a=GG(a,b,c,d,x[k+1],S21,0xF61E2562);d=GG(d,a,b,c,x[k+6],S22,0xC040B340);c=GG(c,d,a,b,x[k+11],S23,0x265E5A51);b=GG(b,c,d,a,x[k+0],S24,0xE9B6C7AA);a=GG(a,b,c,d,x[k+5],S21,0xD62F105D);d=GG(d,a,b,c,x[k+10],S22,0x2441453);c=GG(c,d,a,b,x[k+15],S23,0xD8A1E681);b=GG(b,c,d,a,x[k+4],S24,0xE7D3FBC8);a=GG(a,b,c,d,x[k+9],S21,0x21E1CDE6);d=GG(d,a,b,c,x[k+14],S22,0xC33707D6);c=GG(c,d,a,b,x[k+3],S23,0xF4D50D87);b=GG(b,c,d,a,x[k+8],S24,0x455A14ED);a=GG(a,b,c,d,x[k+13],S21,0xA9E3E905);d=GG(d,a,b,c,x[k+2],S22,0xFCEFA3F8);c=GG(c,d,a,b,x[k+7],S23,0x676F02D9);b=GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);a=HH(a,b,c,d,x[k+5],S31,0xFFFA3942);d=HH(d,a,b,c,x[k+8],S32,0x8771F681);c=HH(c,d,a,b,x[k+11],S33,0x6D9D6122);b=HH(b,c,d,a,x[k+14],S34,0xFDE5380C);a=HH(a,b,c,d,x[k+1],S31,0xA4BEEA44);d=HH(d,a,b,c,x[k+4],S32,0x4BDECFA9);c=HH(c,d,a,b,x[k+7],S33,0xF6BB4B60);b=HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);a=HH(a,b,c,d,x[k+13],S31,0x289B7EC6);d=HH(d,a,b,c,x[k+0],S32,0xEAA127FA);c=HH(c,d,a,b,x[k+3],S33,0xD4EF3085);b=HH(b,c,d,a,x[k+6],S34,0x4881D05);a=HH(a,b,c,d,x[k+9],S31,0xD9D4D039);d=HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);c=HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);b=HH(b,c,d,a,x[k+2],S34,0xC4AC5665);a=II(a,b,c,d,x[k+0],S41,0xF4292244);d=II(d,a,b,c,x[k+7],S42,0x432AFF97);c=II(c,d,a,b,x[k+14],S43,0xAB9423A7);b=II(b,c,d,a,x[k+5],S44,0xFC93A039);a=II(a,b,c,d,x[k+12],S41,0x655B59C3);d=II(d,a,b,c,x[k+3],S42,0x8F0CCC92);c=II(c,d,a,b,x[k+10],S43,0xFFEFF47D);b=II(b,c,d,a,x[k+1],S44,0x85845DD1);a=II(a,b,c,d,x[k+8],S41,0x6FA87E4F);d=II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);c=II(c,d,a,b,x[k+6],S43,0xA3014314);b=II(b,c,d,a,x[k+13],S44,0x4E0811A1);a=II(a,b,c,d,x[k+4],S41,0xF7537E82);d=II(d,a,b,c,x[k+11],S42,0xBD3AF235);c=II(c,d,a,b,x[k+2],S43,0x2AD7D2BB);b=II(b,c,d,a,x[k+9],S44,0xEB86D391);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD);}
var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase();};mod.filter('gravatar',[function(){return function(email,size){if(!size){size=80;}
if(email){return"//www.gravatar.com/avatar/"+MD5(email.toLowerCase())+"?d=mm&s="+size;}else{return"//www.gravatar.com/avatar/00000000000000000000000000000000?d=mm&f=y&s="+size;}};}]);mod.filter('suggestTypeToIcon',function(){return function(type){switch(type){case'dataset':return'archive';default:return type;}};});mod.filter('eventClass',function(){return function(event){switch(event){case'add_dataset':return'add';case'edit_dataset':case'publish_dataset':case'unpublish_dataset':return'edit';case'delete_dataset':return'delete';default:return event;}};});mod.filter('event',['translate',function(translate){return function(event){switch(event){case'':return translate('Any');case'add_dataset':return translate('Add');case'edit_dataset':return translate('Edit');case'delete_dataset':return translate('Delete');case'publish_dataset':return translate('Publish');case'unpublish_dataset':return translate('Unpublish');default:return event;}};}]);mod.filter('toArray',function(){return function(dict){if(dict){return $.map(dict,function(v,k){return v;});}else{return[];}};});mod.filter('filterObject',function(){return function(dict,key){var filtered=angular.copy(dict);if(!angular.isArray(key)){key=[key];}
for(var i=0;i<key.length;i++){delete(filtered[key[i]]);}
return filtered;};});mod.filter('listFilter',[function(){return function(inputList,filterList){if(!inputList){return'';}
if(!filterList){return inputList;}
Array.prototype.diff=function(a){return this.filter(function(i){return(a.indexOf(i)<0);});};return inputList.filter(function(i){return(filterList.indexOf(i)<0);});};}]);mod.filter('vizConfig',function(){return function(dataset,fieldConfigName){if(dataset.extra_metas&&dataset.extra_metas.visualization&&dataset.extra_metas.visualization[fieldConfigName]){return dataset.extra_metas.visualization[fieldConfigName];}
return null;};});mod.filter('hasFacet',function(){return function(dataset){if(dataset){dataset=new ODS.Dataset(dataset);return dataset.hasFacet();}
return false;};});mod.filter('hasFieldType',function(){return function(dataset,fieldType){if(angular.isObject(dataset)){dataset=new ODS.Dataset(dataset);return dataset.hasFieldType(fieldType);}
return false;};});mod.filter('countFieldType',function(){return function(dataset,fieldType){if(dataset){dataset=new ODS.Dataset(dataset);return dataset.countFieldType(fieldType);}
return 0;};});mod.filter('countFieldTypes',function(){return function(dataset,fieldType){if(dataset){dataset=new ODS.Dataset(dataset);return dataset.countFieldTypes(fieldType);}
return 0;};});$.objectDiff=function(a,b,c){c={};try{$.each([a,b],function(index,obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){if(typeof obj[prop]==="object"&&obj[prop]!==null){c[prop]=$.objectDiff(a[prop],b[prop],c);}
else{if(a===undefined)a={};if(b===undefined)b={};if(a[prop]!==b[prop]){c[prop]=[a[prop],b[prop]];}}}}});}catch(e){console.error(e);}
return c;};mod.filter('diff',function(){return function(a,b){return $.objectDiff(a,b);};});mod.filter('range',function(){return function(input){var lowBound,highBound;switch(input.length){case 1:lowBound=0;highBound=parseInt(input[0],10)-1;break;case 2:lowBound=parseInt(input[0],10);highBound=parseInt(input[1],10);break;default:return input;}
var result=[];for(var i=lowBound;i<=highBound;i++)
result.push(i);return result;};});mod.filter('startsWith',function(){return function(input,searchedString){return ODS.StringUtils.startsWith(input,searchedString);};});mod.filter('displayedRefines',['translate',function(translate){return function(searchOptions){var displayedRefines={};$.each(searchOptions,function(key,value){if(key=='q'){displayedRefines[translate('query')]=value;}
if(key.slice(0,7)=='refine.'){if(angular.isArray(value)){displayedRefines[key.slice(7)]=value.join(', ');}else{displayedRefines[key.slice(7)]=value;}}});return displayedRefines;};}]);mod.filter('currentLanguage',['config',function(config){return function(language){return language.toLowerCase()==config.LANGUAGE;};}]);mod.filter('siPrefixFormat',['$filter',function($filter){return function(number){if(number>=1000000){return $filter('number')(number/1000000,0)+'M';}else if(number>=10000){return $filter('number')(number/1000,0)+'k';}else if(number>=1000){return $filter('number')(number/1000,1)+'k';}else{return $filter('number')(number,0);}};}]);mod.filter('min',function(){return function(n1,n2){return Math.min(n1,n2);};});mod.filter('max',function(){return function(n1,n2){return Math.max(n1,n2);};});mod.filter('isPositiveNumber',function(){return function(input){if(angular.isNumber(input)&&isFinite(input)&&input>=0){return true;}else{return false;}};});mod.filter('incrementBound',function(){return function(firstBound){if(angular.isDefined(firstBound)&&firstBound!==""){return ODS.CalculationUtils.incrementByOneUnit(firstBound);}else{return null;}};});mod.filter('encodeURIComponent',['$window',function($window){return $window.encodeURIComponent;}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.service('ColorHelper',['translate',function(translate_color){var PI2=Math.PI*2,PIp180=Math.PI/180,validHexColor=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;return{HexToRGB:function(hex){if(hex.startsWith("#")){hex=hex.substring(1);}
return[parseInt(hex.substring(0,2),16),parseInt(hex.substring(2,4),16),parseInt(hex.substring(4,6),16)];},RGBToHex:function(r,g,b){return("#"+((1<<24)+
(Math.round(r)<<16)+
(Math.round(g)<<8)+
Math.round(b)).toString(16).slice(1)).toUpperCase();},RGBToHSV:function(r,g,b){r/=255;g/=255;b/=255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max==min){h=0;}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return[h,s,v];},HSVToRGB:function(h,s,v){h*=6;var i=~~h,f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod]*255,g=[t,v,v,q,p,p][mod]*255,b=[p,p,t,v,v,q][mod]*255;r=~~r;g=~~g;b=~~b;return[r,g,b,"rgb("+r+","+g+","+b+")"];},RGBToXYV:function(red,green,blue,radius){var hsv=this.RGBToHSV(red,green,blue),width=radius*2,phi,r,x,y;hsv[0]=hsv[0]*360;r=radius*hsv[1];phi=hsv[0]*PIp180;x=radius+r*Math.cos(phi);y=radius+r*Math.sin(phi);return[Math.round(width-x),Math.round(width-y),hsv[2]];},XYToHS:function(x,y,radius){x=x-radius;y=y-radius;var theta=Math.atan2(y,x),d=x*x+y*y;if(d>radius*radius){x=radius*Math.cos(theta);y=radius*Math.sin(theta);theta=Math.atan2(y,x);d=x*x+y*y;}
return[(theta+Math.PI)/PI2,Math.sqrt(d)/radius];},isValidHexColor:function(hex){if(!hex){return false;}
hex=hex.trim();return validHexColor.test(hex);},formatHexColor:function(hex){if(!hex){return;}
hex=hex.trim();if(!hex.startsWith("#")){hex="#"+hex;}
if(!this.isValidHexColor(hex)){return;}
return hex.toUpperCase();},shortToLongHexColor:function(hex){hex=hex.trim();if(!hex.startsWith("#")){hex="#"+hex;}
if(hex.length==7){return hex;}else if(hex.length<4){return null;}
return hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3];},isDarkColor:function(red,green,blue){var brightness;brightness=(red*299)+(green*587)+(blue*114);brightness=brightness/255000;if(brightness>=0.5){return false;}else{return true;}},loadWheel:function(radius,pixels,value){var i=0,radiusSquared=radius*radius,diameter=radius*2;for(var y=0;y<diameter;y++){for(var x=0;x<diameter;x++){var rx=x-radius,ry=y-radius,d=rx*rx+ry*ry,rgb=this.HSVToRGB((Math.atan2(ry,rx)+Math.PI)/PI2,Math.sqrt(d)/radius,value/100);pixels[i++]=rgb[0];pixels[i++]=rgb[1];pixels[i++]=rgb[2];pixels[i++]=d>radiusSquared?0:255;}}},niceColors:[[[translate_color('Black'),'#000000',''],[translate_color('Dark grey'),'#555555',''],[translate_color('Light grey'),'#AAAAAA',''],[translate_color('White'),'#FFFFFF','lightgrey'],],[[translate_color('Dark slate'),'#2C3F56',''],[translate_color('Medium slate'),'#6D7A87',''],[translate_color('Light slate'),'#969FAA',''],[translate_color('Pale slate'),'#C0C5CC','']],[[translate_color('Dark green'),'#19630A',''],[translate_color('Medium green'),'#64905C',''],[translate_color('Light green'),'#8FAF89',''],[translate_color('Pale green'),'#BCD0B8',''],],[[translate_color('Dark oil'),'#00757E',''],[translate_color('Medium oil'),'#5D9FA3',''],[translate_color('Light oil'),'#8ABABE',''],[translate_color('Pale oil'),'#B8D5D8',''],],[[translate_color('Dark blue'),'#0B72B5',''],[translate_color('Medium blue'),'#619FC8',''],[translate_color('Light blue'),'#8EBAD8',''],[translate_color('Pale blue'),'#BBD5E7',''],],[[translate_color('Dark royal blue'),'#263892',''],[translate_color('Medium royal blue'),'#6A79B0',''],[translate_color('Light royal blue'),'#939EC6',''],[translate_color('Pale royal blue'),'#BEC5DC',''],],[[translate_color('Dark purple'),'#5A1887',''],[translate_color('Medium purple'),'#8A65A9',''],[translate_color('Light purple'),'#AB90C1',''],[translate_color('Pale purple'),'#CDBCD9',''],],[[translate_color('Dark fuchsia'),'#93117E',''],[translate_color('Medium fuchsia'),'#B060A3',''],[translate_color('Light fuchsia'),'#C78DBD',''],[translate_color('Pale fuchsia'),'#DDBBD7',''],],[[translate_color('Dark cherry'),'#BA022A',''],[translate_color('Medium cherry'),'#CB516D',''],[translate_color('Light cherry'),'#D98396',''],[translate_color('Pale cherry'),'#E8B4C0',''],],[[translate_color('Dark vermilion'),'#E5352D',''],[translate_color('Medium vermilion'),'#E87273',''],[translate_color('Light vermilion'),'#EE9A9A',''],[translate_color('Pale vermilion'),'#F5C2C2',''],],[[translate_color('Dark orange'),'#FA8C44',''],[translate_color('Medium orange'),'#F7AD84',''],[translate_color('Light orange'),'#F9C4A7',''],[translate_color('Pale orange'),'#FCDCCA',''],],[[translate_color('Dark yellow'),'#F8B334',''],[translate_color('Medium yellow'),'#F7C87E',''],[translate_color('Light yellow'),'#F9D7A2',''],[translate_color('Pale yellow'),'#FBE6C6',''],],],};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.service('FlashService',function(){var counter=0;return{flashes:[],send:function(flash){var self=this;if(angular.isString(flash)){flash={type:'info',content:flash,isDismissible:true,onDismiss:null,};}
if(!flash.type){flash.type='info';}
if(!angular.isDefined(flash.isDismissible)){flash.isDismissible=true;}
flash.id=counter++;flash.dismiss=function(){self.dismiss(flash);};this.flashes.push(flash);return flash;},dismiss:function(flash){if(!flash.isDismissible){return;}
var i=this.flashes.length;while(i--){if(this.flashes[i].id===flash.id){this.flashes.splice(i,1);}}
if(angular.isFunction(flash.onDismiss)){flash.onDismiss();}},sendSuccess:function(flash){if(angular.isString(flash)){flash={type:'success',content:flash};}else{flash.type='success';}
return this.send(flash);},sendInfo:function(flash){if(angular.isString(flash)){flash={type:'info',content:flash};}else{flash.type='info';}
return this.send(flash);},sendWarning:function(flash){if(angular.isString(flash)){flash={type:'warning',content:flash};}else{flash.type='warning';}
return this.send(flash);},sendDanger:function(flash){if(angular.isString(flash)){flash={type:'danger',content:flash};}else{flash.type='danger';}
return this.send(flash);}};});})();;(function(){"use strict";var mod=angular.module('ods.core');mod.factory('odsBindModelToScope',function(){return function(scope,ngModelCtrl){ngModelCtrl.$render=function(){scope.model=angular.copy(ngModelCtrl.$viewValue);};scope.$watch('model',function(){ngModelCtrl.$setViewValue(scope.model);},true);};});mod.factory('odsFormInputHelper',['$parse',function($parse){var isStateFunction=function(state){var ngState='ng'+state.charAt(0).toUpperCase()+state.slice(1);return function(scope,attrs){return!!(ngState in attrs&&$parse(attrs[ngState])(scope.$parent));};};var isReadonly=isStateFunction('readonly');var isDisabled=isStateFunction('disabled');return{isReadonly:isReadonly,isDisabled:isDisabled};}]);mod.factory('odsBindInputStateToScope',['odsFormInputHelper',function(odsFormInputHelper){return function(scope,attrs){scope.$watch(function(){return[odsFormInputHelper.isDisabled(scope,attrs),odsFormInputHelper.isReadonly(scope,attrs)];},function(nv){scope.disabled=nv[0];scope.readonly=nv[1];},true);};}]);mod.factory('odsCompileAndReplace',['$compile',function($compile){return function(scope,element,template){var newElement=angular.element(template);element.replaceWith(newElement);$compile(newElement)(scope);return newElement;};}]);mod.factory('odsCustomInputHelper',function(){return{getAndResetNgModelOptions:function(ngModelOptionsCtrl){var ngModelOptions={};if(ngModelOptionsCtrl&&ngModelOptionsCtrl.$options){ngModelOptions=angular.copy(ngModelOptionsCtrl.$options);for(var key in ngModelOptionsCtrl.$options){if(ngModelOptionsCtrl.$options.hasOwnProperty(key)){delete ngModelOptionsCtrl.$options[key];}}
ngModelOptionsCtrl.$options.updateOnDefault=true;}
if(ngModelOptions.updateOnDefault){if(ngModelOptions.updateOn){ngModelOptions.updateOn+=' default';}else{ngModelOptions.updateOn='default';}}
if(!ngModelOptions.debounce){ngModelOptions.debounce={};}
return ngModelOptions;},setMainControlDirty:function(formCtrl,name){if(formCtrl&&name&&formCtrl[name]){formCtrl[name].$setDirty();}}};});mod.factory('odsCustomInput',['odsBindInputStateToScope','odsCompileAndReplace',function(odsBindInputStateToScope,odsCompileAndReplace){return function(scope,element,attrs,template){odsBindInputStateToScope(scope,attrs);return odsCompileAndReplace(scope,element,template);};}]);mod.factory('odsMultiInputHelper',['$timeout','odsCustomInputHelper','$rootScope',function($timeout,odsCustomInputHelper,$rootScope){return{setupNewValue:function(scope,element,formCtrl,insertAtEnd){scope.addNewValue=function(){if(!scope.newValue){return;}
if(scope.values.indexOf(scope.newValue)===-1){if(insertAtEnd){scope.values.push(scope.newValue);}else{scope.values.unshift(scope.newValue);}
scope.newValue='';}else{formCtrl[scope.name+'-new'].$setValidity('unique',false);}
$timeout(function(){element.find('.ods-form__control')[0].focus();});};var validate=function(){if(!scope.newValue||scope.values.indexOf(scope.newValue)===-1){formCtrl[scope.name+'-new'].$setValidity('unique',true);}};scope.$watch('newValue',validate);scope.$watch('values',validate,true);scope.onNewValueKeyDown=function(event){if(event.keyCode===13){scope.addNewValue();}};},setupSingleValues:function(scope,element,removeDelay){scope.disabledValue={};scope.removeValue=function(index){scope.disabledValue[index]=true;$timeout(function(){scope.values.splice(index,1);scope.disabledValue[index]=false;},angular.isDefined(removeDelay)?removeDelay:300);};scope.onKeyDown=function(event,index){if(event.keyCode===13){if(index<scope.values.length-1){$(element).find('input')[index+2].focus();}else{$(element).find('input')[0].focus();}}
if(event.keyCode===8&&event.target.value===''){scope.removeValue(index);event.preventDefault();}};},setupNgModel:function(scope,element,ngModelCtrl,formCtrl){ngModelCtrl.$render=function(){scope.values=angular.copy(ngModelCtrl.$viewValue)||[];scope.newValue='';};var buildRemoveFunction=function(index){var remove=function(){if(scope.values[index]){return;}
if(!$(element.find('input')[index+1]).is(':focus')){scope.removeValue(index);}else{$timeout(remove,100);}};return remove;};scope.$watch('values',function(nv,ov){if(angular.equals(nv,ov)){return;}
var valid=true;var i;for(i=nv.length-1;i>=0;i--){if(!nv[i]){var removeIfNotFocus=buildRemoveFunction(i);removeIfNotFocus();}}
if(nv.length===ov.length){var modified;for(i=0;i<nv.length;i++){if(nv[i]!==ov[i]){modified=i;}}
if(nv.indexOf(nv[modified])<modified||nv.indexOf(nv[modified],modified+1)>-1){formCtrl[scope.name+modified].$setValidity('unique',false);valid=false;}}
if(valid){for(i=0;i<nv.length;i++){if(nv.indexOf(nv[i],i+1)>-1){valid=false;break;}}}
if(valid){for(i=0;i<nv.length;i++){if(formCtrl[scope.name+i]){formCtrl[scope.name+i].$setValidity('unique',true);}}
odsCustomInputHelper.setMainControlDirty(formCtrl,scope.name);ngModelCtrl.$setViewValue(angular.copy(nv));}else{$rootScope.$broadcast(scope.id,{event:'save',status:'error'});}},true);}};}]);}());;(function(){"use strict";var mod=angular.module('ods.core');var ODSMimeType=function(mimetypeAsString){this.type=undefined;this.subtype=undefined;this.extension=undefined;mimetypeAsString=mimetypeAsString?mimetypeAsString.toLowerCase():'*/*';if(mimetypeAsString.indexOf('.')===0){this.extension=mimetypeAsString.substr(1);}else{var elements=mimetypeAsString.split('/');this.type=elements[0];this.subtype=(this.type!=='*'&&elements[1])||'*';}
this.match=function(file){if(this.type==='*'){return true;}
if(this.extension){var extension=file.name.toLowerCase().split('.').pop();return this.extension===extension;}
var mimetype=new ODSMimeType(file.type);return this.type===mimetype.type&&(this.subtype===mimetype.subtype||this.subtype==='*');}};var ODSMimeTypeChecker=function(mimetypesAsString){this.mimetypes=[];var that=this;mimetypesAsString=mimetypesAsString||'';angular.forEach(mimetypesAsString.split(/\s*,\s*/),function(mimetypeAsString){that.mimetypes.push(new ODSMimeType(mimetypeAsString));});this.match=function(file){if(!this.mimetypes.length){return true;}
return this.mimetypes.some(function(mimetype){return mimetype.match(file);})};};mod.factory('ODSMimeType',function(){return ODSMimeType;});mod.factory('ODSMimeTypeChecker',function(){return ODSMimeTypeChecker;});}());;(function(){'use strict';var mod=angular.module('ods.core');mod.factory('PickerHelper',[function(){return{positionPicker:function(callerElement,pickerElement){var windowWidth=this._getWidth(window);var caller=this._getCallerPosition(callerElement);var picker=this._getPickerPosition(pickerElement);var hasSpace=this.getAvailableSpace(callerElement,pickerElement);var pickerArrowElement=pickerElement.find('.ods-picker__arrow');var pickerArrowClass;if(hasSpace.top){pickerArrowClass='ods-picker__arrow--bottom';if(caller.offset.left<windowWidth/2){picker.offset.left=caller.offset.left;}else{picker.offset.left=caller.offset.left+caller.width-picker.width;}
picker.offset.top=caller.offset.top-picker.height-10;this._setArrowDirection(pickerArrowElement,pickerArrowClass,true);this._setArrowXOffset(pickerArrowElement,picker,caller);this._setPosition(pickerElement,picker);}else if(hasSpace.bottom){pickerArrowClass='ods-picker__arrow--top';if(caller.offset.left<windowWidth/2){picker.offset.left=caller.offset.left;}else{picker.offset.left=caller.offset.left+caller.width-picker.width;}
picker.offset.top=caller.offset.top+caller.height+8;this._setArrowDirection(pickerArrowElement,pickerArrowClass);this._setArrowXOffset(pickerArrowElement,picker,caller);this._setPosition(pickerElement,picker);}else if(hasSpace.right){pickerArrowClass='ods-picker__arrow--left';picker.offset.left=caller.offset.left+caller.width+10;picker.offset.top=caller.offset.top+(caller.height/2)-(picker.height/2)+10;this._setArrowDirection(pickerArrowElement,pickerArrowClass);this._setPosition(pickerElement,picker);}else if(hasSpace.left){pickerArrowClass='ods-picker__arrow--right';picker.offset.left=caller.offset.left-picker.width-10;picker.offset.top=caller.offset.top+(caller.height/2)-(picker.height/2)+10;this._setArrowDirection(pickerArrowElement,pickerArrowClass);this._setPosition(pickerElement,picker);}else{pickerArrowClass='ods-picker__arrow--hidden';picker.offset.top=0;picker.offset.left=0;this._setArrowDirection(pickerArrowElement,pickerArrowClass);this._setPosition(pickerElement,picker,'ods-picker--fullscreen');}},getAvailableSpace:function(callerElement,pickerElement){var documentHeight=this._getHeight(document),windowHeight=this._getHeight(window),windowWidth=this._getWidth(window);var pickerData=this._getPickerPosition(pickerElement);var callerData=this._getCallerPosition(callerElement);var availableSpaceWindow={'top':callerData.offset.top-$(document).scrollTop(),get bottom(){return windowHeight-this.top-callerData.height;}};var availableSpaceDocument={'top':callerData.offset.top,'bottom':documentHeight-callerData.offset.top-callerData.height};var availableSpaceHalfPicker={'top':availableSpaceDocument.top>pickerData.height/2,'bottom':availableSpaceDocument.bottom>pickerData.height/2};return{'top':availableSpaceWindow.top>pickerData.height+10,'left':(callerData.offset.left>pickerData.width)&&availableSpaceHalfPicker.top&&availableSpaceHalfPicker.bottom,'bottom':availableSpaceWindow.bottom>pickerData.height+10,'right':(windowWidth-callerData.offset.left-callerData.width)>pickerData.width&&availableSpaceHalfPicker.top&&availableSpaceHalfPicker.bottom};},_getPickerPosition:function(pickerElement){return{'height':this._getHeight(pickerElement),'width':this._getWidth(pickerElement),'offset':{}};},_getCallerPosition:function(callerElement){return{'height':this._getHeight(callerElement),'width':this._getWidth(callerElement),'offset':this._getOffset(callerElement)};},_getWidth:function(element){return jQuery(element).outerWidth();},_getHeight:function(element){return jQuery(element).outerHeight();},_getOffset:function(element){return jQuery(element).offset();},_setPosition:function(element,pickerData,classes){element.css('top',pickerData.offset.top);element.css('left',pickerData.offset.left);element.addClass(classes);},_setArrowDirection:function(element,classes){element.addClass(classes);},_setArrowXOffset:function(arrowElement,pickerData,callerButton){arrowElement.css('left',callerButton.offset.left-pickerData.offset.left+callerButton.width/2);arrowElement.css('right','auto');}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.factory('pollJobStatus',['ManagementAPIV2','$timeout',function(ManagementAPIV2,$timeout){var pollJobStatus=function(jobUuid,callback,delay){if(isNaN(delay)){delay=500;}
ManagementAPIV2.jobs.get(jobUuid).then(function(reqResponse){var response=reqResponse.data;if(response.state==='done'||response.state==='error'){callback(response);}else{$timeout(function(){pollJobStatus(jobUuid,callback,delay);},delay);}});};return pollJobStatus;}]);}());;function applied(fn,scope){if(fn.wrappedInApply){return fn;}
var wrapped=function(){var args=arguments;var phase=scope.$root.$$phase;if(phase==="$apply"||phase==="$digest"){return fn.apply(null,args);}else{return scope.$apply(function(){return fn.apply(null,args);});}};wrapped.wrappedInApply=true;return wrapped;}
function applyFunctions(obj,scope,propsConfig){return Object.keys(obj||{}).reduce(function(prev,key){var value=obj[key];var config=(propsConfig||{})[key]||{};prev[key]=angular.isFunction(value)&&config.wrapApply!==false?applied(value,scope):value;return prev;},{});}
function watchProps(watchDepth,scope,watchExpressions,listener){var supportsWatchCollection=angular.isFunction(scope.$watchCollection);var supportsWatchGroup=angular.isFunction(scope.$watchGroup);var watchGroupExpressions=[];watchExpressions.forEach(function(expr){var actualExpr=getPropExpression(expr);var exprWatchDepth=getPropWatchDepth(watchDepth,expr);if(exprWatchDepth==='collection'&&supportsWatchCollection){scope.$watchCollection(actualExpr,listener);}else if(exprWatchDepth==='reference'&&supportsWatchGroup){watchGroupExpressions.push(actualExpr);}else{scope.$watch(actualExpr,listener,(exprWatchDepth!=='reference'));}});if(watchGroupExpressions.length){scope.$watchGroup(watchGroupExpressions,listener);}}
function renderReactComponent(component,props,scope,elem,reactComponentFactoryInterface){scope.$evalAsync(function(){reactComponentFactoryInterface.render(component,props,elem[0]);});}
function getPropName(prop){return(Array.isArray(prop))?prop[0]:prop;}
function getPropConfig(prop){return(Array.isArray(prop))?prop[1]:{};}
function getPropExpression(prop){return(Array.isArray(prop))?prop[0]:prop;}
function findAttribute(attrs,propName){var index=Object.keys(attrs).filter(function(attr){return attr.toLowerCase()===propName.toLowerCase();})[0];return attrs[index];}
function getPropWatchDepth(defaultWatch,prop){var customWatchDepth=(Array.isArray(prop)&&angular.isObject(prop[1])&&prop[1].watchDepth);return customWatchDepth||defaultWatch;}
function renderReactComponentDirective(scope,elem,attrs,componentFactory,componentName,props,conf,injectableProps){var reactComponent=componentFactory.components[componentName];props=props||(Object.keys(reactComponent.propTypes||{}));if(!props.length){var ngAttrNames=[];angular.forEach(attrs.$attr,function(value,key){ngAttrNames.push(key);});props=ngAttrNames;}
var propExpressions=props.map(function(prop){return[attrs[getPropName(prop).toLowerCase()],getPropConfig(prop)];});var renderThisComponent=function(){var scopeProps={},config={};props.forEach(function(prop){var propName=getPropName(prop);scopeProps[propName]=scope.$eval(findAttribute(attrs,propName));config[propName]=getPropConfig(prop);});scopeProps=applyFunctions(scopeProps,scope,config);scopeProps=angular.extend({},scopeProps,injectableProps);renderReactComponent(reactComponent,scopeProps,scope,elem,componentFactory);};watchProps(attrs.watchDepth,scope,propExpressions,renderThisComponent);renderThisComponent();angular.forEach(attrs.$attr,function(value){elem.removeAttr(value);});scope.$on('$destroy',function(){componentFactory.unmountComponentAtNode(elem[0]);});}
angular.module('ods.core').factory('odsReactComponentFactory',['ReactComponentFactoryInterface',function reactComponentFactory(ReactComponentFactoryInterface){return function(componentName,props,conf,injectableProps){return{restrict:'E',priority:0,compile:function(tElem){tElem.attr('ng-non-bindable');return function(scope,elem,attrs){renderReactComponentDirective(scope,elem,attrs,ReactComponentFactoryInterface,componentName,props,conf,injectableProps);};},};};}]);;(function(){'use strict';var app=angular.module('ods.core');app.service('securityService',['$rootScope',function($rootScope){var security={};return{update:function(sec){security=sec;$rootScope.$broadcast('securityDomainService',security);},retrieve:function(){return security;}};}]);app.factory('APIFileService',['$q','$rootScope','odsNotificationService',function($q,$rootScope,odsNotificationService){function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!==''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}
return function(url,file,callback,extraData){var deferred=$q.defer();var xhr=new XMLHttpRequest();xhr.upload.addEventListener("progress",callback,false);xhr.addEventListener("load",function(e){var target=e.target||e.srcElement;if(target.status==200){deferred.resolve(target.response);}else{deferred.reject(e);}
$rootScope.$apply();},false);xhr.addEventListener("error",function(e){deferred.reject(e);$rootScope.$apply();},false);xhr.open("POST",url);xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.setRequestHeader('X-CSRFToken',getCookie('csrftoken'));xhr.setRequestHeader('ODS-UI',"true");var formdata=new FormData();formdata.append("file",file);if(extraData){angular.forEach(extraData,function(value,key){if(value){formdata.append(key,value);}});}
xhr.send(formdata);return deferred.promise.then(function(reason){return reason;},function(reason){try{var data=angular.fromJson(reason.target.responseText);if(data){odsNotificationService.sendNotification(data);}}catch(err){}
return $q.reject(reason);});};}]);app.factory("APIXHRService",["$http","$window","odsNotificationService","odsHttpErrorMessages","odsNetworkErrorMessages",function($http,$window,odsNotificationService,odsHttpErrorMessages,odsNetworkErrorMessages){return function(method,url,data,customHeaders,timeout){var headers={"Content-Type":"application/json","ODS-UI":"true"};if(customHeaders){angular.extend(headers,customHeaders);}
data=data||{};var options={method:method,url:url,headers:headers,cache:false};if(timeout){options.timeout=timeout;}
if(method=='GET'){options.params=data;}else{options.data=data;}
var request=$http(options);request.catch(function(response){var data=response.data;var status=response.status;if(status===-1){if(response.xhrStatus==='abort'){return;}
if($window.navigator&&$window.navigator.onLine!==undefined&&!$window.navigator.onLine){response.xhrStatus='offline';}
data={title:'Network Error',type:'error',message:odsNetworkErrorMessages.getForXHRStatus(response.xhrStatus)};}else if(typeof data==='string'||!data){data={title:'Unexpected Error',type:'error',message:odsHttpErrorMessages.getForStatus(status),};}
data._request=request;if(data.error_key==="InvalidManagementAPIRequestException"&&data.errors.length>0){odsNotificationService.sendNotification({title:data.message,type:'error',message:data.errors[0].message});}else{odsNotificationService.sendNotification(data);}});return request;};}]);app.factory("ManagementAPI",["APIFileService","APIXHRService","$q","$rootScope",'config','odsNotificationService',function(APIFileService,APIXHRService,$q,$rootScope,config,odsNotificationService){var API_PATH='/api/management/1.0/';var assetUrlToFileName=function(url){if(url.indexOf('/')>-1){url=url.split('/')[url.split('/').length-1];}
return url;};return{'support':function(options){return APIXHRService("POST",API_PATH+"support/",options);},'charts':{'new':function(title,chartData){return APIXHRService("POST",API_PATH+"charts/",{'title':title,'value':chartData});},'list':function(){return APIXHRService("GET",API_PATH+"charts/",{});},'lookup':function(chartId){return APIXHRService("GET",API_PATH+"charts/"+chartId+'/',{});},'update':function(chartId,title,chartData){return APIXHRService("POST",API_PATH+"charts/"+chartId+'/',{'title':title,'value':chartData});},'delete':function(chartId){return APIXHRService("DELETE",API_PATH+"charts/"+chartId+'/',{});}},'map':{save:function(mapid,title,value){return APIXHRService("POST",API_PATH+"map/save/",{'mapid':mapid,'title':title,'values':value});},'delete':function(mapid){return APIXHRService("POST",API_PATH+"map/delete/"+mapid+"/");},list:function(){return APIXHRService("GET",API_PATH+"map/");}},'users_suggest':function(options){return APIXHRService("GET",API_PATH+"domain/users/suggest/",options);},'domain':{'get':function(){return APIXHRService("GET",API_PATH+"domain/",{});},'update':function(updatedProperties){return APIXHRService("POST",API_PATH+"domain/update/",updatedProperties);},'groups':function(options){return APIXHRService("GET",API_PATH+"groups/",options);},'pages':function(){return APIXHRService("GET",API_PATH+'domain/pages/available',{});},'security':{'get':function(){return APIXHRService("GET",API_PATH+"security/",{});},'save':function(security){return APIXHRService("POST",API_PATH+"security/",security);}},license:{'status':function(){return APIXHRService('GET',API_PATH+'domain/license/');}},accessrequests:{'list':function(){return APIXHRService("GET",API_PATH+"domain/accessrequests/");},'resolve':function(user_id,is_accepted,reason){return APIXHRService("POST",API_PATH+"domain/accessrequests/",{user_id:user_id,is_accepted:is_accepted,reason:reason});}},'supported_processors':function(){return APIXHRService("GET",API_PATH+"domain/supported_processors/",{});}},domain_theme:{'save':function(theme){return APIXHRService("POST",API_PATH+"domain_theme/",theme);},'get':function(version){return APIXHRService("GET",API_PATH+"domain_theme/"+version+'/');},'make_live':function(version){return APIXHRService("POST",API_PATH+"domain_theme/"+version+"/make_live/");},'get_apikey':function(){return APIXHRService("GET",API_PATH+"domain_theme/apikey/");},'regenerate_apikey':function(){return APIXHRService("POST",API_PATH+"domain_theme/apikey/");}},'external_service_check':function(parameters){return APIXHRService("POST",API_PATH+"domain/verify_service_authentication",parameters);},'attachments':{'new':function(file,callback){return APIFileService(API_PATH+"attachments/",file,callback);}},'alternative_exports':{'new':function(file,callback){return APIFileService(API_PATH+"alternative_exports/",file,callback);}},'resources':{'supported_formats':function(){return APIXHRService("GET",API_PATH+"resources/supported_formats/",{});},},'datasets':{'list':function(options){if(!options){options={};}
return APIXHRService("GET",API_PATH+"datasets/",options);},'preview':function(dataset,nhits,timeout){nhits=nhits||10;return APIXHRService("POST",API_PATH+"datasets/preview/?nhits="+nhits,dataset,{},timeout);},'show':function(id){return APIXHRService("GET",API_PATH+"datasets/"+id+"/",{});},'show_remote':function(dataset){return APIXHRService("POST",API_PATH+"datasets/remote/",dataset);},'show_remote_unverified':function(federation_parameters){return APIXHRService("POST",API_PATH+"datasets/remote_unverified/",federation_parameters);},'save':function(dataset){return APIXHRService("POST",API_PATH+"datasets/",dataset);},'delete':function(dataset){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/delete/");},'status':function(dataset){return APIXHRService("GET",API_PATH+"datasets/"+dataset.id+"/status/",{});},'versions':function(dataset){return APIXHRService("GET",API_PATH+"datasets/"+dataset.id+"/versions/",{});},'publish':function(dataset){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/publish/",dataset);},'records_errors':function(dataset,nhits){nhits=nhits||100;return APIXHRService("GET",API_PATH+"datasets/"+dataset.id+"/records_errors/?nhits="+nhits);},'unpublish':function(dataset){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/unpublish/",dataset);},'rename':function(dataset,new_dataset_id){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/rename/",{new_dataset_id:new_dataset_id});},'copy':function(dataset){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/copy/",dataset);},'abort_publish':function(dataset){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/abort_publish/",dataset);},'security':{'get':function(dataset){return APIXHRService("GET",API_PATH+"datasets/"+dataset.id+"/security/",{});},'save':function(dataset,security){return APIXHRService("POST",API_PATH+"datasets/"+dataset.id+"/security/",security);}},'resources':{'update_file':function(dataset,resource,file,callback){return APIFileService(API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/update_file/",file,callback);},'enable':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/enable/",callback);},'disable':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/disable/",callback);},'scratchRecover':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/recover/scratch/",callback);},'reindexRecover':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/recover/",callback);},'cancelReindexRecover':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+"/resources/"+resource.id+"/recover/cancel/",callback);},'generateApiKey':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+'/resources/'+resource.id+'/api_keys/generate/',callback);},'getApiKeys':function(dataset,resource,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+'/resources/'+resource.id+'/api_keys/',callback);},'deleteApiKey':function(dataset,resource,key,callback){return APIXHRService("DELETE",API_PATH+'datasets/'+dataset.id+'/resources/'+resource.id+'/api_keys/'+key+'/',callback);},'renewAPIKey':function(dataset,resource,key,callback){return APIXHRService("GET",API_PATH+'datasets/'+dataset.id+'/resources/'+resource.id+'/api_keys/renew/'+key+'/',callback);},'cleanResourceCache':function(dataset,resource,key,callback){return APIXHRService("POST",API_PATH+'datasets/'+dataset.id+'/resources/'+resource.id+'/clean_cache/',callback);}},'processors_rewrite':function(renamed_field,processors,from_name,to_name){return APIXHRService("POST",API_PATH+"datasets/rename_processors/",{renamed_field:renamed_field,processors:processors,from_name:from_name,to_name:to_name});},'guess_processor_params':function(dataset){return APIXHRService("POST",API_PATH+"datasets/guess_processor_params/",dataset);},'snapshots':{'save':function(dataset_id,description){return APIXHRService("POST",API_PATH+"datasets/"+dataset_id+"/snapshots/",{description:description});},'list':function(dataset_id){return APIXHRService("GET",API_PATH+"datasets/"+dataset_id+"/snapshots/",{});},'delete':function(dataset_id,snapshot_id){return APIXHRService("POST",API_PATH+"datasets/"+dataset_id+"/snapshots/"+snapshot_id+"/delete/",{});}},'subscribers':{'list':function(dataset_id){return APIXHRService("GET",API_PATH+"datasets/"+dataset_id+"/subscribers/",{});},'notify':function(dataset_id,content){return APIXHRService("POST",API_PATH+"datasets/"+dataset_id+"/subscribers/notify/",content);}},},'harvest':{'get':function(harvest_id){return APIXHRService("GET",API_PATH+'harvesters/'+harvest_id+'/',{});},'list':function(){return APIXHRService("GET",API_PATH+"harvesters/list/",{});},'available_harvesters':function(){return APIXHRService("GET",API_PATH+"harvesters/available_harvesters/",{});},'update':function(harvesterparams){return APIXHRService("POST",API_PATH+'harvesters/update/',harvesterparams);},'del':function(harvest_id){return APIXHRService('GET',API_PATH+'harvesters/'+harvest_id+'/delete/',{});},'start':function(harvest_id){return APIXHRService('GET',API_PATH+'harvesters/'+harvest_id+'/start/',{});},'publish':function(harvest_id){return APIXHRService('GET',API_PATH+'harvesters/'+harvest_id+'/publish/',{});},'unpublish':function(harvest_id){return APIXHRService('GET',API_PATH+'harvesters/'+harvest_id+'/unpublish/',{});},'detach':function(harvest_id){return APIXHRService('GET',API_PATH+'harvesters/'+harvest_id+'/detach/',{});},'status':function(){return APIXHRService("GET",API_PATH+'harvesters/status/',{});},'abort':function(harvest_id){return APIXHRService("GET",API_PATH+'harvesters/'+harvest_id+'/abort/',{});}},'metadata_templates':{'get':function(language){if(language){return APIXHRService("GET",API_PATH+"metadata_templates/",{'lang':language});}else{return APIXHRService("GET",API_PATH+"metadata_templates/",{});}},'save':function(metadata_templates){return APIXHRService("POST",API_PATH+"metadata_templates/",metadata_templates);},},'datasets_index_filters':{'lookup':function(){return APIXHRService("GET",API_PATH+"datasets_index_filters/");},'update':function(datasets_index_filters){return APIXHRService("PUT",API_PATH+"datasets_index_filters/",{'datasets_index_filters':datasets_index_filters});}},'reuses':{'list':function(){return APIXHRService('GET',API_PATH+'reuses/',{});},'pending':function(){return APIXHRService('GET',API_PATH+'reuses/pending/',{});},'edit':function(reuse_id,data){return APIXHRService('POST',API_PATH+'reuses/'+reuse_id+'/edit/',data);},'edit_url':function(reuse_id){return API_PATH+'reuses/'+reuse_id+'/edit/';},'delete':function(reuse_id,data){return APIXHRService('POST',API_PATH+'reuses/'+reuse_id+'/delete/',{});},'accept':function(reuse_id){return APIXHRService('POST',API_PATH+'reuses/'+reuse_id+'/accept/',{});},'reject':function(reuse_id,data){return APIXHRService('POST',API_PATH+'reuses/'+reuse_id+'/reject/',data);}},'assets':{'upload':function(asset_name,file,callback,properties){return APIFileService(API_PATH+'assets/'+asset_name+'/',file,callback,{'meta':properties});},'uploadUrl':function(asset_name,filename){var url=API_PATH+'assets/'+asset_name+'/';if(filename){url+=assetUrlToFileName(filename)+'/';}
return url;},'remove':function(asset_name,filename){var url=API_PATH+'assets/'+asset_name+'/delete/';if(filename){url+=assetUrlToFileName(filename)+'/';}
return APIXHRService('POST',url);},'get':function(asset_name,filename){var url=API_PATH+'assets/'+asset_name+'/';if(filename){url+=assetUrlToFileName(filename)+'/';}
return APIXHRService('GET',url);}},subdomains:{list:function(){return APIXHRService('GET',API_PATH+'subdomains/',{});},create:function(subdomain){return APIXHRService('POST',API_PATH+'subdomains/',subdomain);},get:function(subdomainId){return APIXHRService('GET',API_PATH+'subdomains/'+subdomainId+'/',{});},'delete':function(subdomainId){return APIXHRService('DELETE',API_PATH+'subdomains/'+subdomainId+'/',{});},related_domains:function(subdomainId){return APIXHRService('GET',API_PATH+'subdomains/related_domains/',{});},quotas:{get:function(subdomainId){return APIXHRService('GET',API_PATH+'subdomains/'+subdomainId+'/quotas/');},update:function(subdomainId,quotas){return APIXHRService('POST',API_PATH+'subdomains/'+subdomainId+'/quotas/',quotas);}}}};}]);app.factory("ManagementAPIV2",["APIFileService","APIXHRService",function(APIFileService,APIXHRService){var API_PATH_V2='/api/management/v2/';var getGroupIDs=function(groups){var groupIDs=[];angular.forEach(groups,function(group){groupIDs.push(group.group_id);});return groupIDs;};var getQuota=function(quota){quota=quota||{};if(!isNullOrUndefined(quota.limit)&&!quota.unit){quota.unit='day';}else if(isNullOrUndefined(quota.limit)){quota={};}
return quota;};var getLimits=function(sourceLimits){if(!sourceLimits){return{};}
var limits={};angular.forEach(['max_datasets','max_records_by_dataset'],function(limitName){if(!isNullOrUndefined(sourceLimits[limitName])){limits[limitName]=sourceLimits[limitName];}});return limits;};var getBulkParameters=function(filters,ids){var parameters={'ids':ids};if(filters['search']){parameters['search']=filters['search'];}
return parameters;};var cleanObject=function(object,propertyList){var i;object=angular.copy(object);var keys=Object.keys(object);for(i=0;i<keys.length;i++){var key=keys[i];if(propertyList.indexOf(key)===-1){delete object[key];}}
for(i=0;i<propertyList.length;i++){if(!object.hasOwnProperty(propertyList[i])){object[propertyList[i]]=null;}}
return object;};return{'domain':{'get':function(){return APIXHRService('GET',API_PATH_V2+'domain/');}},'files':{'new':function(file,callback){return APIFileService(API_PATH_V2+"files/",file,callback);},'list':function(){return APIXHRService('GET',API_PATH_V2+'files/');}},'jobs':{'get':function(jobUuid){return APIXHRService('GET',API_PATH_V2+'jobs/'+jobUuid);}},'datasets':{'abort':function(datasetUUID){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUUID+'/abort/');},'attachments':{'delete':function(datasetUID,attachmentUID){return APIXHRService('DELETE',API_PATH_V2+'datasets/'+datasetUID+'/attachments/'+attachmentUID);},'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/attachments/');},'new':function(datasetUID,fileURL){return APIXHRService('POST',API_PATH_V2+"datasets/"+datasetUID+'/attachments/',{url:fileURL});}},'changes':function(datasetUUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUUID+'/changes/');},'metadata':{'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/metadata/');},'get':function(datasetUID,metadataTemplateName,metadataName){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/metadata/'+metadataTemplateName+'/'+metadataName+'/');},'update':function(datasetUID,metadataTemplateName,metadataName,value,overrideRemoteValue){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUID+'/metadata/'+metadataTemplateName+'/'+metadataName+'/',{value:value,override_remote_value:overrideRemoteValue});}},'new':function(title){return APIXHRService('POST',API_PATH_V2+'datasets/',{metas:{default:{title:title}}});},'outputFields':{'get':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/output_fields/');}},'publish':function(datasetUUID){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUUID+'/publish/');},'restoreChange':function(datasetUUID,changeId){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUUID+'/restore_change/'+changeId+'/');},'resources':{'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/resources/');}},'security':{'accessPolicy':{'get':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/security/access_policy/');},'update':function(datasetUID,accessPolicy){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUID+'/security/access_policy/',JSON.stringify(accessPolicy));}},'default':{'get':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/security/default/');},'update':function(datasetUID,defaultSecurity){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUID+'/security/default/',defaultSecurity);}},'users':{'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/security/users/',{expand:'user'});},'new':function(datasetUID,ruleset){var data=cleanObject(ruleset,['permissions','visible_fields','is_data_visible','filter_query','api_calls_quota','user']);return APIXHRService('POST',API_PATH_V2+'datasets/'+datasetUID+'/security/users/',data);},'delete':function(datasetUID,username){return APIXHRService('DELETE',API_PATH_V2+'datasets/'+datasetUID+'/security/users/'+username+'/');},'update':function(datasetUID,username,ruleset){var data=cleanObject(ruleset,['permissions','visible_fields','is_data_visible','filter_query','api_calls_quota']);return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUID+'/security/users/'+username+'/',data);}},'groups':{'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/security/groups/',{expand:'group'});},'new':function(datasetUID,ruleset){var data=cleanObject(ruleset,['permissions','visible_fields','is_data_visible','filter_query','api_calls_quota','group']);return APIXHRService('POST',API_PATH_V2+'datasets/'+datasetUID+'/security/groups/',data);},'delete':function(datasetUID,group_id){return APIXHRService('DELETE',API_PATH_V2+'datasets/'+datasetUID+'/security/groups/'+group_id+'/');},'update':function(datasetUID,group_id,ruleset){var data=cleanObject(ruleset,['permissions','visible_fields','is_data_visible','filter_query','api_calls_quota']);return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUID+'/security/groups/'+group_id+'/',data);}}},'static_exports':{'delete':function(datasetUID,exportUID){return APIXHRService('DELETE',API_PATH_V2+'datasets/'+datasetUID+'/static_exports/'+exportUID)},'list':function(datasetUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUID+'/static_exports/');},'new':function(datasetUID,config){return APIXHRService('POST',API_PATH_V2+"datasets/"+datasetUID+'/static_exports/',config);}},'status':function(datasetUUID){return APIXHRService('GET',API_PATH_V2+'datasets/'+datasetUUID+'/status/',{expand:'datasetid'});},'unpublish':function(datasetUUID){return APIXHRService('PUT',API_PATH_V2+'datasets/'+datasetUUID+'/unpublish/');}},'users':{'list':function(searchParams){searchParams=searchParams||{};if(angular.isArray(searchParams.permissions)){searchParams.permissions=searchParams.permissions.join(',');}
if(!searchParams.permissions){delete searchParams.permissions;}
if(angular.isArray(searchParams.authentication_providers)){searchParams.authentication_providers=searchParams.authentication_providers.join(',');}
if(!searchParams.authentication_providers){delete searchParams.authentication_providers;}
return APIXHRService('GET',API_PATH_V2+'users/',searchParams);},'invite':function(emails){emails=angular.isString(emails)?[emails]:emails;return APIXHRService('POST',API_PATH_V2+'users/',{emails:emails});},'lookup':function(username){return APIXHRService('GET',API_PATH_V2+'users/'+username+'/',{});},'delete':function(username){return APIXHRService('DELETE',API_PATH_V2+'users/'+username+'/',{});},'update':function(username,userData){var user={permissions:userData.permissions||[],group_ids:userData.group_ids||getGroupIDs(userData.groups),quotas:getQuota(userData.quotas),limits:getLimits(userData.limits)};return APIXHRService('PUT',API_PATH_V2+'users/'+username+'/',user);},'removePermissions':function(username,permissions){if(angular.isString(permissions)){permissions=[permissions];}
return APIXHRService('DELETE',API_PATH_V2+'users/'+username+'/permissions/',{permissions:permissions});},'addPermissions':function(username,permissions){if(angular.isString(permissions)){permissions=[permissions];}
return APIXHRService('POST',API_PATH_V2+'users/'+username+'/permissions/',{permissions:permissions});},'removeFromGroups':function(username,group_ids){if(angular.isString(group_ids)){group_ids=[group_ids];}
return APIXHRService('DELETE',API_PATH_V2+'users/'+username+'/groups/',{group_ids:group_ids});},'addToGroups':function(username,group_ids){if(angular.isString(group_ids)){group_ids=[group_ids];}
return APIXHRService('POST',API_PATH_V2+'users/'+username+'/groups/',{group_ids:group_ids});}},'groups':{'list':function(){return APIXHRService('GET',API_PATH_V2+'groups/',{});},'new':function(title){return APIXHRService('POST',API_PATH_V2+'groups/',{title:title});},'lookup':function(groupId){return APIXHRService('GET',API_PATH_V2+'groups/'+groupId+'/',{});},'update':function(groupId,groupData){var group={title:groupData.title,permissions:groupData.permissions||[],quotas:getQuota(groupData.quotas),limits:getLimits(groupData.limits)};return APIXHRService('PUT',API_PATH_V2+'groups/'+groupId+'/',group);},'delete':function(groupId){return APIXHRService('DELETE',API_PATH_V2+'groups/'+groupId+'/',{});},'removePermissions':function(groupId,permissions){if(angular.isString(permissions)){permissions=[permissions];}
return APIXHRService('DELETE',API_PATH_V2+'groups/'+groupId+'/permissions/',{permissions:permissions});},'addPermissions':function(groupId,permissions){if(angular.isString(permissions)){permissions=[permissions];}
return APIXHRService('POST',API_PATH_V2+'groups/'+groupId+'/permissions/',{permissions:permissions});},'users':{'list':function(groupId,searchParams){searchParams=searchParams||{};return APIXHRService('GET',API_PATH_V2+'groups/'+groupId+'/users/',searchParams);},'new':function(groupId,usernames){usernames=angular.isArray(usernames)?usernames:[usernames];return APIXHRService('POST',API_PATH_V2+'groups/'+groupId+'/users/',{'usernames':usernames});},'delete':function(groupId,username){return APIXHRService('DELETE',API_PATH_V2+'groups/'+groupId+'/users/'+username+'/',{});}}},'accessRequests':{'list':function(){return APIXHRService('GET',API_PATH_V2+'access_requests/',{});},'approve':function(accessRequestId){return APIXHRService('PUT',API_PATH_V2+'access_requests/'+accessRequestId+'/approve/',{});},'reject':function(accessRequestId){return APIXHRService('PUT',API_PATH_V2+'access_requests/'+accessRequestId+'/reject/',{});}},'subdomains':{'list':function(searchParams){searchParams=searchParams||{};return APIXHRService('GET',API_PATH_V2+'subdomains/',searchParams);},'create':function(subdomain){return APIXHRService('POST',API_PATH_V2+'subdomains/',subdomain);},'get':function(subdomainId){return APIXHRService('GET',API_PATH_V2+'subdomains/'+subdomainId+'/',{});},'delete':function(subdomainId){return APIXHRService('DELETE',API_PATH+'subdomains/'+subdomainId+'/',{});},'update':function(subdomain){return APIXHRService('PUT',API_PATH_V2+'subdomains/'+encodeURIComponent(subdomain.id)+'/',subdomain);},'settings':{'get':function(){return APIXHRService('GET',API_PATH_V2+'subdomains/settings/',{});},'update':function(properties){return APIXHRService('POST',API_PATH_V2+'subdomains/settings/',properties);}},'bulk':{'pushContent':function(filters,subdomains,content){return APIXHRService('PATCH',API_PATH_V2+'subdomains/',Object.assign({},getBulkParameters(filters,subdomains),{'datasets':content['datasets']||[],'pages':content['pages']||[]}));},'delete':function(filters,subdomains){return APIXHRService('DELETE',API_PATH_V2+'subdomains/',getBulkParameters(filters,subdomains));}}},'pages':{'bulk':{'delete':function(search,pages){return APIXHRService('DELETE',API_PATH_V2+'pages/'+(search?'?search='+encodeURIComponent(search):''),pages);}},'get':function(slug){return APIXHRService('GET',API_PATH_V2+'pages/'+slug);},'list':function(searchParams){searchParams=searchParams||{};if(angular.isArray(searchParams.permissions)){searchParams.permissions=searchParams.permissions.join(',');}
if(!searchParams.permissions){delete searchParams.permissions;}
return APIXHRService('GET',API_PATH_V2+'pages/',searchParams);},'delete':function(pageId){return APIXHRService('DELETE',API_PATH_V2+'pages/'+pageId+'/',{});},create:function(page){return APIXHRService("POST",API_PATH_V2+'pages/',page);},'isValidTitle':function(title,language){var deferred=$q.defer();this.list().then(function(list){var valid=true;for(var i=0;i<list.length;i++){if(list[i].title[language]===title){valid=false;break;}}
deferred.resolve(valid);},function(reason){deferred.reject(reason);});return deferred.promise;},'groups':{'delete':function(slug,groupId){return APIXHRService('DELETE',API_PATH_V2+'pages/'+slug+'/security/groups/'+groupId);},'list':function(slug){return APIXHRService('GET',API_PATH_V2+'pages/'+slug+'/security/groups?expand=group');},'new':function(slug,groupId,permissions){return APIXHRService('POST',API_PATH_V2+'pages/'+slug+'/security/groups',{group:{group_id:groupId},permissions:permissions});},'update':function(slug,groupId,permissions){return APIXHRService('PUT',API_PATH_V2+'pages/'+slug+'/security/groups/'+groupId,{permissions:permissions});}},'save':function(pageId,page){return APIXHRService("PUT",API_PATH_V2+'pages/'+pageId+'/',page);},'users':{'delete':function(slug,username){return APIXHRService('DELETE',API_PATH_V2+'pages/'+slug+'/security/users/'+username);},'list':function(slug){return APIXHRService('GET',API_PATH_V2+'pages/'+slug+'/security/users?expand=user');},'new':function(slug,username,permissions){return APIXHRService('POST',API_PATH_V2+'pages/'+slug+'/security/users',{user:{username:username},permissions:permissions});},'update':function(slug,username,permissions){return APIXHRService('PUT',API_PATH_V2+'pages/'+slug+'/security/users/'+username,{permissions:permissions});}}},'harvesters':{'create':function(harvester){return APIXHRService('POST',API_PATH_V2+'harvesters/',harvester);},'preview':function(harvester_id,params){return APIXHRService('POST',API_PATH_V2+'harvesters/'+harvester_id+'/preview/',{params:params});},'start':function(harvester_id){return APIXHRService('PUT',API_PATH_V2+'harvesters/'+harvester_id+'/start/');},'publish':function(harvester_id){return APIXHRService('PUT',API_PATH_V2+'harvesters/'+harvester_id+'/publish/');},'unpublish':function(harvester_id){return APIXHRService('PUT',API_PATH_V2+'harvesters/'+harvester_id+'/unpublish/');},'errors':function(harvester_id){return APIXHRService('GET',API_PATH_V2+'harvesters/'+harvester_id+'/errors/');},'abort':function(harvester_id){return APIXHRService('PUT',API_PATH_V2+'harvesters/'+harvester_id+'/abort/');},'delete':function(harvester_id,delete_attached_datasets){return APIXHRService('DELETE',API_PATH_V2+'harvesters/'+harvester_id+'/?delete_attached_datasets='+delete_attached_datasets);},'update':function(harvester_id,harvester){harvester=angular.copy(harvester);delete harvester.status;delete harvester.has_errors;delete harvester.created_at;delete harvester.harvester_id;delete harvester.last_modified_by;delete harvester.last_modified_at;delete harvester.last_started_at;delete harvester.last_success_at;delete harvester.counters;delete harvester.errors;delete harvester.fetcher;return APIXHRService('PUT',API_PATH_V2+'harvesters/'+harvester_id+'/',harvester);},'types':function(){return APIXHRService('GET',API_PATH_V2+'harvester_types/');},'list':function(){return APIXHRService('GET',API_PATH_V2+'harvesters/');}},'authorizedMetadata':{'list':function(){return APIXHRService('GET',API_PATH_V2+'authorized_metadata/');}},'i18n':{'contexts':{'create':function(contextName,originalLanguage){return APIXHRService('POST',API_PATH_V2+'i18n/contexts/',{name:contextName,original_language:originalLanguage});},'get':function(contextName){return APIXHRService('GET',API_PATH_V2+'i18n/contexts/'+contextName+'/');},'save':function(contextName,context){return APIXHRService('POST',API_PATH_V2+'i18n/contexts/'+contextName+'/',context);}}}};}]);app.factory("AutomationAPI",["APIXHRService",function(APIXHRService){var API_PATH_V3='/api/automation/v1.0/';return{'domain':{'quota_usage':{'pages':function(){return APIXHRService('GET',API_PATH_V3+'domain/quota_usage/code_editor_pages/');},'datasize':function(){return APIXHRService('GET',API_PATH_V3+'domain/quota_usage/datasize/');},},},'datasets':{'publish':function(dataset_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/publish/');},'unpublish':function(dataset_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/unpublish/');},'abort':function(dataset_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/abort/');},'copy':function(dataset_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/copy/');},'feedbacks':{'list':function(dataset_uid,options){var isArchived=options.isArchived?1:0;var orderBy=options.orderBy?options.orderBy:'-created_at';var url=API_PATH_V3+'datasets/'+dataset_uid+'/feedbacks/?sort='+orderBy+'&is_archived='+isArchived
if(options.limit)url+='&limit='+options.limit;if(options.offset)url+='&offset='+options.offset;return APIXHRService('GET',url);},'archive':function(dataset_uid,feedback_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/feedbacks/'+feedback_uid+'/archive/');},},'resources':{'list':function(dataset_uid){return APIXHRService('GET',API_PATH_V3+'datasets/'+dataset_uid
+'/resources/?expand=datasource.connection&expand=datasource.dataset&limit=200');},},'versions':{'list':function(dataset_uid){return APIXHRService('GET',API_PATH_V3+'datasets/'+dataset_uid+'/versions/?order_by=-created_at');},'restore':function(dataset_uid,version_uid){return APIXHRService('POST',API_PATH_V3+'datasets/'+dataset_uid+'/versions/'+version_uid+'/restore/');}},'metadata':{'updateField':function(datasetUid,templateName,fieldName,payload){return APIXHRService('PUT',API_PATH_V3+'datasets/'+datasetUid+'/metadata/'+templateName+'/'+fieldName+'/',payload);},'deleteField':function(datasetUid,templateName,fieldName){return APIXHRService('DELETE',API_PATH_V3+'datasets/'+datasetUid+'/metadata/'+templateName+'/'+fieldName+'/');},}},'pages':{'archive':function(page_uid){return APIXHRService('POST',API_PATH_V3+'code_editor_pages/'+page_uid+'/archive/');},'unarchive':function(page_uid){return APIXHRService('POST',API_PATH_V3+'code_editor_pages/'+page_uid+'/unarchive/');},'sanitize':function(html){return APIXHRService('POST',API_PATH_V3+'code_editor_pages/sanitize/',html);},'metadata':{'update':function(page_uid,payload){return APIXHRService('PUT',API_PATH_V3+'code_editor_pages/'+page_uid+'/metadata/',payload)}}},'metadata_templates':{'get':function(params){if(!params){params={offset:0,limit:1000};}
params.include_asset_template=true;return APIXHRService('GET',API_PATH_V3+'metadata/templates/',params);}}};}]);app.factory("SearchAPI",["APIXHRService","config",function(APIXHRService,config){var API_PATH='/api/';var customHeaders={};var timezone=jstz.determine().name();var timezoneAwareOptions=function(options){options=options||{};options.timezone=timezone;return options;};return{setApplication:function(appName){customHeaders["ODS-API-Analytics-App"]=appName;},setCustomHeaders:function(headers){angular.extend(customHeaders,headers);},persist:{map:function(mapid,title,value){return APIXHRService("POST","/map"+API_PATH+"save/",{'mapid':mapid,'title':title,'values':value});}},datasets:{'lookup':function(datasetId,options){return APIXHRService("GET",API_PATH+'datasets/1.0/'+datasetId+'/',timezoneAwareOptions(options),customHeaders);},'search':function(options){return APIXHRService("GET",API_PATH+'datasets/1.0/search/',timezoneAwareOptions(options),customHeaders);},'attachmentURL':function(attachment){return API_PATH+'datasets/1.0/'+config.DATASET_ID+'/attachments/'+attachment.id+'/';},'feedback':function(datasetId,data){return APIXHRService('POST',API_PATH+'datasets/1.0/'+datasetId+'/feedback/',data);},},records:{'search':function(options){return APIXHRService("GET",API_PATH+'records/1.0/search/',timezoneAwareOptions(options),customHeaders);},'download':function(options){return APIXHRService("GET",API_PATH+'records/1.0/download/',timezoneAwareOptions(options),customHeaders);},'analyze':function(options){return APIXHRService("GET",API_PATH+'records/1.0/analyze/',timezoneAwareOptions(options),customHeaders);},'geo':function(options,timeout){return APIXHRService("GET",API_PATH+'records/1.0/geocluster/',timezoneAwareOptions(options),customHeaders,timeout);},'geopreview':function(options,timeout){return APIXHRService("GET",API_PATH+'records/1.0/geopreview/',timezoneAwareOptions(options),customHeaders,timeout);},'geopolygon':function(options,timeout){return APIXHRService("GET",API_PATH+'records/1.0/geopolygon/',timezoneAwareOptions(options),customHeaders,timeout);},'boundingbox':function(options,timeout){return APIXHRService("GET",API_PATH+'records/1.0/boundingbox/',timezoneAwareOptions(options),customHeaders,timeout);}},metadata:{'basic':function(){return APIXHRService("GET",API_PATH+'metadata/1.0/basic/',{},customHeaders);},'interop':function(){return APIXHRService("GET",API_PATH+'metadata/1.0/interop/',{},customHeaders);},'extra':function(){return APIXHRService("GET",API_PATH+'metadata/1.0/extra/',{},customHeaders);}},snapshots:{'list':function(dataset_id){return APIXHRService('GET',API_PATH+'datasets/1.0/'+dataset_id+'/snapshots/',{},customHeaders);}},services:{'list':function(dataset_id){return APIXHRService('GET',API_PATH+'datasets/1.0/'+dataset_id+'/services/',{},customHeaders);}},static_exports:{'list':function(dataset_id){return APIXHRService('GET',API_PATH+'explore/v2.1/catalog/datasets/'+dataset_id+'/static_exports/',{},customHeaders);}}};}]);app.factory('PlatformAPI',['APIXHRService','config',function(APIXHRService,config){var API_PATH='/api/platform/1.0/';return{domains:{'delete':function(domain){return APIXHRService('POST',API_PATH+'domains/'+domain.id+'/delete/'+domain);},'new':function(domain){return APIXHRService('POST',API_PATH+'domains/',domain);},'save':function(domain_id,isNew,domain,firstUser){return APIXHRService('POST',API_PATH+'domains/'+domain_id+'/',{'is_new':isNew,'domain':domain,'first_user':firstUser});},'get':function(domain_id){return APIXHRService('GET',API_PATH+'domains/'+domain_id+'/');},'statuses':function(){return APIXHRService('GET',API_PATH+'domains/statuses/',{});},'refresh':function(){return APIXHRService('POST',API_PATH+'domains/refresh/',{});},'idValidAndAvailable':function(domainId){return APIXHRService('GET',API_PATH+'domains/'+domainId+'/valid/');},inviteDomainContact:function(domainId){return APIXHRService('POST',API_PATH+'domains/'+domainId+'/invite_domain_contact/',{});},license:{'infos':function(){return APIXHRService('GET',API_PATH+'domains/license/');},},aliases:{'lookup':function(domainId){return APIXHRService('GET',API_PATH+'domains/'+domainId+'/enumerate_aliases/');}},url_rewrites:{'lookup':function(domainId){return APIXHRService('GET',API_PATH+'domains/'+domainId+'/enumerate_url_rewrites/');}},ip_whitelist:{'lookup':function(domainId){return APIXHRService('GET',API_PATH+'domains/'+domainId+'/enumerate_full_ip_whitelist/');}}},suggest:{'all':function(options){return APIXHRService('GET',API_PATH+'suggest/all/',options);}},resources:{'enumerate_extractors':function(){return APIXHRService("GET",API_PATH+"resources/enumerate_extractors/",{});},'enumerate_processors':function(){return APIXHRService("GET",API_PATH+"resources/enumerate_processors/",{});},'enumerate_harvesters':function(){return APIXHRService("GET",API_PATH+"resources/enumerate_harvesters/",{});}},user:{'save':function(user){return APIXHRService("POST",API_PATH+"user/",user);},'send_email':function(user){return APIXHRService("POST",API_PATH+"user/email/",user);},'suggest':function(options){return APIXHRService("GET",API_PATH+"user/suggest/",options);},'get':function(user_name){return APIXHRService("GET",API_PATH+"user/",{"id":user_name});}}};}]);app.factory("AccountAPI",["APIXHRService",function(APIXHRService){var API_PATH_V3='/api/account/v1.0/';return{apikeys:{'list':function(limit,offset){if(!limit){limit=100;}
if(!offset){offset=0;}
return APIXHRService('GET',API_PATH_V3+'apikeys/?limit='+limit+'&offset='+offset);},'delete':function(uid){return APIXHRService('DELETE',API_PATH_V3+'apikeys/'+uid);},'update':function(uid,body){return APIXHRService('PUT',API_PATH_V3+'apikeys/'+uid,body);},'create':function(body){if(!body){body={};}
return APIXHRService('POST',API_PATH_V3+'apikeys/',body);},},users:{me:{objectPermissions:function(){return APIXHRService('GET',API_PATH_V3+'users/me/object_permissions/');}}}};}]);app.factory('CoreAPI',['APIXHRService','config',function(APIXHRService,config){var API_PATH='/api/';return{'account':{'get':function(){return APIXHRService("GET",API_PATH+"account/",{});},'save_details':function(user){return APIXHRService("POST",API_PATH+"account/details/",user);},'save_password':function(pass){return APIXHRService("POST",API_PATH+"account/password/",pass);},'save_email':function(email){return APIXHRService("POST",API_PATH+"account/email/",{'new_email':email});},'quota':{'get':function(){return APIXHRService("GET",API_PATH+"account/quota/");}},'subscriptions':{'datasets':{'subscribe':function(datasetId){return APIXHRService("POST",API_PATH+"account/subscriptions/datasets/"+datasetId+"/subscribe/");},'unsubscribe':function(datasetId){return APIXHRService("POST",API_PATH+"account/subscriptions/datasets/"+datasetId+"/unsubscribe/");}},'notifications':{'list':function(){return APIXHRService("GET",API_PATH+"account/subscriptions/notifications/");},'subscribe':function(notificationName){return APIXHRService("POST",API_PATH+"account/subscriptions/notifications/"+notificationName+"/subscribe/");},'unsubscribe':function(notificationName){return APIXHRService("POST",API_PATH+"account/subscriptions/notifications/"+notificationName+"/unsubscribe/");}},'newsletter':{'get':function(){return APIXHRService("GET",API_PATH+"account/subscriptions/newsletter/");},'update':function(subscribed,language){return APIXHRService("POST",API_PATH+"account/subscriptions/newsletter/update/",{'is_subscribed':subscribed,'language':language});},}},'sso_identities':{'list':function(){return APIXHRService("GET",API_PATH+"account/identities/");},'revoke':function(identityId){return APIXHRService("DELETE",API_PATH+"account/identity/"+identityId+"/");}}},'oauth2':{'applications':{'list':function(){return APIXHRService("GET",API_PATH+"oauth2/applications/");},'add':function(application){return APIXHRService("POST",API_PATH+"oauth2/applications/",application);},'remove':function(applicationId){return APIXHRService("POST",API_PATH+"oauth2/applications/"+applicationId+"/remove/");}},'grants':{'list':function(){return APIXHRService("GET",API_PATH+"oauth2/grants/");},'revoke':function(applicationId){return APIXHRService("POST",API_PATH+"oauth2/grants/"+applicationId+"/revoke/");}}}};}]);app.factory('PageAPI',['APIXHRService','$q','config',function(APIXHRService){var API_PATH='/api/v2/pages/';return{contact:function(slug,data){return APIXHRService("POST",API_PATH+slug+'/contact/',data);},list:function(){return APIXHRService("GET",API_PATH,{});},lookup:function(slug){return APIXHRService("GET",API_PATH+slug,{});}};}]);app.factory('MapbuilderAPI',['APIXHRService','$q','config',function(APIXHRService){var API_PATH='/api/v2/mapbuilder/';return{create:function(data){return APIXHRService("POST",API_PATH,data);},save:function(mapId,data){return APIXHRService("PUT",API_PATH+mapId+'/',data);},get:function(mapId){return APIXHRService("GET",API_PATH+mapId+'/');},list:function(){return APIXHRService("GET",API_PATH);},'delete':function(mapId){return APIXHRService("DELETE",API_PATH+mapId+'/');}};}]);app.factory('ReuseAPI',['APIXHRService','config',function(APIXHRService,config){var API_PATH='/api/datasets/1.0/';return{'list':function(){return APIXHRService('GET',API_PATH+config.DATASET_ID+'/reuses/',{});},'save':function(data){return APIXHRService('POST',API_PATH+config.DATASET_ID+'/reuses/',data);},'save_url':API_PATH+config.DATASET_ID+'/reuses/'};}]);app.factory('CookiesAPI',['APIXHRService',function(APIXHRService){var API_PATH='/cookies/';return{consent:function(data){return APIXHRService('POST',API_PATH+'consent/',data);}};}]);app.factory('AssetHelper',['$q','odsNotificationService','APIFileService','translate',function($q,odsNotificationService,APIFileService,translate){var getFullMessage=function(message,extra){message=translate(message);return extra?message.substr(0,message.length-1)+' (max '+extra+')'+message.substr(message.length-1):message;};var getMaxDimensions=function(config){return config.max_width+'x'+config.max_height;};var getMaxSize=function(config){if(config.max_size>Math.pow(1024,2)){return Math.round(config.max_size/Math.pow(1024,2)*10)/10+' Mo';}
return Math.round(config.max_size/1024)+' Ko';};var sizeAllowed=function(config,file){return file.size<=config.max_size;};return{post:function(url,file,config,extraData,callback){var deferred=$q.defer();if(!file||(file&&sizeAllowed(config,file))){APIFileService(url,file,callback,extraData).then(function(data){data=angular.fromJson(data);deferred.resolve(data);},function(data){if(data.target.responseText){data=angular.fromJson(data.target.responseText);data.error=$.inArray(data.errorcode,[70001,70002])>=0?getFullMessage(data.error,getMaxDimensions(config)):getFullMessage(data.error);}else{data={errorcode:70000,error:translate('Unable to save your changes.')};}
deferred.reject(data);});}else{var data={errorcode:70000,error:getFullMessage(translate('The file you tried to upload exceeds the limit size.'),getMaxSize(config))};odsNotificationService.sendNotification(data);deferred.reject(data);}
return deferred.promise;}};}]);app.factory('LocationHelper',function(){return{delimiter:',',accuracy:5,formatLatLng:function(latLng){var lat=L.Util.formatNum(latLng.lat,this.accuracy);var lng=L.Util.formatNum(latLng.lng,this.accuracy);return new L.latLng(lat,lng);},getLocationParameterAsArray:function(location){return location.split(this.delimiter);},getLocationParameterFromMap:function(map){var center=this.formatLatLng(map.getCenter());return map.getZoom()+this.delimiter+center.lat+this.delimiter+center.lng;},getCenterFromLocationParameter:function(location){var a=this.getLocationParameterAsArray(location);return new L.latLng(a[1],a[2]);},getZoomFromLocationParameter:function(location){return this.getLocationParameterAsArray(location)[0];},serialize:function(center,zoom){center=this.formatLatLng(center);return zoom+this.delimiter+center.lat+this.delimiter+center.lng;}};});app.service('EPSG',function(){var list={'2154':'Lambert 93 France','3949':'RGF93 / CC49'};return{nameFromEPSG:function(epsg){if(angular.isDefined(list[epsg])){return list[epsg]+' (EPSG:'+epsg+')';}else{return'EPSG:'+epsg;}},registry:function(){return list;},list:function(){var result=[];angular.forEach(list,function(label,epsg){result.push({label:label,value:epsg});});return result;}};});app.service('MixpanelTrackEvent',function(){return{enabled:function(){return window.mixpanel;},track:function(eventName,properties,datasetId,options){if(window.mixpanel){if(datasetId)properties.datasetId=datasetId;try{window.mixpanel.track(eventName,properties,options);}catch(e){}}}}});}());;(function(){"use strict";var mod=angular.module("ods.core");mod.service('WidgetCodeBuilder',function(){function stringify(parameters){var params=angular.copy(parameters);var backlist=['tab','headless','hideTabs','location','dataChart','basemap'];for(var i=0;i<backlist.length;i++){if(params[backlist[i]]){delete params[backlist[i]];}}
return JSON.stringify(params).replace(/'/g,"\\'").replace(/"/g,"'");}
function indent(text,levels){if(angular.isUndefined(levels)){levels=1;}
var indentSpaces='';var i=0;for(i=0;i<levels;i++){indentSpaces+='    ';}
return text.replace(/^(?!$)/gm,indentSpaces);}
function prepareObjectForWidgetCode(obj){var json=JSON.stringify(obj);json=json.replace(/'/g,"\\'");json=json.replace(/([^\\])"/g,"$1'");json=json.replace(/\\"/g,'"');return json.replace(/"/g,'&quot;');}
function buildContextsCode(){var contexts=[];var contextsName=[];return{addContext:function(context,contextName){if(angular.isUndefined(contextName)){contextName=context.dataset.datasetid.replace(/[_@-]/g,'').replace(/^[0-9]+/,'');}
if(contextName===''){contextName='myctx';}
for(var i=0;i<contexts.length;i++){if(contexts[i].dataset.datasetid===context.dataset.datasetid&&contexts[i].domain===context.domain){var equals=true;angular.forEach(contexts[i].parameters,function(value,key){if(contexts[i].parameters[key]!==context.parameters[key]){equals=false;}});angular.forEach(context.parameters,function(value,key){if(contexts[i].parameters[key]!==context.parameters[key]){equals=false;}});if(equals){return contextsName[i];}}}
var j=0;var originalContextName=contextName;while(contextsName.indexOf(contextName)>=0){contextName=originalContextName+j;j++;}
contexts.push(context);contextsName.push(contextName);return contextName;},wrapInContextsCode:function(widgetCode){var code="<ods-dataset-context ",context,contextName;code+='context="'+contextsName.join(',')+'"';for(var i=0;i<contexts.length;i++){contextName=contextsName[i];context=contexts[i];code+=' '+contextName+'-dataset="'+context.dataset.datasetid+'"';if(context.domain){code+=' '+contextName+'-domain="'+context.domain+'"';}
if(context.parameters&&!isObjectEmpty(context.parameters)){code+=' '+contextName+'-parameters="'+stringify(context.parameters)+'"';}}
code+=">\n";return code+indent(widgetCode,1)+"\n</ods-dataset-context>";}};}
return{buildMediaWidgetCode:function(context,search_parameters){var contextsCodeBuilder=buildContextsCode(),widgetCode='<ods-media-gallery';widgetCode+=' context="'+contextsCodeBuilder.addContext(context)+'"';widgetCode+=' ods-widget-tooltip';widgetCode+=' ods-auto-resize';widgetCode+=' display-mode="compact"';widgetCode+='></ods-media-gallery>\n';return contextsCodeBuilder.wrapInContextsCode(widgetCode);},buildMapWidgetCode:function(context,search_parameters){var contextsCodeBuilder=buildContextsCode(),widgetCode='<ods-map';widgetCode+=' context="'+contextsCodeBuilder.addContext(context)+'"';widgetCode+=' scroll-wheel-zoom="false"';if(search_parameters.location){widgetCode+=' location="'+search_parameters.location+'"';}
if(search_parameters.basemap){widgetCode+=' basemap="'+search_parameters.basemap+'"';}
widgetCode+='></ods-map>\n';return contextsCodeBuilder.wrapInContextsCode(widgetCode);},buildTableWidgetCode:function(context,search_parameters){var contextsCodeBuilder=buildContextsCode(),widgetCode='<ods-table';widgetCode+=' context="'+contextsCodeBuilder.addContext(context)+'"';if(search_parameters.sort){widgetCode+=' sort="'+search_parameters.sort+'"';}
widgetCode+='></ods-table>\n';return contextsCodeBuilder.wrapInContextsCode(widgetCode);},buildChartWidgetCode:function(chartConfig){var contextsCodeBuilder=buildContextsCode(),widgetCode="";if(chartConfig){widgetCode='<ods-chart';if(chartConfig.timescale){widgetCode+=' timescale="'+chartConfig.timescale+'"';}
if(chartConfig.singleAxis){widgetCode+=' single-y-axis="'+chartConfig.singleAxis+'"';}
if(chartConfig.singleAxisLabel){widgetCode+=' single-y-axis-label="'+chartConfig.singleAxisLabel.replace(/"/g,'&quot;')+'"';}
if(chartConfig.singleAxisScale==="logarithmic"){widgetCode+=' logarithmic="true"';}
if(typeof chartConfig.yRangeMin!=="undefined"){widgetCode+=' min="'+chartConfig.yRangeMin+'"';}
if(typeof chartConfig.yRangeMax!=="undefined"){widgetCode+=' max="'+chartConfig.yRangeMax+'"';}
if(typeof chartConfig.yStep!=="undefined"){widgetCode+=' step="'+chartConfig.yStep+'"';}
if(typeof chartConfig.scientificDisplay!=="undefined"){widgetCode+=' scientific-display="'+chartConfig.scientificDisplay+'"';}else{widgetCode+=' scientific-display="false"';}
if(chartConfig.displayLegend===false){widgetCode+=' display-legend="false"';}
if(typeof chartConfig.labelsXLength!=="undefined"){widgetCode+=' labels-x-length="'+chartConfig.labelsXLength+'"';}
if(typeof chartConfig.alignMonth!=="undefined"){widgetCode+=' align-month="'+chartConfig.alignMonth+'"';}
widgetCode+='>\n';if(chartConfig.queries){for(var i=0;i<chartConfig.queries.length;i++){var query=chartConfig.queries[i];var context={parameters:query.config.options,dataset:{datasetid:query.config.dataset},domain:''};widgetCode+=indent('<ods-chart-query');widgetCode+=' context="'+contextsCodeBuilder.addContext(context)+'"';if(query.xAxis){widgetCode+=' field-x="'+query.xAxis+'"';}
if(query.maxpoints){widgetCode+=' maxpoints="'+query.maxpoints+'"';}else{widgetCode+=' maxpoints="0"';}
if(query.timescale){widgetCode+=' timescale="'+query.timescale+'"';}
if(query.stacked){widgetCode+=' stacked="'+query.stacked+'"';}
if(query.sort){widgetCode+=' sort="'+query.sort+'"';}
if(query.seriesBreakdown){widgetCode+=' series-breakdown="'+query.seriesBreakdown+'"';}
if(query.seriesBreakdownTimescale){widgetCode+=' series-breakdown-timescale="'+query.seriesBreakdownTimescale+'"';}
if(query.categoryColors){widgetCode+=' category-colors="'+prepareObjectForWidgetCode(query.categoryColors)+'"';}
widgetCode+='>\n';for(var j=0;j<query.charts.length;j++){var serie=query.charts[j];widgetCode+=indent('<ods-chart-serie',2);if(serie.yAxis){widgetCode+=' expression-y="'+serie.yAxis+'"';}
if(serie.multiplier){widgetCode+=' multiplier="'+serie.multiplier+'"';}
if(serie.type){widgetCode+=' chart-type="'+serie.type+'"';}
if(serie.innersize){widgetCode+=' innersize="'+serie.innersize+'"';}
if(serie.labelsposition){widgetCode+=' labelsposition="'+serie.labelsposition+'"';}
if(serie.func){widgetCode+=' function-y="'+serie.func+'"';}
if(serie.yLabelOverride){widgetCode+=' label-y="'+serie.yLabelOverride.replace(/"/g,'&quot;')+'"';}
if(serie.color){widgetCode+=' color="'+serie.color+'"';}
if(typeof serie.displayUnits!=="undefined"){widgetCode+=' display-units="'+serie.displayUnits+'"';}
if(typeof serie.displayValues!=="undefined"){widgetCode+=' display-values="'+serie.displayValues+'"';}
if(typeof serie.displayStackValues!=="undefined"){widgetCode+=' display-stack-values="'+serie.displayStackValues+'"';}
if(serie.scale==="logarithmic"){widgetCode+=' logarithmic="true"';}
if(typeof serie.yRangeMin!=="undefined"){widgetCode+=' min="'+serie.yRangeMin+'"';}
if(typeof serie.yRangeMax!=="undefined"){widgetCode+=' max="'+serie.yRangeMax+'"';}
if(typeof serie.yStep!=="undefined"){widgetCode+=' step="'+serie.yStep+'"';}
if(typeof serie.scientificDisplay!=="undefined"){widgetCode+=' scientific-display="'+serie.scientificDisplay+'"';}
if(serie.cumulative){widgetCode+=' cumulative="'+serie.cumulative+'"';}
if(typeof serie.subsets!=="undefined"){widgetCode+=' subsets="'+serie.subsets+'"';}
if(typeof serie.charts!=="undefined"&&serie.charts.length>0){widgetCode+=" subseries='"+JSON.stringify(serie.charts)+"'";}
if(typeof serie.thresholds!=="undefined"){widgetCode+=" color-thresholds='"+JSON.stringify(serie.thresholds)+"'";}
widgetCode+='>\n';widgetCode+=indent('</ods-chart-serie>\n',2);}
widgetCode+=indent('</ods-chart-query>\n');}}
widgetCode+='</ods-chart>\n';widgetCode=contextsCodeBuilder.wrapInContextsCode(widgetCode);}
return widgetCode;},buildCalendarWidgetCode:function(context){var contextsCodeBuilder=buildContextsCode();var widgetCode='<ods-calendar context="'+contextsCodeBuilder.addContext(context)+'"></ods-calendar>';return contextsCodeBuilder.wrapInContextsCode(widgetCode);},buildMapbuilderWidgetCode:function(mapConfig){var contextsCodeBuilder=buildContextsCode();var widgetCode='<ods-map no-refit="true" scroll-wheel-zoom="false"';if(mapConfig.layerSelection){widgetCode+=' display-control="true"';}
if(mapConfig.singleLayer){widgetCode+=' display-control-single-layer="true"';}
if(mapConfig.searchBox){widgetCode+=' search-box="true"';}
if(mapConfig.toolbarFullscreen){widgetCode+=' toolbar-fullscreen="true"';}
if(mapConfig.toolbarGeolocation){widgetCode+=' toolbar-geolocation="true"';}
if(mapConfig.autoGeolocation){widgetCode+=' auto-geolocation="true"';}
if(mapConfig.mapPresets.basemap){widgetCode+=' basemap="'+mapConfig.mapPresets.basemap+'"';}
if(mapConfig.mapPresets.location){widgetCode+=' location="'+mapConfig.mapPresets.location+'"';}
widgetCode+='>\n';mapConfig.groups.forEach(function(group){widgetCode+=indent('<ods-map-layer-group',1);if(group.pictoColor){widgetCode+=' picto-color="'+group.pictoColor+'"';}
if(group.pictoIcon){widgetCode+=' picto-icon="'+group.pictoIcon+'"';}
if(group.title){widgetCode+=' title="'+group.title.replace(/"/g,'&quot;')+'"';}
if(group.description){widgetCode+=' description="'+group.description.replace(/"/g,'&quot;')+'"';}
if(!group.displayed){widgetCode+=' displayed="'+group.displayed.toString()+'"';}
widgetCode+='>\n';group.layers.forEach(function(layer){widgetCode+=indent('<ods-map-layer context="'+contextsCodeBuilder.addContext(layer.context)+'"',2);if(angular.isString(layer.color)){widgetCode+=' color="'+layer.color+'"';}
if(layer.colorFunction){widgetCode+=' color-function="'+layer.color+'"';}
if(layer.color.type==='categories'){widgetCode+=' color-categories="'+prepareObjectForWidgetCode(layer.color.categories)+'"';widgetCode+=' color-by-field="'+layer.color.field+'"';if(layer.color.otherCategories){widgetCode+=' color-categories-other="'+layer.color.otherCategories+'"';}}
if(layer.color.type==='gradient'){var gradient=JSON.stringify(layer.color.steps).replace(/"/g,"'");widgetCode+=' color-gradient="'+gradient+'"';}
if(layer.color.type==='choropleth'){var ranges=JSON.stringify(layer.color.ranges).replace(/"/g,"'");widgetCode+=' color-numeric-ranges="'+ranges+'"';if(layer.color.undefinedColor){widgetCode+=' color-undefined="'+layer.color.undefinedColor+'"';}
if(layer.color.outOfBoundsColor){widgetCode+=' color-out-of-bounds="'+layer.color.outOfBoundsColor+'"';}
if(layer.color.field){widgetCode+=' color-by-field="'+layer.color.field+'"';}}
if(angular.isNumber(layer.color.minValue)){widgetCode+=' color-numeric-range-min="'+layer.color.minValue+'"';}
if(layer.color.type==='field'){widgetCode+=' color-by-field="'+layer.color.field+'"';}
if(layer.picto){widgetCode+=' picto="'+layer.picto+'"';}
widgetCode+=' show-marker="'+!!layer.marker+'"';if(layer.display){widgetCode+=' display="'+layer.display+'"';}
if((layer.display==='heatmap')&&(angular.isNumber(layer.radius))){widgetCode+='radius="'+layer.radius+'"';}
if(layer.func){widgetCode+=' function="'+layer.func+'"';}
if(layer.expr){widgetCode+=' expression="'+layer.expr+'"';}
if(angular.isNumber(layer.shapeOpacity)){widgetCode+=' shape-opacity="'+layer.shapeOpacity+'"';}
if(angular.isNumber(layer.pointOpacity)){widgetCode+=' point-opacity="'+layer.pointOpacity+'"';}
if(layer.borderColor){widgetCode+=' border-color="'+layer.borderColor+'"';}
if(angular.isNumber(layer.borderOpacity)){widgetCode+=' border-opacity="'+layer.borderOpacity+'"';}
if(angular.isNumber(layer.borderSize)){widgetCode+=' border-size="'+layer.borderSize+'"';}
if(layer.borderPattern){widgetCode+=' border-pattern="'+layer.borderPattern+'"';}
if(layer.lineWidth!==5){widgetCode+=' line-width="'+layer.lineWidth+'"';}
if(layer.caption){widgetCode+=' caption="true"';if(layer.captionTitle){widgetCode+=' caption-title="'+layer.captionTitle.replace(/"/g,'&quot;')+'"';}}
if(layer.captionPictoIcon){widgetCode+=' caption-picto-icon="'+layer.captionPictoIcon+'"';}
if(layer.captionPictoColor){widgetCode+=' caption-picto-color="'+layer.captionPictoColor+'"';}
if(layer.title){widgetCode+=' title="'+layer.title.replace(/"/g,'&quot;')+'"';}
if(layer.description){widgetCode+=' description="'+layer.description.replace(/"/g,'&quot;')+'"';}
if(layer.showZoomMin){widgetCode+=' show-zoom-min="'+layer.showZoomMin+'"';}
if(layer.showZoomMax){widgetCode+=' show-zoom-max="'+layer.showZoomMax+'"';}
var VARIABLE_SIZE_DISPLAYS=['auto','polygon','polygonforced','clusters'];var FIXED_SIZE_DISPLAYS=['auto','categories','choropleth','raw','clustered'];var FUNCTION_SIZE_DISPLAYS=['auto','polygon','polygonforced','clusters','heatmap'];if(FIXED_SIZE_DISPLAYS.indexOf(layer.display)>=0&&layer.size){widgetCode+=' size="'+layer.size+'"';}
if(VARIABLE_SIZE_DISPLAYS.indexOf(layer.display)>=0){if(angular.isNumber(layer.minSize)){widgetCode+=' size-min="'+layer.minSize+'"';}
if(angular.isNumber(layer.maxSize)){widgetCode+=' size-max="'+layer.maxSize+'"';}}
if(FUNCTION_SIZE_DISPLAYS.indexOf(layer.display)>=0&&layer.sizeFunction){widgetCode+=' size-function="'+layer.sizeFunction+'"';}
widgetCode+='>';widgetCode+='</ods-map-layer>\n';});widgetCode+=indent('</ods-map-layer-group>\n',1);});widgetCode+='</ods-map>\n';widgetCode=contextsCodeBuilder.wrapInContextsCode(widgetCode);return widgetCode;},buildCustomViewCode:function(context){var widgetCode='';var contextsCodeBuilder=buildContextsCode();if(context.dataset.extra_metas&&context.dataset.extra_metas.visualization&&context.dataset.extra_metas.visualization.custom_view_html){widgetCode=context.dataset.extra_metas.visualization.custom_view_html;}
if(context.dataset.extra_metas&&context.dataset.extra_metas.visualization&&context.dataset.extra_metas.visualization.custom_view_css){widgetCode+="\n<style type=\"text/css\">\n"+context.dataset.extra_metas.visualization.custom_view_css+"\n</style>\n";}
contextsCodeBuilder.addContext(context,'ctx');return contextsCodeBuilder.wrapInContextsCode(widgetCode);},};});}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('addRemove',function(){return{require:'ngModel',restrict:'A',scope:true,link:function(scope,element,attrs,ngModel){scope.add=function(value,copy,index,modifierFunction){if(!ngModel.$viewValue){ngModel.$viewValue=[];}
var addedVal;if(copy){addedVal=angular.copy(value);}else{addedVal=value;}
if(modifierFunction){addedVal=modifierFunction(addedVal,index+1);}
ngModel.$viewValue.push(addedVal);ngModel.$setViewValue(ngModel.$viewValue);return addedVal;};scope.remove=function(index){if(!angular.isNumber(index)){index=ngModel.$viewValue.indexOf(index);}
ngModel.$viewValue.splice(index,1);ngModel.$setViewValue(ngModel.$viewValue);};}};});}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsApiConsoleV1',['$http',function($http){return{restrict:'E',replace:true,scope:{api:'=',autocompleteFacet:'=',autoRequest:'@',service:'='},templateUrl:'/static/ods/html/api-console-v1.html',controller:function($scope,DebugLogger){$scope.apiParams={};$scope.errors=null;$scope.results=null;$scope.runOnce=true;$scope.$watch('apiParams',function(){if($scope.apiParams.parameters&&($scope.autoRequest==='true'||$scope.runOnce)){$scope.runOnce=false;if(!$.isEmptyObject($scope.apiParams.parameters)||!$.isEmptyObject($scope.apiParams.urlParameters)){$scope.sendCall();}}},true);$scope.computeURL=function(){$scope.apiParams={parameters:{},urlParameters:{}};var baseURL=$scope.service.url;if($scope.service.urlParameters){var value;for(var key in $scope.api.urlParameters){value=$scope.api.urlParameters[key];if(value){$scope.apiParams.urlParameters[key]=value;}}
for(var i=0;i<$scope.service.urlParameters.length;i++){var urlParameter=$scope.service.urlParameters[i];value='';if($scope.api.urlParameters[urlParameter.name]){value=$scope.api.urlParameters[urlParameter.name];}
baseURL=baseURL.replace(urlParameter.name,value);}}
if($scope.service.parameters){for(var j=0;j<$scope.service.parameters.length;j++){var parameter=$scope.service.parameters[j];if(parameter.type==='hierarchical'&&$scope.api.parameters[parameter.name]){var object=$scope.api.parameters[parameter.name];for(var subkey in object){var name=parameter.name+'.'+subkey;$scope.apiParams.parameters[name]=object[subkey];}}else if(parameter.type==='namedQueries'||parameter.name==='q'){if(typeof $scope.api.parameters['namedQueries']==='object'){var queryParamsArray=[];if($scope.api.parameters['q']){queryParamsArray.push($scope.api.parameters['q']);}
for(var key in $scope.api.parameters['namedQueries']){queryParamsArray.push($scope.api.parameters['namedQueries'][key]);}
if(queryParamsArray.length){$scope.apiParams.parameters['q']=queryParamsArray;}else{delete $scope.apiParams.parameters['q'];}}else if(typeof $scope.api.parameters['namedQueries']==='string'){$scope.apiParams.parameters['namedQueries']=$scope.api.parameters['namedQueries'];}else{$scope.apiParams.parameters['q']=$scope.api.parameters['q'];}}else if($scope.api.parameters[parameter.name]&&parameter.name!=='q'){$scope.apiParams.parameters[parameter.name]=$scope.api.parameters[parameter.name];}}}
var queryString=$.param($scope.apiParams.parameters,true);if(queryString){return baseURL+'?'+queryString;}else{return baseURL;}};$scope.sendCall=function(){$http.get($scope.computeURL(),{headers:{'ODS-UI':'true'}}).then(function(response){var data=response.data;$scope.results=data;$scope.errors=null;},function(response){var data=response.data;$scope.results=null;$scope.errors=data.error;});};}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsApiConsole',['MixpanelTrackEvent','$http',function(MixpanelTrackEvent,$http){return{restrict:'E',replace:true,scope:{api:'=',autocompleteFacet:'=',autoRequest:'@',service:'=',pageParameters:'=',dataset:'='},templateUrl:'/static/ods/html/api-console.html',controller:function($scope){$scope.apiParams={};$scope.errors=null;$scope.results=null;$scope.runOnce=true;$scope.$watch('apiParams',function(){if($scope.apiParams.parameters&&($scope.autoRequest==='true'||$scope.runOnce)){$scope.runOnce=false;if(!$.isEmptyObject($scope.apiParams.parameters)||!$.isEmptyObject($scope.apiParams.urlParameters)){$scope.sendCall();}}},true);$scope.computeURL=function(){$scope.apiParams={parameters:{},urlParameters:{}};var baseURL=$scope.service.url;if($scope.service.urlParameters){var value;for(var key in $scope.api.parameters){value=$scope.api.parameters[key];if(value){$scope.apiParams.urlParameters[key]=value;}}
for(var i=0;i<$scope.service.urlParameters.length;i++){var urlParameter=$scope.service.urlParameters[i];value='';if($scope.api.parameters[urlParameter.name]){value=$scope.api.parameters[urlParameter.name];}
baseURL=baseURL.replace("url_"+urlParameter.name,value);}}
if($scope.service.parameters){for(var j=0;j<$scope.service.parameters.length;j++){var parameter=$scope.service.parameters[j];if(parameter.type==='hierarchical'&&$scope.api.parameters[parameter.name]){var object=$scope.api.parameters[parameter.name];var values=[];for(var subkey in object){values.push(subkey+':'+object[subkey]);}
if(values.length){$scope.apiParams.parameters[parameter.name]=values;}}else if($scope.api.parameters[parameter.name]&&parameter.name!=='q'){$scope.apiParams.parameters[parameter.name]=$scope.api.parameters[parameter.name];}}}
if($scope.pageParameters){Object.entries($scope.pageParameters).forEach(function(entry){var key=entry[0];var value=entry[1];if(key==='refine'){if($scope.apiParams.parameters[key]){$scope.apiParams.parameters[key]=$scope.apiParams.parameters[key].concat(value);}else{$scope.apiParams.parameters[key]=value;}}
if(key==='where'){if($scope.apiParams.parameters[key]){$scope.apiParams.parameters[key]='('+$scope.apiParams.parameters[key]+') AND ('+value+')';}else{$scope.apiParams.parameters[key]=value;}}});}
var queryString=$.param($scope.apiParams.parameters,true);if(queryString){return baseURL+'?'+queryString;}else{return baseURL;}};$scope.trackApiQueryEvent=function(){MixpanelTrackEvent.track('api-dataset-tab-query-sent',{datasetTitle:$scope.dataset.metas.title},$scope.api.parameters.dataset);};$scope.sendCall=function(){$http.get($scope.computeURL(),{headers:{'ODS-UI':'true','ODS-API-Analytics-App':'explore'}}).then(function(response){var data=response.data;$scope.results=data;$scope.errors=null;},function(response){var data=response.data;$scope.results=null;$scope.errors=data.message;});$scope.trackApiQueryEvent();};}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsBindAngularContent',['$compile',function($compile){return{restrict:'A',link:function(scope,element,attrs){var unwatch=scope.$watch(function(){return scope.$eval(attrs.odsBindAngularContent);},function(value){if('doNotDecodeContent'in attrs){element.html(value);}else{var html=jQuery('<div />').html(value).text();element.html(html);}
if(element[0].tagName.toLowerCase()!=='style'){$compile(element.contents())(scope);}
unwatch();});}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');function flattenMetas(source,target){Object.keys(source).forEach(function(metaName){if(!target[metaName]){target[metaName]=source[metaName];}});}
mod.directive('odsCatalogCard',function(){return{restrict:'E',transclude:true,scope:{dataset:'=?',catalog:'=?'},template:''+'<div class="ods-catalog-card" ods-full-click inject></div>',controller:function($scope){if(!angular.isDefined($scope.dataset)){var dataset=angular.copy($scope.$parent.item);if(dataset.dataset_id){dataset.metas.extra_metas=dataset.metas;dataset.metas.interop_metas=dataset.metas;dataset.metas.basic_metas=dataset.metas;dataset.metas.visibility=dataset.visibility;flattenMetas(dataset.metas.default,dataset.metas);if(dataset.metas.custom){flattenMetas(dataset.metas.custom,dataset.metas);}
dataset.datasetid=dataset.dataset_id;}else{dataset.metas.default=angular.copy(dataset.metas);dataset.dataset_id=dataset.datasetid;angular.extend(dataset.metas,dataset.extra_metas);}
$scope.dataset=dataset;}
if(!angular.isDefined($scope.catalog)){$scope.catalog=$scope.$parent.context;}}};});mod.directive('odsCatalogCardKeywords',function(){return{restrict:'E',require:'^odsCatalogCard',template:''+'<div class="ods-catalog-card__keywords">'+'    <ods-catalog-card-keyword keyword="keyword"'+'                              ng-repeat="keyword in keywords track by $index"></ods-catalog-card-keyword>'+'</div>',controller:function($scope){$scope.keywords=$scope.dataset.metas.default.keyword;if(angular.isString($scope.keywords)){$scope.keywords=[$scope.keywords];}}};});mod.directive('odsCatalogCardKeyword',function(){return{restrict:'E',scope:{keyword:'=',catalog:'=?'},template:''+'<a class="ods-catalog-card__keyword"'+'   href="#"'+'     ng-click="catalog.toggleRefine(\'keyword\', keyword)"'+'     ng-class="{\'ods-catalog-card__keyword--active\': isActive(keyword)}"'+'     ng-bind="keyword"></a>',controller:function($scope){if(!angular.isDefined($scope.catalog)){$scope.catalog=$scope.$parent.catalog;}
$scope.isActive=function(keyword){if($scope.catalog.parameters['refine.keyword']){var refines=$scope.catalog.parameters['refine.keyword'];if(angular.isArray(refines)&&refines.indexOf(keyword)>-1||refines===keyword){return true;}}
return false;};}};});mod.directive('odsCatalogCardThemeIcon',function(){return{restrict:'E',require:'^odsCatalogCard',template:''+'<ods-theme-picto class="ods-catalog-card__theme-icon" theme="{{ dataset.metas.default.theme|firstValue }}" aria-hidden="true"></ods-theme-picto>'};});mod.directive('odsCatalogCardBody',function(){return{restrict:'E',require:'^odsCatalogCard',replace:true,transclude:true,template:''+'<div class="ods-catalog-card__body" ng-class="{\'ods-catalog-card__body--full-width\': !dataset.has_records}" ng-transclude></div>'};});mod.directive('odsCatalogCardTitle',function(){return{restrict:'E',require:'^odsCatalogCard',template:''+'<a ods-main-click'+'   class="ods-catalog-card__title-link" '+'   ng-href="{{ (\'/explore/dataset/\' + dataset.dataset_id + \'/\')|propagateAppendedURLParameters }}"'+'   target="_self">'+'    <h2 class="ods-catalog-card__title" ng-bind="dataset.metas.default.title"></h2>'+'</a>'};});mod.directive('odsCatalogCardDescription',function(){return{restrict:'E',require:'^odsCatalogCard',template:''+'<p class="ods-catalog-card__description" ng-bind-html="dataset.metas.default.description|shortSummary|prettyText"></p>'};});mod.directive('odsCatalogCardMetadataItem',function(config){return{restrict:'E',require:'^odsCatalogCard',scope:{itemTitle:'@',itemKey:'@'},template:''+'<div class="ods-catalog-card__metadata-item" ng-show="shown">'+'    <div class="ods-catalog-card__metadata-item-label" ng-bind="itemTitle|translate"></div>'+'    <div class="ods-catalog-card__metadata-item-value" ng-switch="itemKey">'+'       <span ng-switch-when="records_count">'+'            <span translate translate-n="value" translate-plural="{{$count|number}} items"> {{$count|number}} item</span>'+'       </span>'+'       <span ng-switch-when="explore.download_count">{{value|number}}</span>'+'       <span ng-switch-when="modified">{{value|moment:"LLL"}}</span>'+'       <span ng-switch-when="data_processed">{{value|moment:"LLL"}}</span>'+'       <span ng-switch-when="territory" ng-bind-html="formatLocation(value)"></span>'+'       <span class="ods-catalog-card__metadata-item-value-text" ng-switch-default ng-bind-html="value|formatMeta|prettyText"></span>'+'    </div>'+'</div>',controller:function($scope){if($scope.itemKey.indexOf('.')>-1){var template=$scope.itemKey.split('.')[0];var key=$scope.itemKey.split('.')[1];if(angular.isDefined($scope.$parent.dataset.metas[template])){$scope.value=$scope.$parent.dataset.metas[template][key];}}else{$scope.value=$scope.$parent.dataset.metas.default[$scope.itemKey]||($scope.$parent.dataset.metas.custom&&$scope.$parent.dataset.metas.custom[$scope.itemKey]);}
if(angular.isUndefined($scope.value)||$scope.value===null){$scope.shown=false;}else if(['records_count','explore.download_count'].indexOf($scope.itemKey)>-1&&$scope.value===0){$scope.shown=false;}else{$scope.shown=true;}
$scope.formatLocation=function(locations){if(!angular.isArray(locations)){return null;}
var formattedLocations=locations.map(function(location){return'<span class="ods-catalog-card__metadata-item-value-location">'+'<i class="fa fa-map-marker ods-catalog-card__metadata-item-value-location-picto"></i> '+location+'</span>';});return formattedLocations.join('');};}};});mod.directive('odsCatalogCardVisualizations',['domainConfig','config','defaultCustomViewConfig',function(domainConfig,config,defaultCustomViewConfig){return{restrict:'E',require:'^odsCatalogCard',replace:true,template:''+'<div class="ods-catalog-card__visualizations" ng-if="dataset.has_records">'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/table/" '+'       target="_self" '+'       class="ods-catalog-card__visualization">'+'        <i class="ods-catalog-card__visualization-icon fa fa-table" aria-hidden="true"></i> '+'        <span translate>Table</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/map/" '+'       target="_self" '+'       class="ods-catalog-card__visualization"'+'       ng-show="dataset.features.indexOf(\'geo\') >= 0 && !dataset.metas.visualization.map_disabled">'+'        <i class="ods-catalog-card__visualization-icon fa fa-globe" aria-hidden="true"></i> '+'        <span translate>Map</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/analyze/" '+'       target="_self" '+'       class="ods-catalog-card__visualization"'+'       ng-show="dataset.features.indexOf(\'analyze\') >= 0 && analyzeTabEnabled && !dataset.metas.visualization.analyze_disabled">'+'        <i class="ods-catalog-card__visualization-icon fa fa-bar-chart" aria-hidden="true"></i> '+'        <span translate>Analyze</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/calendar/" '+'       target="_self" '+'       class="ods-catalog-card__visualization"'+'       ng-show="dataset.features.indexOf(\'calendar\') >= 0 && dataset.metas.visualization.calendar_enabled">'+'        <i class="ods-catalog-card__visualization-icon fa fa-calendar" aria-hidden="true"></i> '+'        <span translate>Calendar</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/images/" '+'       target="_self" '+'       class="ods-catalog-card__visualization"'+'       ng-show="dataset.features.indexOf(\'image\') >= 0 && !dataset.metas.visualization.images_disabled">'+'        <i class="ods-catalog-card__visualization-icon fa fa-picture-o" aria-hidden="true"></i> '+'        <span translate>Images</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/export/" '+'       target="_self" '+'       class="ods-catalog-card__visualization">'+'        <i class="ods-catalog-card__visualization-icon fa fa-download" aria-hidden="true"></i> '+'        <span translate>Export</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/api/" '+'       ng-if="apiTabEnabled"'+'       target="_self" '+'       class="ods-catalog-card__visualization">'+'        <i class="ods-catalog-card__visualization-icon fa fa-cogs" aria-hidden="true"></i> '+'        <span translate>API</span>'+'    </a>'+'    <a href="/explore/dataset/{{ dataset.datasetid }}/{{ (dataset.metas.visualization.custom_view_slug) || defaultCustomViewConfig.slug }}/" '+'       ng-if="dataset.features.indexOf(\'custom_view\') > -1"'+'       target="_self" '+'       class="ods-catalog-card__visualization">'+'        <i class="ods-catalog-card__visualization-icon fa fa-{{ dataset.metas.visualization.custom_view_icon || defaultCustomViewConfig.icon }}" aria-hidden="true"></i> '+'        <span ng-bind="dataset.metas.visualization.custom_view_title || defaultCustomViewConfig.title"></span>'+'    </a>'+'</div>',link:function(scope){scope.apiTabEnabled=domainConfig['explore.enable_api_tab']&&(!config.HAS_SHARED_CATALOG||scope.dataset.datasetid.indexOf('@')===-1);scope.analyzeTabEnabled=!domainConfig['explore.disable_analyze'];scope.defaultCustomViewConfig=defaultCustomViewConfig;}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsChartControlSerie',['ChartHelper','translate',function(ChartHelper,translate){var $dataset,defineHelpers=function($scope){$scope.availableChartTypes=ChartHelper.getAvailableChartTypes(ChartHelper.getDatasetId($scope.context),$scope.stacked);$scope.allowedcolors=ChartHelper.getAllowedColors($scope.serie.type,$scope.breakdown);};return{templateUrl:'/static/ods/html/chart-control-serie.html',require:"^chartControls",scope:{serie:'=',context:'=',advanced:'=',singleAxis:'=',breakdown:'=',stacked:'='},replace:true,controller:function($scope,$element,$attrs){$scope.translate=translate;if($scope.context){defineHelpers($scope);$scope.allowedcolors=[];if($scope.serie){$scope.allowedcolors=ChartHelper.getAllowedColors($scope.serie.type,$scope.breakdown);}}
$scope.$watch('serie',function(nv,ov){if(nv&&$scope.context){defineHelpers($scope);}
if(nv){$scope.allowedcolors=ChartHelper.getAllowedColors(nv.type,$scope.breakdown);}},true);$scope.$watch('stacked',function(nv,ov){if($scope.context){defineHelpers($scope);}},true);$scope.$watch('breakdown',function(nv,ov){if($scope.context){defineHelpers($scope);}},true);var unwatch=$scope.$watch('context',function(nv,ov){if(nv){ChartHelper.init(nv,$scope.advanced,true);if($scope.serie){defineHelpers($scope);}
unwatch();}});$scope.isRangeChart=ChartHelper.isRangeChart.bind(ChartHelper);$scope.pieChartPositions=ChartHelper.getPieChartPositions();$scope.allowThresholds=ChartHelper.allowThresholds.bind(ChartHelper);$scope.display='';}};}]);mod.directive('odsChartControlSerieFunction',['ChartHelper','translate',function(ChartHelper,translate){var $dataset,defineHelpers=function($scope){var uniqueid=ChartHelper.getDatasetId($scope.context);$scope.isRangeChart=ChartHelper.isRangeChart.bind(ChartHelper);$scope.availableY=ChartHelper.getAvailableY(uniqueid);$scope.availableFunctions=ChartHelper.getAvailableFunctions(uniqueid);};return{templateUrl:'/static/ods/html/chart-control-serie-function.html',scope:{serie:'=',context:'=',advanced:'='},replace:true,controller:function($scope){$scope.translate=translate;$scope.$watch('context',function(nv,ov){if(nv){ChartHelper.init(nv,$scope.advanced,true);defineHelpers($scope);}},true);$scope.$watch('serie',function(nv,ov){if(nv&&$scope.context){defineHelpers($scope);}},true);},link:function(scope,element,attrs){scope.subserie=!!('subserie'in attrs);}};}]);mod.directive('chartControls',['$http','$location','$timeout','$filter','translate','ChartHelper','AggregationHelper','ContextHelper','ODSWidgetsConfig',function($http,$location,$timeout,$filter,translate,ChartHelper,AggregationHelper,ContextHelper,ODSWidgetsConfig){var $dataset;return{templateUrl:'/static/ods/html/chart-controls.html',scope:{context:'=',dataChart:'=datachart',colors:'=',query:'=',index:'=',advanced:'='},require:['chartControls','^advancedChartControls'],transclude:true,controller:function($scope,$element,$attrs,$transclude){var that=this;$scope.getSerieForChart=function(query,chart){var queryIndex=$scope.dataChart.queries.indexOf(query);var serieIndex=query.charts.indexOf(chart);return"serie"+(queryIndex+1)+'-'+(serieIndex+1);};$scope.serieRemoval=function(chart){var serieIndex=$scope.query.charts.indexOf(chart);if($scope.query.sort==='serie'+(serieIndex+1)){$scope.query.sort='';}else{var currentSortIndex=parseInt($scope.query.sort.substring(5),10);if(currentSortIndex>serieIndex+1){$scope.query.sort='serie'+(currentSortIndex-1);}}};$scope.reorderQueries=function(items,olditems){if($scope.query.sort){$scope.query.sort=$scope.query.sort.split('-')[0]+'-'+(items.indexOf(olditems[parseInt($scope.query.sort.split('-')[1],10)-1])+1);}};$scope.stackingEnabled=function(){if($scope.query.charts.length>1){var type=$scope.query.charts[0].type;for(var i=1;i<$scope.query.charts.length;i++){if($scope.query.charts[i].type!==type){return false;}}
return true;}else if($scope.query.charts.length===1&&$scope.query.seriesBreakdown){return true;}else{return false;}};$scope.translate=translate;this.init=function(nv,ov){ChartHelper.init($scope.context,$scope.advanced,true);$scope.availableX=$filter('fieldsForLanguageDisplay')(ChartHelper.getAvailableX(ChartHelper.getDatasetId($scope.context),undefined,$scope.advanced),ODSWidgetsConfig.language);updatexAxis($scope.query.xAxis);updateSeriesBreakdown($scope.query.seriesBreakdown);$scope.isRangeChart=ChartHelper.isRangeChart.bind(ChartHelper);$scope.$watch('context',function(nv,ov){if(nv){ChartHelper.init(nv,$scope.advanced,true);$scope.availableX=$filter('fieldsForLanguageDisplay')(ChartHelper.getAvailableX(ChartHelper.getDatasetId(nv),undefined,$scope.advanced),ODSWidgetsConfig.language);if($scope.availableX.filter(function(f){return f.name===$scope.query.xAxis}).length===0){var xFieldList=ChartHelper.getAvailableX(ChartHelper.getDatasetId(nv),undefined,$scope.advanced).filter(function(f){return f.name===$scope.query.xAxis});if(xFieldList.length){$scope.availableX.unshift(xFieldList[0]);}}
updatexAxis($scope.query.xAxis);updateSeriesBreakdown($scope.query.seriesBreakdown);}},true);function updatexAxis(nv,ov){$scope.availableBreakDowns=ChartHelper.getAvailableBreakDowns(ChartHelper.getDatasetId($scope.context),nv);if(['date','datetime'].indexOf(ChartHelper.getFieldType(ChartHelper.getDatasetId($scope.context),nv))!==-1){$scope.timescales=ChartHelper.getTimescales(ChartHelper.getDatasetId($scope.context),nv,$scope.advanced);}else{$scope.timescales=[];}}
function updateSeriesBreakdown(nv,ov){if(['date','datetime'].indexOf(ChartHelper.getFieldType(ChartHelper.getDatasetId($scope.context),nv))!==-1){$scope.timescalesForBreakdown=ChartHelper.getTimescales(ChartHelper.getDatasetId($scope.context),nv,$scope.advanced);}else{$scope.timescalesForBreakdown=[];}}
$scope.$watch("query.xAxis",updatexAxis,true);$scope.$watch("query.seriesBreakdown",updateSeriesBreakdown,true);};this.setParentController=function(ctrl){this.ctrl=ctrl;};$scope.initColorsCategoryModal=function(field){$scope.categoryColors=angular.copy($scope.query.categoryColors)||{};$scope.updateCategories(field);$scope.showColorsCategoryModal();};$scope.updateCategories=function(field){var datasetContext=ContextHelper.getDatasetContext('chartcontext','',$scope.query.config.dataset,$scope.query.config.options);datasetContext.wait().then(function(){datasetContext.getFacetValues(field).then(function(result){result.map(function(item){$scope.categoryColors[item]=$scope.categoryColors[item]||'';});for(var category in $scope.categoryColors){if(result.indexOf(category)===-1){delete($scope.categoryColors[category]);}}});});};$scope.apply=function(){var cleanupCategoryColors={};for(var key in $scope.categoryColors){if($scope.categoryColors[key]){cleanupCategoryColors[key]=$scope.categoryColors[key];}}
$scope.query.categoryColors=cleanupCategoryColors;$scope.hideColorsCategoryModal();}},link:function(scope,element,attr,ctrls){scope.serieTemplate=ChartHelper.getSerieTemplate();ctrls[0].setParentController(ctrls[1]);var unwatchDataChart=scope.$watch('dataChart',function(nv,ov){if(!nv)return;var unwatchDataset=scope.$watch('context',function(nv,ov){if(!nv)return;ctrls[0].init();unwatchDataset();});unwatchDataChart();});}};}]);mod.directive('odsChartControlQuery',[function(){return{scope:true,link:function($scope){$scope.datasetSelectionPresets=function(){return{catalogParameters:{'refine.features':'analyze'},datasetId:$scope.query.config.dataset,datasetParameters:$scope.query.config.options};};$scope.datasetSelectionCallback=function(selection){$scope.query.config.options=selection.datasetParameters;};}};}]);mod.directive('advancedChartControls',['config','ChartHelper','URLSynchronizer','SearchAPI','$location','$timeout','$q','ManagementAPI',function(config,ChartHelper,URLSynchronizer,SearchAPI,$location,$timeout,$q,ManagementAPI){return{restrict:'AE',templateUrl:'/static/ods/html/advanced-chart-controls.html',scope:{context:'=',chartContext:'=',initialChartContext:'=?',noControls:'=?'},require:'advancedChartControls',replace:true,controller:['$scope',function($scope){var domain=window.location.protocol+'//'+window.location.host;var source=$location.search().source;$scope.allTimescales=ChartHelper.getAllTimescales();$scope.graphMode='analysis';$scope.datasetSelectionPresets=function(){return{catalogParameters:{'refine.features':'analyze'}};};$scope.datasetSelectionCallback=function(selection){SearchAPI.datasets.lookup(selection.datasetId,{'extrametas':true,'lang':config.LANGUAGE}).then(function(dataset){$scope.addDataset(dataset.data,selection.datasetParameters);});};$scope.removeQuery=function(query){var index=$scope.localChartContext.dataChart.queries.indexOf(query);$scope.localChartContext.dataChart.queries.splice(index,1);};$scope.addDataset=function(dataset,searchParameters){dataset=ODS.Dataset(dataset);if(!$scope.context.datasets){$scope.context.datasets={};}
$scope.context.datasets[dataset.datasetid]={'dataset':dataset,'parameters':searchParameters};ChartHelper.init($scope.context.datasets[dataset.datasetid],true);if(!$scope.localChartContext.dataChart){$scope.localChartContext.dataChart={'queries':[]};}
var query;if(dataset.extra_metas&&dataset.extra_metas.visualization&&dataset.extra_metas.visualization.analyze_default){var chart=JSON.parse(dataset.extra_metas.visualization.analyze_default);query=chart.queries[0];}else{query={charts:[ChartHelper.getSerieTemplate()]};}
query.config={'dataset':dataset.datasetid,'options':searchParameters||{}};$scope.localChartContext.dataChart.queries.push(query);};$scope.saveChart=function(){$scope.savingChart=true;var request;if($scope.localChartContext.chartId){request=ManagementAPI.charts.update($scope.localChartContext.chartId,$scope.localChartContext.title,$scope.localChartContext.dataChart);}else{request=ManagementAPI.charts.new($scope.localChartContext.title,$scope.localChartContext.dataChart);}
request.then(function(response){var chart=response.data;$scope.initialChartContext.dataChart=chart.value;$scope.initialChartContext.title=chart.title;$scope.initialChartContext.lastModification=chart.last_modification;$scope.localChartContext.lastModification=chart.last_modification;$scope.initialChartContext.chartId=chart.persist_id;$scope.localChartContext.chartId=chart.persist_id;if($location.path()==='/'){$location.path('/'+chart.persist_id+'/');$location.search({});if($scope.destroyUrlSynchronizer){$scope.destroyUrlSynchronizer();}}
$scope.savingChart=false;},function(){$scope.savingChart=false;});};$scope.isChartDirty=function(){return!$scope.localChartContext.chartId||!angular.equals($scope.localChartContext,$scope.initialChartContext);};}],link:function(scope,element,attrs,ctrl){function preparationFinished(){scope.localChartContext.dataChart={};angular.extend(scope.localChartContext.dataChart,scope.chartContext.dataChart);if(!!('urlsynchronize'in attrs)){scope.destroyUrlSynchronizer=URLSynchronizer.addJSONSynchronizedObject(scope,'chartContext.dataChart','dataChart');}
scope.$watch('localChartContext',function(nv,ov){scope.graphMode="timeserie";angular.forEach(scope.localChartContext.dataChart.queries,function(query){var fieldType=ChartHelper.getFieldType(ChartHelper.getDatasetUniqueId(query.config.dataset),query.xAxis);if(["date","datetime"].indexOf(fieldType)===-1){scope.graphMode="analysis";}});updateCharts();},true);if(!scope.advanced){scope.$watch('context',function(nv,ov){if(scope.localChartContext.dataChart){var dataChart=scope.localChartContext.dataChart;for(var i=0;i<dataChart.queries.length;i++){var query=dataChart.queries[i];if(nv.datasets&&nv.datasets[query.config.dataset]){query.config.options=angular.copy(nv.datasets[query.config.dataset].parameters);if(query.config.options){delete(query.config.options.dataChart);}}}
angular.forEach(nv.datasets,function(dataset,name){var found=false;for(var i=0;i<dataChart.queries.length;i++){if(nv.datasets[dataChart.queries[i].config.dataset]){found=true;}}
if(!found){var query={config:{dataset:dataset.dataset.datasetid,options:dataset.parameters||{}},charts:[ChartHelper.getSerieTemplate()]};dataChart.queries.push(query);}});}},true);}
scope.$evalAsync(function(scope){updateCharts();});}
function updateCharts(){var uniqueid,query,i,j;var dataChart=scope.localChartContext.dataChart;if(dataChart){for(i=0;i<dataChart.queries.length;i++){query=dataChart.queries[i];var fakeContext={dataset:scope.context.datasets[query.config.dataset].dataset,parameters:query.config.options,domain:query.config.domain||""};if(scope.context.datasets[query.config.dataset]){ChartHelper.init(fakeContext);uniqueid=ChartHelper.getDatasetId(fakeContext);if(typeof query.xAxis==="undefined"){ChartHelper.setDefaultQueryValues(uniqueid,query,scope.advanced);}
for(j=0;j<query.charts.length;j++){ChartHelper.setSerieDefaultValues(uniqueid,query.charts[j],query.xAxis);}
ChartHelper.setDefaultQueryValues(uniqueid,query,scope.advanced);}}
ChartHelper.setChartDefaultValues(uniqueid,dataChart,undefined,scope.advanced);var nb_series=0;for(i=0;i<dataChart.queries.length;i++){query=dataChart.queries[i];if(scope.context.datasets[query.config.dataset]){uniqueid=ChartHelper.getDatasetId(query.config,"");for(j=0;j<query.charts.length;j++){ChartHelper.setSerieDefaultColors(query.charts[j],query.seriesBreakdown,nb_series);nb_series++;}}}
if(asyncInProgress){$timeout.cancel(asyncInProgress);}
asyncInProgress=$timeout(function(){angular.extend(scope.chartContext,angular.copy(scope.localChartContext));},0);}}
var asyncInProgress=false;scope.noControls=!!scope.noControls;scope.advanced=!!('advanced'in attrs);scope.canSave=!!('canSave'in attrs)&&!!(config.USER);scope.context=scope.context||{};scope.chartContext=scope.chartContext||{};scope.initialChartContext=scope.initialChartContext||{};if(!angular.equals(scope.initialChartContext,{})){scope.localChartContext={chartId:scope.initialChartContext.chartId,title:scope.initialChartContext.title,lastModification:scope.initialChartContext.lastModification};}else{scope.localChartContext={};}
scope.savingChart=false;if(!scope.context.datasets){if(!scope.chartContext.dataChart){if(scope.initialChartContext.dataChart){scope.chartContext.dataChart=angular.copy(scope.initialChartContext.dataChart);}else if($location.search().dataChart){scope.chartContext.dataChart=JSON.parse(b64_to_utf8($location.search().dataChart));}else{scope.chartContext.dataChart={timescale:'',queries:[],alignMonth:true};}}
if(!scope.context.datasets){scope.context.datasets={};}
var requests=[];if(scope.chartContext.dataChart.queries.length===0){preparationFinished();}else{var datasets={};angular.forEach(scope.chartContext.dataChart.queries,function(query,index){datasets[query.config.dataset]=query.config.options||{};});angular.forEach(datasets,function(value,datasetname){if(!scope.context.datasets[datasetname]){scope.context.datasets[datasetname]={};var lookupOptions=angular.extend({},datasets[datasetname],{lang:config.LANGUAGE});requests.push(SearchAPI.datasets.lookup(datasetname,lookupOptions).then(function(response){var dataset=response.data;scope.context.datasets[datasetname].dataset=new ODS.Dataset(dataset);if(!scope.advanced){scope.context.datasets[datasetname].parameters=datasets[datasetname];}
ChartHelper.init(scope.context.datasets[datasetname]);}));}});$q.all(requests).then(function(){preparationFinished();});}}else{angular.forEach(scope.context.datasets,function(dataset,name){ChartHelper.init(dataset);});if(!scope.chartContext.dataChart){if($location.search().dataChart){scope.chartContext.dataChart=JSON.parse(b64_to_utf8($location.search().dataChart));}else{scope.chartContext.dataChart={queries:[]};angular.forEach(scope.context.datasets,function(dataset,name){if(dataset.dataset.extra_metas&&dataset.dataset.extra_metas.visualization&&dataset.dataset.extra_metas.visualization.analyze_default){var chart=JSON.parse(dataset.dataset.extra_metas.visualization.analyze_default);scope.chartContext.dataChart=angular.copy(chart);scope.chartContext.dataChart.queries[0].config={};scope.chartContext.dataChart.queries[0].config.dataset=dataset.dataset.datasetid;scope.chartContext.dataChart.queries[0].config.options=dataset.parameters||{};}else{var query={config:{dataset:dataset.dataset.datasetid,options:dataset.parameters||{}},charts:[ChartHelper.getSerieTemplate()]};scope.chartContext.dataChart.queries.push(query);}});}
angular.forEach(scope.context.datasets,function(dataset,name){for(var i=0;i<scope.chartContext.dataChart.queries.length;i++){if(scope.chartContext.dataChart.queries[i].config.dataset===name){scope.chartContext.dataChart.queries[i].config.options=angular.copy(dataset.parameters);}}});}else{}
preparationFinished();}}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsClipboardInput',['translate','$compile',function(translate,$compile){return{restrict:'E',replace:true,scope:{value:'=',inputWidth:'@',id:'@',odsAutofocus:'=',type:'@'},link:function(scope,element){scope.ariaLabel=translate('Copy to clipboard');var template='<div class="ods-form__addon-wrapper ods-form__addon-wrapper--{{ inputWidth }}">'+'    <input type="{{ type || \'text\'}}"'+'           id="{{id}}"'+'           class="ods-form__control"'+'           ng-model="value"'+'           ng-readonly="true" aria-disabled="true">'+'    <button class="ods-form__addon ods-button"'+'            type="button"'+'            ng-click="copyToClipboard()"'+'            ods-tooltip'+'            ods-tooltip-template="tooltipMessage"'+'            ods-tooltip-direction="top"'+'            ods-autofocus="odsAutofocus"'+'            aria-label="{{ariaLabel}}">'+'        <i class="fa fa-clipboard" aria-hidden="true"></i>'+'    </button>'+'</div>';var clipboardInput=$compile(template)(scope);element.replaceWith(clipboardInput);var inputElement=clipboardInput.find('input');var buttonElement=clipboardInput.find('button');var defaultTooltipMessage=function(){scope.tooltipMessage=translate('Copy to clipboard');};var successTooltipMessage=function(){scope.tooltipMessage='<i class="fa fa-check"></i> '+translate('Copied');};scope.copyToClipboard=function(){inputElement.select();document.execCommand('copy');successTooltipMessage();scope.$broadcast('refresh-tooltip');inputElement.blur();};buttonElement.on('mouseenter',defaultTooltipMessage);}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsClipboardTextarea',['translate','$compile',function(translate,$compile){return{restrict:'E',replace:true,scope:{value:'=',inputWidth:'@',id:'@',class:'@',odsAutofocus:'=',type:'@'},link:function(scope,element){var template='<div class="ods-form__addon-wrapper ods-form__addon-wrapper--'+ODS.StringUtils.escapeHTML(scope.inputWidth)+' '+ODS.StringUtils.escapeHTML(scope.class)+'">'+'    <textarea type="text"'+'           class="ods-form__control"'+'           ng-model="value"'+'           ng-readonly="true"'+
(scope.type==='code'?'dir="ltr"':'')+
(scope.id?'id="'+ODS.StringUtils.escapeHTML(scope.id)+'">':'>')+'    </textarea>'+'    <button class="ods-form__addon ods-button"'+'            type="button"'+'            ng-click="copyToClipboard()"'+'            ods-autofocus="odsAutofocus"'+'            ods-tooltip'+'            ods-tooltip-template="tooltipMessage"'+'            ods-tooltip-direction="top">'+'        <i class="fa fa-clipboard"></i>'+'    </button>'+'</div>';var clipboardInput=$compile(template)(scope);element.replaceWith(clipboardInput);var inputElement=clipboardInput.find('textarea');var buttonElement=clipboardInput.find('button');scope.ariaLabel=translate('Copy to clipboard');var defaultTooltipMessage=function(){scope.tooltipMessage=translate('Copy to clipboard');};var successTooltipMessage=function(){scope.tooltipMessage='<i class="fa fa-check"></i> '+translate('Copied');};scope.copyToClipboard=function(){inputElement.select();document.execCommand('copy');successTooltipMessage();scope.$broadcast('refresh-tooltip');inputElement.blur();};buttonElement.on('mouseenter',defaultTooltipMessage);}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsCollapsible',function(){return{restrict:'EA',transclude:true,replace:true,template:''+'<div class="ods-collapsible" ng-transclude>'+'</div>',link:function(scope,element,attrs){scope.expanded=false;if(angular.isDefined(attrs.initiallyExpanded)&&attrs.initiallyExpanded=='true'){scope.expanded=true;}}};});mod.directive('odsCollapsibleAboveFold',['translate',function(translate){return{require:'^odsCollapsible',restrict:'E',transclude:true,template:''+'<div class="ods-collapsible__above-fold" '+'     ng-class="{\'ods-collapsible__above-fold--expanded\': expanded}"'+'     ng-click="expanded=!expanded">'+'    <div ng-transclude></div>'+'    <div class="ods-collapsible__help-text" >'+'        <span ng-hide="expanded" translate tabindex="0" aria-label="{{expandAriaLabel}}" ng-keypress="checkKey($event)" role="button">Click to expand</span>'+'        <span ng-show="expanded" translate tabindex="0" aria-label="{{collapseAriaLabel}}" ng-keypress="checkKey($event)" role="button">Click to collapse</span>'+'    </div>'+'</div>',controller:function($scope){$scope.checkKey=function(event){if(event.keyCode===13){$scope.expanded=!$scope.expanded;}};$scope.expandAriaLabel=translate("Press enter to expand panel");$scope.collapseAriaLabel=translate("Press enter to collapse panel");}};}]);mod.directive('odsCollapsibleFold',function(){return{require:'^odsCollapsible',restrict:'E',transclude:true,template:''+'<div class="ods-collapsible__fold" ng-show="expanded" ng-transclude>'+'</div>'};});})();;(function(){'use strict';var mod=angular.module('ods.core'),PI2=Math.PI*2,pickerWindowHTML=''+'<div class="ods-picker ods-color-picker__window" style="display: none;" ng-init="selectedTab = savedTab" ng-click="$event.stopPropagation();">'+'   <div class="ods-picker__arrow"></div>'+'   <div class="ods-picker__header">'+'       <ul class="ods-color-picker__menu-tabs" role="tablist">'+'           <li class="ods-color-picker__menu-tab" role="tab" ng-class="{\'ods-color-picker__menu-tab--active\':selectedTab === \'nice-colors\'}" ng-keypress="tabsCheckKey($event, \'nice-colors\')" ng-click="changeTab(\'nice-colors\')" translate tabindex="0">Nice colors</li>'+'           <li class="ods-color-picker__menu-tab" role="tab" ng-class="{\'ods-color-picker__menu-tab--active\':selectedTab === \'color-wheel\'}" ng-keypress="tabsCheckKey($event, \'color-wheel\')" ng-click="changeTab(\'color-wheel\')" translate tabindex="0">Color wheel</li>'+'       </ul>'+'   </div>'+'   <div class="ods-picker__content ods-color-picker__content">'+'      <div class="ods-color-picker__color-tools">'+'          <div class="ods-color-picker__color-wheel" ng-show="selectedTab === \'color-wheel\'" role="tabpanel">'+'              <canvas class="ods-color-picker__color-wheel-canvas" '+'                      tabindex="0" '+'                      ng-keydown="canvasCheckKey($event)" '+'                      aria-live="polite" '+'                      aria-label="Use arrow keys to select a color in the wheel" '+'                      translate="aria-label"></canvas>'+'               <div class="ods-color-picker__hsv-range-container">'+'                   <input type="range" '+'                       class="ods-color-picker__hsv-range" '+'                       ng-model=\'hsvValue\' '+'                       ng-change="onHSVValueChange()">'+'               </div>'+'           </div>'+'           <div class="ods-color-picker__nice-colors" ng-show="selectedTab === \'nice-colors\'" role="tabpanel">'+'           </div>'+'       </div>'+'   </div>'+'   <div class="ods-picker__preview">'+'       <div class="ods-color-picker__saturation-sample">'+'           <span class="ods-color-picker__saturation-sample-hexcode" aria-live="polite" aria-label="Current color">#000000</span>'+'       </div>'+'   </div>'+'   <div class="ods-picker__actions">'+'       <button type="button"'+'               class="ods-button ods-button--secondary" '+'               ng-click="closePicker()" aria-label="Close color picker" translate="aria-label">'+'           <span translate>Cancel</span>'+'       </button>'+'       <button type="button" '+'               class="ods-button ods-button--primary" '+'               ng-click="saveColor()">'+'           <i class="odsui-valid" aria-hidden="true"></i> '+'           <span translate>Select color</span>'+'       </button>'+'   </div>'+'</div>';function drawCursor(x,y,ctx){ctx.beginPath();ctx.strokeStyle='#000';ctx.lineWidth=1;ctx.arc(~~x,~~y,4,0,PI2);ctx.stroke();}
function buildNiceColorsRows(niceColors){var result="";for(var i=0;i<niceColors.length;i++){result+='<div class="ods-color-picker__nice-colors-shades">';for(var j=0;j<niceColors[i].length;j++){result+=''+'<div ng-click="selectNiceColor(\''+niceColors[i][j][1]+'\')"'+'     tabindex="0"'+'     role="button"'+'     aria-label="'+niceColors[i][j][1]+'('+niceColors[i][j][0]+')'+'"'+'     ng-keyPress="selectColorCheckKey($event,\''+niceColors[i][j][1]+'\')"'+'     class="ods-color-picker__nice-colors-col ods-color-picker__nice-colors-col-color"'+'     ods-tooltip="'+niceColors[i][j][0]+'"'+'     ng-style="{ \'background-color\' : \' '+niceColors[i][j][1]+'\', \'border\' : ( \''+niceColors[i][j][1]+'\'=== \'#FFFFFF\' ? \'solid 1px '+niceColors[i][j][2]+'\': \'none\')}">'+'</div>';}
result+='</div>';}
return result;}
mod.directive('odsColorpicker',['$compile','$document','ColorHelper','$timeout','translate','PickerHelper',function($compile,$document,colorHelper,$timeout,translate,pickerHelper){var currentWindowPicker,savedTab='nice-colors';function destroyCurrentPicker(){if(currentWindowPicker){currentWindowPicker.remove();}
currentWindowPicker=null;}
return{restrict:'E',scope:{ngDisabled:'=?',ngReadonly:'=?',defaultColor:'@',ariaLabelText:'@'},replace:true,require:'ngModel',link:function(scope,element,attrs,ngModelCtrl){var pickerDiv,canvas,canvasElem,width,height,ctx,imageData,saturationSample,saturationSampleHexcode,saturationInput,pixels,radius,defaultColor,colorSample,resetButton,required=false,internalModelInput;if(!scope.ngDisabled){scope.ngDisabled=false;}
if(!scope.ngReadonly){scope.ngReadonly=false;}
ngModelCtrl.$render=function(){scope.internalModel=ngModelCtrl.$viewValue||defaultColor();};scope.$watch('internalModel',function(nv){refreshResetButton(scope.internalModel);var isValidColor=colorHelper.isValidHexColor(scope.internalModel);if(isValidColor){internalModelInput.removeClass('ods-form__control--danger');var longHex=colorHelper.shortToLongHexColor(scope.internalModel);colorSample.css('background-color',longHex);if(radius&&ctx){updateColorWheelTab(longHex);}
ngModelCtrl.$setViewValue(nv);}else{internalModelInput.addClass('ods-form__control--danger');if(!required){colorSample.css('background-color','');}}});var template='<div class="ods-color-picker__button">'+'   <span class="ods-form__addon-wrapper ods-form__addon-wrapper--medium">'+'       <input type="text"'+'              class="ods-form__control ods-color-picker__hex-color-input"'+'              ng-model="internalModel"'+'              ng-disabled="ngDisabled"'+'              ng-readonly="ngReadonly"'+'              ng-class="{\'ods-color-picker__hex-color-input-wrapper--disabled\': ngDisabled}"'+'              ng-click="onTextClick($event)"'+'              maxlength="7"'+'              aria-label="{{inputLabel}}">'+'       <button class="ods-button ods-form__addon ods-color-picker__input-button"'+'               type="button"'+'               ng-click="toggleColorPicker($event)"'+'               ng-disabled="ngDisabled"'+'               ng-readonly="ngReadonly"'+'               aria-label="{{buttonLabel}}">'+'           <div class="ods-color-picker__color-sample"></div>'+'           <i class="odsui-bottom ods-color-picker__input-button-arrow"'+'              ng-readonly="ngReadonly" ></i>'+'       </button>'+'   </span>'+'   <button ng-hide="ngDisabled||ngReadonly"'+'           type="button"'+'           class=" ods-color-picker__reset-button"'+'           ng-click="resetDefaultColor()"'+'           aria-label="Reset value"'+'           translate="aria-label">'+'       <i class="odsui-reset" aria-hidden="true"></i>'+'   </button>'+'</div>';var pickerButton=angular.element(template);element.replaceWith(pickerButton);pickerButton=$compile(pickerButton)(scope);internalModelInput=pickerButton.find('input[type=text]');colorSample=pickerButton.find(".ods-color-picker__color-sample").first();resetButton=pickerButton.find('.ods-color-picker__reset-button');scope.inputLabel=scope.ariaLabelText+' ';scope.buttonLabel=translate('Open color picker');if(attrs.required){required=true;}
defaultColor=function(){if(scope.defaultColor){return scope.defaultColor.toUpperCase();}};scope.selectNiceColor=function(val){scope.selectedColor=val;updateColorWheelTab(val);};scope.selectColorCheckKey=function(event,color){if(event.keyCode===13){scope.selectNiceColor(color);}};function initPickerWindow(){$document.find('body').first().prepend($compile(pickerWindowHTML)(scope));pickerDiv=$document.find(".ods-color-picker__window").first();saturationSample=pickerDiv.find(".ods-color-picker__saturation-sample").first();saturationInput=pickerDiv.find(".ods-color-picker__hsv-range").first();saturationSampleHexcode=pickerDiv.find(".ods-color-picker__saturation-sample-hexcode").first();canvas=pickerDiv.find("canvas").first();canvasElem=canvas.get(0);width=canvas.width();height=canvas.height();canvasElem.setAttribute('width',width);canvasElem.setAttribute('height',height);ctx=canvasElem.getContext("2d");imageData=ctx.createImageData(width,height);pixels=imageData.data;radius=width/2;colorHelper.loadWheel(radius,pixels,100);pickerDiv.find('.ods-color-picker__nice-colors').first().append($compile(buildNiceColorsRows(colorHelper.niceColors))(scope));currentWindowPicker=pickerDiv;}
var updateColorWheelTab=function(hex){var longHex=colorHelper.shortToLongHexColor(hex),rgb=colorHelper.HexToRGB(longHex),xyv=colorHelper.RGBToXYV(rgb[0],rgb[1],rgb[2],radius),gradientHsv=colorHelper.RGBToHSV(rgb[0],rgb[1],rgb[2]),gradientStart=colorHelper.HSVToRGB(gradientHsv[0],gradientHsv[1],1);scope.currentX=xyv[0];scope.currentY=xyv[1];scope.hsvValue=xyv[2]*100;updateSaturationSample(rgb[0],rgb[1],rgb[2],longHex,gradientStart[3]);redrawWheelAndCursor(scope.currentX,scope.currentY);};scope.toggleColorPicker=function(event){scope.activeButton=$(event.target);if(scope.ngDisabled){return;}
if(!pickerDiv||!pickerDiv.is(currentWindowPicker)){destroyCurrentPicker();initPickerWindow();}
if(pickerDiv.is(":visible")){return hideColorPicker();}
pickerHelper.positionPicker(pickerButton,pickerDiv);var isValidColor=colorHelper.isValidHexColor(scope.internalModel);updateColorWheelTab(isValidColor?scope.internalModel:defaultColor()||"#FFFFFF");$document.on('mouseup',mouseUp);$document.on('mousedown',clickDocument);canvas.on('mousedown',mouseDown);scope.selectedTab=savedTab;pickerDiv.show();$document.on('keydown',keyDown);$timeout(function(){setTabFocus();});};function setTabFocus(){pickerDiv.find($('.ods-color-picker__menu-tab--active')).focus();}
function hideColorPicker(){$document.off('keyup',keyUp);$document.off('mouseup',mouseUp);$document.off('mousedown',clickDocument);$document.off('keydown',keyDown);if(canvas){canvas.off('mousemove',mouseMove);canvas.off('mouseup',mouseUp);canvas.off('mousedown',mouseDown);}
if(pickerDiv){var pickerDivArrow=pickerDiv.find('.ods-picker__arrow');pickerDiv.removeClass('ods-picker--fullscreen');pickerDivArrow.removeClass('ods-picker__arrow--top ods-picker__arrow--left ods-picker__arrow--right ods-picker__arrow--bottom ods-picker__arrow--hidden');pickerDiv.hide();scope.activeButton.focus();}}
scope.closePicker=function(){scope.selectedColor=scope.internalModel;savedTab=scope.selectedTab;pickerDiv.hide();scope.activeButton.focus();};scope.saveColor=function(){if(scope.selectedColor){scope.internalModel=scope.selectedColor;}
savedTab=scope.selectedTab;pickerDiv.hide();scope.activeButton.focus();};scope.changeTab=function(newTab){savedTab=newTab;scope.selectedTab=newTab;};scope.tabsCheckKey=function(event,tab){if(event.keyCode===13){scope.changeTab(tab);}};scope.hideColorPicker=hideColorPicker;function clickDocument(e){if(!pickerDiv){return;}
if(!jQuery(e.target).hasClass('ods-color-picker__window')&&jQuery(e.target).parents('.ods-color-picker__hex-color-input-wrapper').length===0&&jQuery(e.target).parents('.ods-color-picker__window').length===0){hideColorPicker();}}
scope.resetDefaultColor=function(){if(required){scope.selectedColor=defaultColor()||"#FFFFFF";}else{scope.selectedColor=defaultColor();}
scope.internalModel=scope.selectedColor;};scope.onHSVValueChange=function(){var hs=colorHelper.XYToHS(scope.currentX,scope.currentY,radius),rgb=colorHelper.HSVToRGB(hs[0],hs[1],scope.hsvValue/100),hexCode=colorHelper.RGBToHex(rgb[0],rgb[1],rgb[2]),gradientStartRgb=colorHelper.HSVToRGB(hs[0],hs[1],1),gradientStart=colorHelper.RGBToHex(gradientStartRgb[0],gradientStartRgb[1],gradientStartRgb[2]);updateSaturationSample(rgb[0],rgb[1],rgb[2],hexCode,gradientStart[1]);scope.selectedColor=hexCode;refreshResetButton(scope.internalModel);};function refreshResetButton(currentValue){if(!required||defaultColor()){if(currentValue!==defaultColor()){resetButton.show();}else{resetButton.hide();}}}
function mouseMove(e){var canvasOffset=canvas.offset(),canvasX=Math.floor(e.pageX-canvasOffset.left),canvasY=Math.floor(e.pageY-canvasOffset.top),hs=colorHelper.XYToHS(canvasX,canvasY,radius),rgb=colorHelper.HSVToRGB(hs[0],hs[1],scope.hsvValue/100),hexCode=colorHelper.RGBToHex(rgb[0],rgb[1],rgb[2]),gradientStartRgb=colorHelper.HSVToRGB(hs[0],hs[1],1),gradientStart=colorHelper.RGBToHex(gradientStartRgb[0],gradientStartRgb[1],gradientStartRgb[2]);scope.currentX=canvasX;scope.currentY=canvasY;updateSaturationSample(rgb[0],rgb[1],rgb[2],hexCode,gradientStart);redrawWheelAndCursor(scope.currentX,scope.currentY);scope.selectedColor=hexCode;refreshResetButton(scope.internalModel);}
scope.canvasCheckKey=function(event){var newX,newY;if(event.keyCode===37){newX=scope.currentX-1;newY=scope.currentY;}else if(event.keyCode===38){newY=scope.currentY-1;newX=scope.currentX;}else if(event.keyCode===39){newX=scope.currentX+1;newY=scope.currentY;}else if(event.keyCode===40){newY=scope.currentY+1;newX=scope.currentX;}
if(Math.hypot(90-newX,90-newY)<90){scope.currentX=newX;scope.currentY=newY;var hs=colorHelper.XYToHS(scope.currentX,scope.currentY,radius),rgb=colorHelper.HSVToRGB(hs[0],hs[1],scope.hsvValue/100),hexCode=colorHelper.RGBToHex(rgb[0],rgb[1],rgb[2]),gradientStartRgb=colorHelper.HSVToRGB(hs[0],hs[1],1),gradientStart=colorHelper.RGBToHex(gradientStartRgb[0],gradientStartRgb[1],gradientStartRgb[2]);updateSaturationSample(rgb[0],rgb[1],rgb[2],hexCode,gradientStart);redrawWheelAndCursor(scope.currentX,scope.currentY);}};function updateSaturationSample(red,green,blue,hex,gradientStart){if(!hex){hex=colorHelper.RGBToHex(red,green,blue);}
saturationInput.css('background','linear-gradient(to left, '+gradientStart+', black)');saturationSample.css('background',hex);saturationSampleHexcode.text(hex);if(colorHelper.isDarkColor(red,green,blue)){saturationSampleHexcode.css('color','white');}else{saturationSampleHexcode.css('color','black');}}
function redrawWheelAndCursor(cursorX,cursorY){ctx.putImageData(imageData,0,0);drawCursor(cursorX,cursorY,ctx);ctx.beginPath();ctx.lineWidth=4;ctx.arc(radius,radius,radius,0,2*Math.PI);ctx.strokeStyle="white";ctx.stroke();}
scope.onTextClick=function($event){$event.target.select();};scope.$on('$destroy',function(){hideColorPicker();});function mouseUp(){canvas.off('mousemove',mouseMove);canvas.off('mouseup',mouseUp);}
function mouseDown(e){canvas.on('mousemove',mouseMove);canvas.on('mouseup',mouseUp);mouseMove(e);}
function keyUp(event){if(event.keyCode===27){scope.closePicker();}else if(event.keyCode===13){scope.saveColor();}}
function keyDown(event){if(event.keyCode===27){hideColorPicker();}}}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsConfirmClick',['$compile','translate','$timeout','$interpolate',function($compile,translate,$timeout,$interpolate){return{restrict:'A',controller:function($scope,$element,$attrs){var $confirm;var template=''+'<div class="ods-confirm-click" >'+'    <div class="ods-confirm-click__backdrop"></div>'+'    <div class="ods-confirm-click__body" role="alertdialog" aria-labelledby="ods-confirm-click-title">'+'        <div class="ods-confirm-click__title">'+'            <span id="ods-confirm-click-title" ng-bind="title"></span>'+'        </div>'+'        <div class="ods-confirm-click__message" ng-bind="message" id="ods-confirm-click-description"></div>'+'        <div class="ods-confirm-click__actions">'+'            <button class="ods-button ods-confirm-click__action" '+'                    ng-class="cancelStyle"'+'                    ng-click="destroyConfirm()">'+'                <span translate>Cancel</span>'+'            </button>'+'            <button class="ods-button ods-button--primary ods-confirm-click__action" ng-class="buttonStyle"'+'                    ng-click="applyAction()"'+'                    ng-bind="label"'+'                    autofocus></button>'+'        </div>'+'    </div>'+'</div>';var destroyConfirm=function(){$confirm.remove();$('body').css('overflow-y','visible');$element.focus();};var applyAction=function(){$scope.$applyAsync($attrs.odsConfirmClickAction);destroyConfirm();};var parseAttribute=function(name,defaultValue){return angular.isDefined($attrs[name])?$attrs[name]:defaultValue;};var buildConfirmScope=function(){var confirmScope=$scope.$new();confirmScope.title=parseAttribute('odsConfirmClickTitle',translate('Please confirm'));confirmScope.message=parseAttribute('odsConfirmClickMessage',translate('Are you sure you want to proceed with this action?'));confirmScope.label=parseAttribute('odsConfirmClickButtonLabel',translate('OK'));confirmScope.applyAction=applyAction;confirmScope.destroyConfirm=destroyConfirm;confirmScope.type=parseAttribute('odsConfirmClickType');if(confirmScope.type==='danger'){confirmScope.buttonStyle='ods-button--danger';confirmScope.iconStyle='ods-confirm-click__icon--danger';confirmScope.cancelStyle='ods-confirm-click__cancel-button--danger';}else if(confirmScope.type==='neutral'){confirmScope.buttonStyle='';confirmScope.iconStyle='';confirmScope.cancelStyle='ods-confirm-click__cancel-button';}else{confirmScope.buttonStyle='ods-button--primary';confirmScope.cancelStyle='ods-confirm-click__cancel-button';}
return confirmScope;};$element.on('click',function(){if(angular.isDefined($attrs.ngDisabled)&&$scope.$eval($attrs.ngDisabled)){return;}
$confirm=$compile(template)(buildConfirmScope());$('.ods-content').append($confirm);$('body').css('overflow-y','hidden');$confirm.on('keyup',function(event){if(event.keyCode==27){destroyConfirm();}});$timeout(function(){$confirm.find('.ods-confirm-click__action.ods-button.ods-button--primary').focus();});});}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.factory('odsCountriesListProvider',['config','$http',function(config,$http){var lang=config.LANGUAGE;var promise=$http.get('/static/countries/'+lang+'/'+lang+'.json');return{promise:promise};}]);mod.directive("odsCountriesList",['odsCountriesListProvider',function(odsCountriesListProvider){return{restrict:'E',template:'<select ng-model="selectedCountryCode">'+' <option ng-repeat="country in topCountriesList | orderBy:\'name\'" value="{{country.code}}">{{country.name}}</option>'+' <option ng-if="topCountries !== undefined">--------</option>'+' <option ng-repeat="country in countriesList | orderBy:\'name\'" value="{{country.code}}">{{country.name}}</option>'+'</select>'+'',scope:{topCountries:'=',restrictToCountries:'='},require:'ngModel',link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$render=function(){scope.selectedCountryCode=ngModelCtrl.$viewValue;};scope.$watch('selectedCountryCode',function(nv){ngModelCtrl.$setViewValue(nv);});odsCountriesListProvider.promise.then(function(response){var data=response.data;var country;scope.countriesList=[];scope.topCountriesList=[];angular.forEach(data,function(value,key){country={code:key,name:value};if(isNullOrUndefined(scope.restrictToCountries)||scope.restrictToCountries.indexOf(key)>-1){scope.countriesList.push(country);if(!isNullOrUndefined(scope.topCountries)&&scope.topCountries.indexOf(key)>-1){scope.topCountriesList.push(country);}}});});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');var positionEmbed=function(elem,position){var datasetItem=elem.find('.dataset-item').first();var cardHeight=jQuery(elem.find('.card-container')).outerHeight();if(position==="bottom"){jQuery(datasetItem).css('top',0);jQuery(datasetItem).css('bottom',cardHeight);}else{jQuery(datasetItem).css('top',cardHeight);jQuery(datasetItem).css('bottom',0);}};mod.directive('odsDatasetCard',function(){return{restrict:'E',scope:{context:'='},template:'<div class="odswidget odswidget-dataset-card">'+'   <div class="card-container" ng-class="{bottom: position == \'bottom\', expanded: expanded, expandable: isExpandable()}">'+'       <h2 class="dataset-title" ng-click="expanded = !expanded" ng-show="!expanded || (expanded && !context.dataset.metas.description)">{{context.dataset.metas.title}}</h2>'+'       <div ng-click="expanded = !expanded" class="expand-control" title="Show/hide details" translate="title">'+'           <span translate>Details</span> '+'           <i class="fa fa-chevron-down" ng-show="!expanded" aria-hidden="true"></i>'+'           <i class="fa fa-chevron-up" aria-hidden="true" ng-hide="!expanded"></i>'+'       </div>'+'       <div class="dataset-expanded" ng-click="expanded = !expanded"">'+'           <h2 class="dataset-title" ng-show="expanded">'+'               {{context.dataset.metas.title}}'+'           </h2>'+'           <p class="dataset-description" ng-if="expanded" ng-bind-html="context.dataset.metas.description"></p>'+'       </div>'+'       <div class="dataset-infos">'+'           <span class="dataset-infos-text">'+'               <a ng-href="{{datasetUrl}}" target="_blank" ng-bind-html="websiteName"></a>'+'               <span ng-show="context.dataset.metas.license"> - '+'                   <span translate>License</span> '+'                   {{context.dataset.metas.license}}'+'               </span>'+'           </span>'+'       </div>'+'   </div>'+'   <div class="dataset-item" ng-transclude></div>'+'</div>',replace:true,transclude:true,link:function(scope,elem,attrs){scope.position=attrs.position||"top";},controller:['$scope','$element','ODSWidgetsConfig','$transclude','$sce','$timeout',function($scope,$element,ODSWidgetsConfig,$transclude,$sce,$timeout){$scope.websiteName=ODSWidgetsConfig.websiteName;$scope.expanded=false;$scope.isExpandable=function(){if(!$scope.context||!$scope.context.dataset||!$scope.context.dataset.datasetid){return false;}
if(!$scope.context.dataset.metas.description){return false;}
return true;};var unwatch=$scope.$watch('context',function(nv,ov){if(!nv||!nv.dataset){return;}
$timeout(function(){positionEmbed($element,$scope.position);},0);$scope.expanded=false;$scope.datasetUrl=$scope.context.domainUrl+'/explore/dataset/'+$scope.context.dataset.datasetid+'/';if(!$scope.websiteName){$scope.websiteName=$scope.context.domainUrl;}
unwatch();},true);positionEmbed($element,$scope.position);}]};});mod.directive('odsMultidatasetsCard',['ODSWidgetsConfig',function(ODSWidgetsConfig){return{restrict:'E',scope:{odsTitle:'=',datasets:'=',context:'='},template:'<div class="odswidget-multidatasets-card">'+'   <div class="card-container multidatasets" ng-class="{bottom: (position == \'bottom\'), expanded: expanded, expandable: isExpandable()}">'+'       <h2 ng-show="!expanded" ng-click="tryToggleExpand()">'+'           {{ odsTitle }}'+'       </h2>'+'       <div ng-click="tryToggleExpand()" class="expand-control" ng-class="{expanded: expanded}" title="Show/hide details">'+'           <span translate>Details</span> '+'           <i class="fa fa-chevron-down" aria-hidden="true"></i>'+'       </div>'+'       <h3 class="datasets-counter" ng-click="tryToggleExpand()" ng-show="!expanded">'+'           <span class="count-text" ng-hide="!datasetObjectKeys || datasetObjectKeys.length <= 1">'+'               <span translate translate-n="datasetObjectKeys.length" translate-plural="{{ $count }} datasets">{{ $count }} dataset</span>'+'          </span>'+'       </h3>'+'       <div class="datasets-expanded">'+'           <h2 ng-show="expanded" ng-click="tryToggleExpand()">'+'               {{ odsTitle }}'+'           </h2>'+'           <h3 class="datasets-counter" ng-click="tryToggleExpand()" ng-show="expanded">'+'               <span class="count-text">'+'                   <span ng-if="datasetObjectKeys.length == 0" translate>no dataset to display</span>'+'                   <span ng-if="datasetObjectKeys.length > 0" translate translate-n="datasetObjectKeys.length" translate-plural="{{ $count }} datasets">{{ $count }} dataset</span>'+'               </span>'+'           </h3>'+'           <ul class="dataset-list"'+'              ng-show="(datasetObjectKeys && datasetObjectKeys.length === 1) || (isExpandable() && expanded)"'+'              ng-class="{\'single-dataset\': datasetObjectKeys.length === 1}">'+'               <li ng-repeat="(key, dataset) in datasets"> '+'                   <a ng-href="{{context.domainUrl}}/explore/dataset/{{dataset.datasetid}}/" target="_blank">{{ dataset.metas.title }}</a>'+'                  <span ng-show="dataset.metas.license">- <span translate>License</span> {{ dataset.metas.license }}</span>'+'               </li>'+'           </ul>'+'       </div>'+'       <div class="dataset-infos">'+'           <span class="dataset-infos-text">'+'               <a ng-href="/" target="_blank" ng-bind-html="websiteName"></a>'+'           </span>'+'       </div>'+'   </div>'+'   <!-- embedded content (chart, map etc.) -->'+'   <div class="dataset-item" ng-transclude></div>'+'</div>',replace:true,transclude:true,link:function(scope,elem,attrs){scope.position=attrs.position||"top";},controller:['$scope','$element','ODSWidgetsConfig','$transclude','$sce','$timeout',function($scope,$element,ODSWidgetsConfig,$transclude,$sce,$timeout){$scope.datasetObjectKeys=[];$scope.websiteName=ODSWidgetsConfig.websiteName;$scope.isExpandable=function(){if(!$scope.datasetObjectKeys.length||($scope.datasetObjectKeys.length===1)){return false;}
return true;};$scope.tryToggleExpand=function(){if($scope.isExpandable()){$scope.expanded=!$scope.expanded;}};var unwatch=$scope.$watch('datasets',function(nv,ov){if(nv){var keys=Object.keys(nv);if(keys.length===0){return;}
$scope.datasetObjectKeys=keys;$timeout(function(){positionEmbed($element,$scope.position);},0);$scope.expanded=false;unwatch();}},true);$timeout(function(){positionEmbed($element,$scope.position);},0);}]};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsDatasetFeedback',['$compile','$window',function($compile,$window){var template='<div class="odswidget-dataset-feedback">'+'<div class="odswidget-dataset-feedback__container">'+'<div class="odswidget-dataset-feedback__close-button"><i class="fa fa-times" aria-hidden="true"></i></div>'+'<ods-dataset-feedback-interface dataset="odsDatasetFeedbackDataset" record="odsDatasetFeedbackRecord"></ods-dataset-feedback-interface>'+'</div>'+'</div>';return{restrict:'A',scope:{odsDatasetFeedbackDataset:'=',odsDatasetFeedbackRecord:'='},link:function(scope,element,attrs){if(scope.odsDatasetFeedbackDataset.getExtraMeta('explore','feedback_enabled')){element.on('click',function(){var body=angular.element($window.document.body);var overlay=$compile(template)(scope);body.append(overlay);var close=function(){overlay.remove();};overlay.on('click',function(e){close();});scope.$on('closeDatasetFeedbackOverlay',close);scope.$apply();});}else{console.warn('dataset feedback is not enabled for this dataset');}}};}]);mod.directive('odsDatasetFeedbackInterface',function(){return{restrict:'E',scope:{dataset:'=',record:'='},templateUrl:'/static/ods/html/dataset-feedback-interface.html',link:function(scope,element,attrs){element.on('click',function(e){e.stopPropagation();});},controller:['$scope','$filter','$http','$timeout','SearchAPI',function($scope,$filter,$http,$timeout,SearchAPI){if($scope.record){$scope.newValues=angular.copy($scope.record.fields);}else{$scope.newValues={};}
var geoshapeFieldCount=$scope.dataset.fields.filter(function(field){return field.type=='geo_shape';}).length;$scope.feedbackFields=$scope.dataset.fields.filter(function(field){if(field.type==='geo_point_2d'){if(geoshapeFieldCount>0){geoshapeFieldCount-=1;return false;}else{return true;}}
return field.type!=='file';});$scope.hasNewValue=function(field){if(field.type=='datetime'||field.type=='date'){return moment($scope.record.fields[field.name]).utc().format()!=moment($scope.newValues[field.name]).utc().format();}
else{return!angular.equals($scope.record.fields[field.name],$scope.newValues[field.name]);}};$scope.isGeoField=function(field){return field.type=='geo_point_2d'||field.type=='geo_shape';};$scope.send=function(){var submittedValues={};angular.forEach($scope.newValues,function(value,key){if(!$scope.record||angular.isUndefined($scope.record.fields[key])||!angular.equals($scope.record.fields[key],value)){submittedValues[key]=value;}});var payload={'schema':$scope.dataset.fields,'recordid':$scope.record?$scope.record.recordid:null,'newValues':submittedValues,'comment':$scope.userComment};$scope.working=true;SearchAPI.datasets.feedback($scope.dataset.datasetid,payload).then(function(){$scope.working=false;$scope.sent=true;$timeout(function(){$scope.$emit('closeDatasetFeedbackOverlay');},2000);},function(){$scope.working=false;});};}]};});}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsDatasetSelectionWithPermissions',['$window','$compile','config','ManagementAPI','translate','BackofficeConfig',function($window,$compile,config,ManagementAPI,translate,BackofficeConfig){return{restrict:'E',scope:{presets:'&',selectionCallback:'&',customSources:'=',filteringEnabled:'=?',preventDatasetChange:'=?'},templateUrl:'/static/ods/html/dataset-selection-with-permissions.html',link:function(scope){scope.BRAND_HOSTNAME=config.BRAND_HOSTNAME;scope.FQ_USERNAME=config.FQ_USERNAME;scope.samlEnabled=BackofficeConfig.SAML_ENABLED;scope.oidcEnabled=BackofficeConfig.OIDC_ENABLED;scope.loading=true;scope.user_display_name='';scope.local_account=false;scope.setSelection=function(selection){$.extend(scope.selection,selection);var is_selection_valid=scope.selectionCallback({selection:scope.selection});if(is_selection_valid===false){clearSelection();}
scope.user_display_name=(scope.selection.userId&&scope.selection.userId.split('@')[0])||'';if(scope.selection.userId&&scope.selection.userId.split('@').length===2){scope.local_account=true;}else{scope.local_account=false;}
if(selection.dataset){scope.selection_details=selection.dataset;}};var getFederationParameters=function(presets){if(presets.domainId&&presets.datasetId){return{datasetid:presets.datasetId,domainid:presets.domainId,userid:presets.userId};}
return false;};var initSelection=function(){scope.selection={};scope.selection_details={};var presets=scope.presets();if(presets){if(getFederationParameters(presets)){ManagementAPI.datasets.show_remote_unverified(getFederationParameters(presets)).then(function(response){var dataset=response.data;if(dataset.error){if(dataset.error=="unknown_dataset"){scope.error=translate('The selected dataset does not exist or is not accessible anymore.');presets.datasetId='';scope.selection.datasetId='';scope.selectionCallback({'selection':presets});scope.setSelection(presets);}else{scope.setSelection(presets);}}else{scope.setSelection($.extend(presets,{dataset:dataset}));}
scope.loading=false;},function(){scope.setSelection(presets);scope.loading=false;});}else{scope.setSelection(presets);scope.loading=false;}}};var clearSelection=function(){initSelection();scope.selectionCallback({});};initSelection();}};}]);mod.directive('odsDatasetSelection',['$window','$compile','config','ManagementAPI',function($window,$compile,config,ManagementAPI){return{restrict:'A',scope:{odsDatasetSelectionPresets:'&',odsDatasetSelectionCallback:'&',odsDatasetSelectionCustomSources:'@',odsDatasetSelectionFilteringEnabled:'=?',odsDatasetSelectionCentralstoreDisabled:'=?',odsDatasetSelectionRelatedDomainsDisabled:'=?',odsDatasetSelectionSharedCatalogDisabled:'=?',odsDatasetSelectionPreventDatasetChange:'=?'},link:function(scope,element){var relatedDomainIds=[];var init=function(){element.on('click',function(e){e.preventDefault();scope.presets=scope.odsDatasetSelectionPresets();if(scope.presets.datasetId){if(angular.isDefined(scope.presets.domainId)&&scope.presets.domainId!==config.DOMAIN_ID){if(relatedDomainIds.indexOf(scope.presets.domainId)>-1){scope.presets.source='related@'+scope.presets.domainId;}else{scope.presets.source='central';scope.presets.datasetId=scope.presets.datasetId+'@'+scope.presets.domainId;}}}
scope.presets.domainId=null;scope.filteringEnabled=scope.odsDatasetSelectionFilteringEnabled;var body=angular.element($window.document.body);var overlay=$compile(''+'<div class="ods-dataset-selection__overlay">'+'    <div class="ods-dataset-selection__container container">'+'        <div class="ods-dataset-selection__close-button" ng-click="close()">'+'            <i class="icon-remove fa fa-close"></i>'+'        </div>'+'        <div id="ods-dataset-selection__interface-container" class="ods-dataset-selection__interface-container">'+'            <ods-dataset-selection-interface '+'                custom-sources="{{ odsDatasetSelectionCustomSources }}"'+'                filtering-enabled="filteringEnabled"'+'                presets-catalog-parameters="presets.catalogParameters"'+'                presets-dataset-parameters="presets.datasetParameters"'+'                presets-source="'+ODS.StringUtils.escapeHTML(scope.presets.source||'')+'"'+'                presets-dataset-id="'+ODS.StringUtils.escapeHTML(scope.presets.datasetId||'')+'"'+'                presets-domain-id="'+ODS.StringUtils.escapeHTML(scope.presets.domainId||'')+'"'+'                callback="odsDatasetSelectionCallback({selection: selection})"'+'                centralstore-disabled="odsDatasetSelectionCentralstoreDisabled"'+'                related-domains-disabled="odsDatasetSelectionRelatedDomainsDisabled"'+'                shared-catalog-disabled="odsDatasetSelectionSharedCatalogDisabled"'+'                prevent-dataset-change="odsDatasetSelectionPreventDatasetChange"'+'                ></ods-dataset-selection-interface>'+'        </div>'+'    </div>'+'</div>'+'</ods-dataset-selection-interface></div>')(scope);body.css('overflow-y','hidden');body.append(overlay);scope.close=function(){body.css('overflow-y','');overlay.remove();};overlay.on('click',function(){scope.close();});scope.$on('closeDatasetSelectionOverlay',scope.close);overlay.find('.ods-dataset-selection__interface-container').on('click',function(e){e.stopPropagation();});return false;});};if(!scope.odsDatasetSelectionRelatedDomainsDisabled&&!scope.odsDatasetSelectionCentralstoreDisabled&&config.HAS_RELATED_DOMAINS){ManagementAPI.subdomains.related_domains().then(function(response){var data=response.data;var relatedDomains=[];if(!angular.equals(data.parent_domain,{})){relatedDomains.push(data.parent_domain);}
relatedDomains=relatedDomains.concat(data.subdomains,data.sibling_domains);relatedDomainIds=relatedDomains.map(function(relatedDomain){return relatedDomain.domain_id;});init();});}else{init();}},controller:function(){}};}]);mod.directive('odsDatasetSelectionInterface',['$compile','config',function($compile,config){return{restrict:'E',scope:{presetsSource:'@',presetsDatasetId:'@',presetsDomainId:'@',presetsCatalogParameters:'=',presetsDatasetParameters:'=',customSources:'@',callback:'&',filteringEnabled:'=?',centralstoreDisabled:'=?',relatedDomainsDisabled:'=?',sharedCatalogDisabled:'=?',preventDatasetChange:'=?'},template:'<div class="ods-dataset-selection-interface"></div>',link:function(scope,element){var container=$(element);scope.$on('changeDatasetSelectionSource',function(e,source){refreshList(source,null,null,scope.presetsCatalogParameters);});scope.$on('changeDatasetSelectionCustomSource',function(e,domainid,apikey){refreshList('custom',null,null,scope.presetsCatalogParameters,domainid,apikey);});var containedScope=null;var refreshList=function(source,datasetid,domainid,catalogParameters,customDomainID,customAPIKey){if(containedScope){containedScope.$destroy();}
containedScope=scope.$new(false);containedScope.source=source;if(datasetid){containedScope.datasetid=datasetid;}
if(domainid){containedScope.domainid=domainid;}
if(catalogParameters){containedScope.catalogParameters=catalogParameters;}
if(source==='custom'){containedScope.domainid=customDomainID;containedScope.apiKey=customAPIKey;}
containedScope.catalogParameters=containedScope.catalogParameters||{};containedScope.catalogParameters.source=source;if(source==='subdomains'){containedScope.catalogParameters['refine.parent_domain']=config.DOMAIN_ID;containedScope.catalogParameters.source='central';}else{delete containedScope.catalogParameters['refine.parent_domain'];}
var list=$compile('<ods-dataset-selection-list '+'    filtering-enabled="filteringEnabled"'+'    api-key="{{apiKey}}"'+'    custom-sources="{{customSources}}"'+'    catalog-parameters="catalogParameters" '+'    dataset-parameters="presetsDatasetParameters" '+'    source="{{source}}" '+'    domainid="{{domainid}}" '+'    datasetid="{{datasetid}}" '+'    callback="callback({selection: selection})"'+'    centralstore-disabled="centralstoreDisabled"'+'    related-domains-disabled="relatedDomainsDisabled"'+'    shared-catalog-disabled="sharedCatalogDisabled"'+'    prevent-dataset-change="preventDatasetChange"'+'></ods-dataset-selection-list>')(containedScope);container.empty().append(list);};refreshList(scope.presetsSource,scope.presetsDatasetId,scope.presetsDomainId,scope.presetsCatalogParameters);}};}]);mod.directive('odsDatasetSelectionList',['config','ODSWidgetsConfig','ManagementAPI',function(config,ODSWidgetsConfig,ManagementAPI){return{restrict:'E',scope:{source:'@',domainid:'@',datasetid:'@',catalogParameters:'=',datasetParameters:'=',callback:'&',customSources:'@',apiKey:'@',filteringEnabled:'=?',centralstoreDisabled:'=?',relatedDomainsDisabled:'=?',sharedCatalogDisabled:'=?',preventDatasetChange:'=?'},templateUrl:'/static/ods/html/dataset-selection-list.html',controller:function($scope){$scope.BRAND_HOSTNAME=config.BRAND_HOSTNAME;$scope.PORTAL_TITLE=ODSWidgetsConfig.websiteName;$scope.CENTRALSTORE=config.CENTRALSTORE;$scope.PARENT_DOMAIN=config.PARENT_DOMAIN;$scope.HAS_RELATED_DOMAINS=config.HAS_RELATED_DOMAINS;$scope.DOMAIN_ID=config.DOMAIN_ID;$scope.HAS_SHARED_CATALOG=config.HAS_SHARED_CATALOG;$scope.catalogParameters=$scope.catalogParameters?$scope.catalogParameters:{};$.extend($scope.catalogParameters,{'sort':'modified'});$scope.presetDatasetParameters=angular.copy($scope.datasetParameters);$scope.presetCatalogParameters=angular.copy($scope.catalogParameters);if($scope.datasetid){$scope.exploredDatasetID=$scope.datasetid;}
if(!$scope.relatedDomainsDisabled&&!$scope.centralstoreDisabled&&$scope.HAS_RELATED_DOMAINS){ManagementAPI.subdomains.related_domains().then(function(response){var data=response.data;var relatedDomains=[];if(!angular.equals(data.parent_domain,{})){relatedDomains.push(data.parent_domain);}
relatedDomains=relatedDomains.concat(data.subdomains,data.sibling_domains);$scope.relatedDomains=relatedDomains;});}
$scope.showMapFilter=false;$scope.exploreDataset=function(datasetID){$scope.exploredDatasetID=datasetID;};$scope.exploreCatalog=function(){$scope.exploredDatasetID=null;$scope.catalogParameters=angular.copy($scope.presetCatalogParameters);};$scope.changeSource=function(source){$scope.$emit('changeDatasetSelectionSource',source);};$scope.refreshCustomSource=function(domainid,apikey){$scope.$emit('changeDatasetSelectionCustomSource',domainid,apikey);};$scope.selectDataset=function(dataset,parameters){var domainid,datasetid;if($scope.source==='central'||($scope.source==='shared'&&dataset.datasetid.indexOf('@')>-1)){var tokens=dataset.datasetid.split('@');datasetid=tokens[0];domainid=tokens[1];}else if($scope.source==='shared'){datasetid=dataset.datasetid;domainid=config.DOMAIN_ID;}else{datasetid=dataset.datasetid;domainid=dataset.metas.domain;}
$scope.$emit('closeDatasetSelectionOverlay');$scope.callback({selection:{source:$scope.source,domainId:domainid,datasetId:datasetid,datasetParameters:angular.copy(parameters),dataset:dataset}});};$scope.isContextFiltered=function(context){if(!context.parameters){return false;}
var filtered=false;angular.forEach(context.parameters,function(value,key){if(value!==null&&value!==''){if(['q','rq','geofilter.polygon','geofilter.distance'].indexOf(key)){filtered=true;}
if(key.startsWith('refine.')||key.startsWith('exclude.')){filtered=true;}}});return filtered;};}};}]);}());;(function(){"use strict";var mod=angular.module('ods.core');mod.directive('odsDatetimePicker',['ModuleLazyLoader',function(ModuleLazyLoader){var lpad=function(val){val=val.toString();while(val.length<2){val='0'+val;}
return val;};var formatTimeToISO=function(time){if(time){return moment(time).milliseconds(0).toISOString().replace('.000Z','Z');}else{return null;}};var romeOptions={styles:{container:"rd-container odswidgets-rd-container"},weekStart:1};return{restrict:'E',replace:true,scope:{ngModel:'=',format:'@',odsDisabled:'=',displayTime:'@'},require:'ngModel',template:''+'<div class="ods-datetime-picker">'+'   <div class="ods-datetime-picker__date">'+'       <input type="text" class="ods-datetime-picker__date-input" ng-class="{\'ods-datetime-picker__date-input--disabled\': odsDisabled}" ng-disabled="odsDisabled" ng-model="internalModel" placeholder="{{ format }}"></input>'+'       <i class="ods-datetime-picker__calendar-addon fa fa-calendar" ng-hide="odsDisabled"></i>'+'   </div>'+'   <span ng-if="timezone" class="ods-datetime-picker__timezone" translate>Local time ({{timezone}})</span>'+'</div>',link:function(scope,element,attrs,ngModel){scope.format=scope.format||'YYYY-MM-DD HH:mm:ss';var isDateTime=scope.format.indexOf(' ')>-1;scope.timezone=null;if(isDateTime){var offset=new Date().getTimezoneOffset();scope.timezone=((offset<0?'+':'-')+
lpad(parseInt(Math.abs(offset/60),10))+':'+
lpad(Math.abs(offset%60)));}
ModuleLazyLoader('rome').then(function(){if(typeof scope.displayTime==="undefined"){scope.displayTime=true;}else{scope.displayTime=(scope.displayTime==="true");}
rome(element.find('input')[0],angular.extend({},romeOptions,{time:scope.displayTime,inputFormat:scope.dateFormat})).on('data',function(value){scope.$apply(function(){scope.internalModel=formatTimeToISO(moment(value,scope.dateFormat));});});});scope.$watch('internalModel',function(nv,ov){if(nv){if(isDateTime){scope.ngModel=(moment(nv,"YYYY-MM-DD HH:mm:ss")).toISOString().replace('.000','').replace('Z',"+00:00");}else{scope.ngModel=nv;}}});scope.$watch('ngModel',function(nv,ov){var date;if(nv){if(isDateTime){date=moment(nv);scope.internalModel=date.format('YYYY-MM-DD HH:mm:ss');}else{date=moment(nv);scope.internalModel=date.format('YYYY-MM-DD');}}});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsDropdownPosition',function(){return{restrict:'A',controller:function($scope,$element,$attrs){var controlElement,optionsElement,maxOptionsHeight=200,callbackName='repositionDropdown'||$attrs.odsDropdownPosition;this.setControlElement=function(element){controlElement=element;};this.setOptionsElement=function(element,maxHeight){optionsElement=element;maxOptionsHeight=maxHeight;};$scope[callbackName]=function(){var availableBottomSpace=$(document).height()-controlElement.offset().top-controlElement.height();var availableTopSpace=controlElement.offset().top;var optionsHeight=optionsElement.height();var neededSpace=Math.min(optionsHeight,maxOptionsHeight);if(availableBottomSpace<neededSpace&&availableTopSpace>=neededSpace){optionsElement.css({'bottom':controlElement.height()+'px'});return'top';}
return'bottom';};}};});mod.directive('odsDropdownPositionControl',function(){return{restrict:'A',require:'^odsDropdownPosition',link:function(scope,element,attrs,dropdownPositionCtrl){dropdownPositionCtrl.setControlElement(element);}};});mod.directive('odsDropdownPositionOptions',function(){return{restrict:'A',require:'^odsDropdownPosition',link:function(scope,element,attrs,dropdownPositionCtrl){var maxHeight=parseInt(attrs.odsDropdownPositionOptionsHeight,10);dropdownPositionCtrl.setOptionsElement(element,maxHeight);}};});})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsEmbedControl',['$location','translate','WidgetCodeBuilder',function($location,translate,WidgetCodeBuilder){function buildWidgetCode(embedType,context){if(embedType==="cartograph"){return"";}else if(embedType==="table"){return WidgetCodeBuilder.buildTableWidgetCode(context,$location.search());}else if(embedType==="analyze"){var encodedChartConfig=$location.search()['dataChart'];if(encodedChartConfig){return WidgetCodeBuilder.buildChartWidgetCode(JSON.parse(b64_to_utf8(encodedChartConfig)));}else{return"";}}else if(embedType==="media-gallery"){return WidgetCodeBuilder.buildMediaWidgetCode(context,$location.search());}else if(embedType==="map"){return WidgetCodeBuilder.buildMapWidgetCode(context,$location.search());}else if(embedType==="calendar"){return WidgetCodeBuilder.buildCalendarWidgetCode(context);}else if(embedType==="custom"){return WidgetCodeBuilder.buildCustomViewCode(context);}}
function removeURLParameter(url,parameter){var urlparts=url.split('?');if(urlparts.length>=2){var prefix=encodeURIComponent(parameter)+'=';var pars=urlparts[1].split(/[&;]/g);for(var i=pars.length;i-->0;){if(pars[i].lastIndexOf(prefix,0)!==-1){pars.splice(i,1);}}
url=urlparts[0]+(pars.length>0?'?'+pars.join('&'):"");return url;}else{return url;}}
return{restrict:'E',replace:true,scope:{embedType:'@',anonymousAccess:'=',multidatasets:'@',defaultCollapse:'@',context:'=?',forceEmbedDatasetCard:'=',widgetCode:'=?'},templateUrl:'/static/ods/html/embed_control.html',controller:function($scope,$timeout){$scope.sizes=[{name:'small',label:'',width:400,height:300},{name:'medium',label:'',width:600,height:450},{name:'large',label:'',width:800,height:600},{name:'custom',label:translate('Custom size'),width:600,height:450}];angular.forEach($scope.sizes,function(value){if(value.label===''){value.label=value.width+'  '+value.height;}});$scope.tab='share';$scope.size=$scope.sizes[0];$scope.embedUrlOptions={'static':false,datasetcard:$scope.forceEmbedDatasetCard||false};$scope.mapOptions={scrollWheelZoom:false};var _computeShareUrl=function(url,embedType){if(embedType==='cartograph'){url=url.replace('/map/','/map/embed/');}else if(embedType==='chartbuilder'){url=url.replace('/chart/','/chart/embed/');}else{url=url.replace('/explore/','/explore/embed/');}
return $scope.context&&$scope.context.dataset.metas.timezone?removeURLParameter(url,'timezone'):url;};var _computeEmbedUrl=function(url,options,embedType){url=_computeShareUrl(url,embedType);if(url.indexOf('?')===-1){url+='?';}
angular.forEach(options,function(value,key){url+='&'+key+'='+value;});return $scope.context&&$scope.context.dataset.metas.timezone?removeURLParameter(url,'timezone'):url;};var updateUrls=function(){var baseUrl=''+$location.absUrl();$scope.share_url=_computeShareUrl(baseUrl,$scope.embedType);$scope.embed_url=_computeEmbedUrl(baseUrl,getUrlOptions(),$scope.embedType);};var getUrlOptions=function(){var options=$scope.embedUrlOptions;if($scope.embedType==='map'){options=$.extend({},options,$scope.mapOptions);}
return options;};var init=function(){if($scope.widgetCode){$scope.$watch('[widgetCode, embedUrlOptions, mapOptions]',function(){updateUrls();if($scope.tab==='widget'&&!$scope.widgetCode){$scope.tab='share';}},true);}else{$scope.loc=$location;$scope.$watch('[loc.absUrl(), embedUrlOptions, mapOptions]',function(){updateUrls();$scope.widgetCode=buildWidgetCode($scope.embedType,$scope.context);if($scope.tab==='widget'&&!$scope.widgetCode){$scope.tab='share';}},true);}};if($scope.context){$scope.context.wait().then(function(dataset){init();});}else{init();}
$timeout(function(){$scope.$emit('embedControlLoaded');},0);}};}]);})();;(function(){"use strict";var mod=angular.module('ods.core');mod.directive('odsFlashContainer',['FlashService',function(FlashService){return{restrict:'E',scope:true,template:''+'<div class="ods-flash-container">'+'   <ods-flash-message ng-repeat="flash in flashes | filter:filterType"'+'       is-dismissible="flash.isDismissible"'+'       on-dismiss="dismiss(flash)"'+'       type="flash.type"'+'       content="flash.content"></ods-flash-message>'+'</div>',link:function($scope,element,attrs){var filterType=(attrs.type?attrs.type:'all');$scope.filterType=function(value){return(filterType==='all'||value.type===filterType);};$scope.flashes=FlashService.flashes;$scope.dismiss=function(flash){FlashService.dismiss(flash);};}};}]);mod.directive('odsFlashMessage',['$sce',function($sce){return{restrict:'E',scope:{'type':'=','content':'=','isDismissible':'=','onDismiss':'&?'},transclude:true,template:''+'<div class="ods-flash-message {{ \'ods-flash-message--\' + (type ? type : \'info\') }}">'+'   <p class="ods-flash-message__content"></p>'+'   <i ng-if="isDismissible" class="fa fa-times" ng-click="dismiss()"></i>'+'</div>',link:function($scope,element,attrs,ctrl,transclude){transclude(function(clone){var contentContainer=element.find(".ods-flash-message__content");if($scope.content){contentContainer.html($sce.getTrustedHtml($scope.content));}else{contentContainer.html(clone);}});$scope.dismiss=function(){if($scope.onDismiss){$scope.onDismiss();}
$scope.$destroy();element.remove();};}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core.form.directives',['gettext','ods.core','ui.keypress']);var odsDelayDirective=['$timeout','$rootScope',function($timeout,$rootScope){return{require:['ngModel'],link:function(scope,element,attrs,ctrls){var modelCtrl=ctrls[0];var pendingDebounce=null;var debounceDelay=+attrs['odsDelay']||false;modelCtrl.$commitViewValue=modelCtrl.$setViewValue;modelCtrl.$setViewValue=function(value,force){var ctrl=this;if(pendingDebounce){$timeout.cancel(pendingDebounce);}
if(debounceDelay&&!force){pendingDebounce=$timeout(function(){scope.$apply(function(){ctrl.$commitViewValue(value);});},debounceDelay);}else if(scope.$$phase||$rootScope.$$phase){ctrl.$commitViewValue(value);}else{scope.$apply(function(){ctrl.$commitViewValue(value);});}};element.on('blur',function(ev){modelCtrl.$setViewValue(element.val(),true);});if(element.get(0).type!=="textarea"){element.on('keypress',function(ev){if(ev.which===13){modelCtrl.$setViewValue(element.val(),true);ev.preventDefault();return false;}});}}};}];mod.directive('odsDelay',odsDelayDirective);mod.directive('odsSaveButton',['$document','keypressHelper','$timeout','$q',function($document,keypressHelper,$timeout,$q){return{restrict:'E',replace:true,require:'?^form',scope:{dirty:'=?dirty',type:'=?type',invalid:'=?invalid',action:'&?odsSaveButtonAction',label:'=?'},template:''+'<button class="ods-button ods-button--primary" '+'        type="type" '+'        ng-disabled="!getDirty() || getInvalid() || isLoading">'+'    <span ng-if="!label" translate>Save</span>'+'    <span ng-if="label">{{ label }}</span>'+'</button>',link:function(scope,element,attrs,FormCtrl){var action=scope.action();scope.type=scope.type||'button';scope.isLoading=false;scope.getDirty=function(){if(angular.isDefined(scope.dirty)){return scope.dirty;}
if(angular.isDefined(FormCtrl)){return FormCtrl.$dirty;}
return true;};scope.getInvalid=function(){if(angular.isDefined(scope.invalid)){return scope.invalid;}
if(angular.isDefined(FormCtrl)&&FormCtrl!==null){return FormCtrl.$invalid;}
return false;};scope.completeAction=function(event){if(scope.getDirty()&&!scope.getInvalid()){if(angular.isDefined(action)){if(event&&event.preventDefault){event.preventDefault();}
if(!scope.isLoading){scope.isLoading=true;$q.when(action()).finally(function(){scope.isLoading=false;});}}else if(angular.isDefined(FormCtrl)){}}else{if(event&&event.preventDefault){event.preventDefault();}}};scope.triggerButton=function(e){e.preventDefault();$timeout(function(){element.trigger('click');},0);};element.bind('click',scope.completeAction);keypressHelper('keydown',scope,$document,{'uiKeydown':"{'ctrl-S': 'triggerButton($event);', 'meta-S': 'triggerButton($event);'}"});}};}]);mod.directive('odsColorChooser',['colorScale','$document',function(colorScale,$document){return{restrict:'AE',scope:{color:'=',allowedcolors:'='},replace:true,templateUrl:'/static/ods/html/color-chooser.html',link:function(scope,element,attrs){scope.colorrangetemplates=colorScale.getColorSets();scope.colortemplates=[];scope.internalValues={};scope.preview=true;scope.closeSelector=function($event){scope.preview=true;};scope.openSelector=function($event){scope.preview=false;var documentClickHandler=function($event){if($($event.target).closest(element).length!==1){scope.closeSelector();$document.off('click',documentClickHandler);}
scope.$apply();};$document.on('click',documentClickHandler);$event.stopPropagation();$event.preventDefault();};scope.toggleSelector=function($event){if(scope.preview){scope.openSelector($event);}else{scope.closeSelector($event);}};scope.selectDynamicRange=function(name){scope.internalValues.color=name;scope.closeSelector();};scope.selectSingleColor=function(color){scope.internalValues.color=color;scope.closeSelector();};scope.selectStaticRange=function(color){scope.internalValues.color=color;};scope.$watch('internalValues',function(nv,ov){if(nv.color&&nv.color!==ov.color){if(!(nv.color.startsWith('range-')||nv.color.startsWith('custom-'))){var found=false;angular.forEach(scope.colortemplates,function(color){if(color.label===nv.color){found=true;}});scope.color=nv.color;}else{scope.color=nv.color;}}},true);scope.$watch('color',function(nv,ov){scope.internalValues.colortype='single';if(nv){if(nv.startsWith('range-')){scope.internalValues.colortype='range';scope.internalValues.color=nv;}else{scope.internalValues.colortype='single';scope.internalValues.color=nv;}}},true);scope.$watch('allowedcolors',function(nv,ov){if(nv&&nv.length>0){scope.colortemplates=colorScale.getColorList(nv,scope.color);if(!colorScale.isColorAllowed(scope.color,scope.colortemplates,scope.allowedcolors)){scope.color=scope.colortemplates[0].label;}}},true);}};}]);mod.directive('odsMultipleEmails',function(){return{require:'ngModel',link:function(scope,element,attrs,ctrl){ctrl.$parsers.unshift(function(viewValue){var re=/\S+@\S+\.\S+/;var emails=viewValue.split(/[\s,;]+/);var validity=!viewValue||emails.map(function(email){return re.test(email);}).reduce(function(previousValue,currentValue){return previousValue&&currentValue;},true);ctrl.$setValidity('odsMultipleEmails',validity);return validity?viewValue:undefined;});}};});mod.directive('odsNoDirtyCheck',function(){return{restrict:'A',require:'ngModel',link:function(scope,elem,attrs,ctrl){var alwaysFalse={get:function(){return false;},set:function(){}};Object.defineProperty(ctrl,'$pristine',alwaysFalse);Object.defineProperty(ctrl,'$dirty',alwaysFalse);}};});}());;(function(){'use strict';var ALLOWED_MEDIA_EXTENSIONS_FROM_PUBLIC_FTP=['pdf','png','gif','jpg','jpeg','mp4','avi',];var ALLOWED_PROTOCOLS=['http:','https:']
var mod=angular.module('ods.core');mod.directive('odsIframeSrc',function(){return{restrict:'A',link:function(scope,element,attrs){scope.$watch(function(){return attrs.odsIframeSrc;},function(nv){var iframeElement=element[0];if(iframeElement.nodeName.toLowerCase()!=='iframe'){return;}
if(typeof(window.URL)!=='function'){console.error("Dynamic iframes are not supported on Internet Explorer");return;}
var iframeUrl=new URL(nv);if(ALLOWED_PROTOCOLS.indexOf(iframeUrl.protocol)===-1){console.error("Dynamic iframes are only supported for authorized protocols (http: and https:).");return;}
if(!iframeUrl.hostname.endsWith('.opendatasoft.com')){console.error("Dynamic iframes are only supported for authorized hosts.");return;}
if(iframeUrl.pathname.indexOf('.')===-1){console.error("Dynamic iframes are only supported for authorized file extensions.");return;}
var extension=iframeUrl.pathname.split('.').pop();if(ALLOWED_MEDIA_EXTENSIONS_FROM_PUBLIC_FTP.indexOf(extension)===-1){console.error("Dynamic iframes are only supported for authorized file extensions.");return;}
iframeElement.src=nv;});}};});}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsInternalUnsafePicto',['SVGInliner',function(SVGInliner){return{restrict:'E',replace:true,scope:{url:'=',color:'=',classes:'=',},template:'<div class="odswidget odswidget-picto {{ classes }}"></div>',link:function(scope,element){var svgContainer;scope.$watch('[url, color]',function(nv){var url=nv[0];if(url){if(svgContainer){element.empty();}
svgContainer=SVGInliner.getElement(scope.url,scope.color,scope.colorByAttribute);if(!svgContainer){return;}
if(!scope.color){svgContainer.addClass('ods-svginliner__svg-container--colorless');}
element.append(svgContainer);}},true);}};}]);}());;(function(){var app=angular.module('ods.core');app.directive('odsJsonFormatter',function(){return{restrict:'A',replace:true,scope:{"data":'=odsJsonFormatter',"liveUpdate":'=?odsJsonFormatterLiveUpdate'},link:function(scope,element,attrs){var htmlElementClass=typeof HTMLElement!=="undefined"?HTMLElement:Element;scope.$watch('data',function(nv,ov){element.html('');if(nv!==null&&nv!==undefined){json2HTML(nv,element[0]);}},!!scope.liveUpdate);function json2HTML(json,element){var group=document.createElement('div');group.className='group';var list=document.createElement('ul');var temp;if(!(json instanceof htmlElementClass)&&$.isArray(json)){list.className='array';temp=document.createElement('div');temp.className='bracket start';temp.innerHTML='[';group.appendChild(temp);group.appendChild(list);temp=document.createElement('div');temp.className='bracket end';temp.innerHTML=']';group.appendChild(temp);}else if(!(json instanceof htmlElementClass)&&typeof(json)=='object'&&json!==null){list.className='object';temp=document.createElement('div');temp.className='bracket start';temp.innerHTML='{';group.appendChild(temp);group.appendChild(list);temp=document.createElement('div');temp.className='bracket end';temp.innerHTML='}';group.appendChild(temp);}else{console.error('JSON must either be Object or Array :',json);}
element.appendChild(group);if(json){var last_comma;$.each(json,function(key,value){var item=document.createElement('li');list.appendChild(item);if(!(json instanceof htmlElementClass)&&typeof(json)=='object'&&!$.isArray(json)){item.innerHTML='<span class="key">"'+ODS.StringUtils.escapeHTML(key)+'":</span>';}
var valueWrapper;if(value instanceof htmlElementClass){valueWrapper=document.createElement('span');var attributes='';angular.forEach(value.attributes,function(elt){attributes+=' '+elt.nodeName+'="'+elt.nodeValue+'"';});valueWrapper.appendChild(document.createTextNode('<'+value.tagName.toLowerCase()+attributes+'>...</'+value.tagName.toLowerCase()+'>'));valueWrapper.className=valueWrapper.className+' '+'html';item.appendChild(valueWrapper);}else if($.isArray(value)){if(value.length>100){item.innerHTML=item.innerHTML+'<div class="group"><div class="bracket start">[</div>(too many elements to preview)<div class="bracket end">]</div></div>';}else if(value.length){json2HTML(value,item);}else{item.innerHTML=item.innerHTML+'<div class="group"><div class="bracket start">[</div><div class="bracket end">]</div></div>';}}else if(value!==null&&typeof(value)=='object'){json2HTML(value,item);}else{valueWrapper=document.createElement('span');valueWrapper.className='value';if(typeof(value)=='string'){valueWrapper.innerHTML='"'+ODS.StringUtils.escapeHTML(value)+'"';}else if(typeof(value)=='boolean'){valueWrapper.innerHTML=value?'true':'false';}else if(value===null){valueWrapper.innerHTML='null';valueWrapper.className=valueWrapper.className+' '+'null';}else if(value===undefined){valueWrapper.innerHTML='undefined';valueWrapper.className=valueWrapper.className+' '+'undefined';}else{valueWrapper.innerHTML=value;}
valueWrapper.className=valueWrapper.className+' '+typeof(value);item.appendChild(valueWrapper);}
last_comma=document.createElement('span');last_comma.innerHTML=',';last_comma.className='comma';item.appendChild(last_comma);});if(last_comma){last_comma.parentElement.removeChild(last_comma);}}else{var li=document.createElement('li');var span=document.createElement('span');span.className='value';span.innerHTML='null';li.appendChild(span);list.appendChild(li);}}
element.on('click','.group',function(e){e.stopPropagation();$(this).removeClass('folded');});element.on('click','.bracket',function(e){e.stopPropagation();$(this).closest('.group').toggleClass('folded');});element.on('click','.key',function(e){e.stopPropagation();$(this).next('.group').toggleClass('folded');});element.on('mouseenter','.key',function(e){element.find('.hovered').removeClass('hovered');$(this).next('.group').addClass('hovered');});element.on('mouseleave',function(e){element.find('.hovered').removeClass('hovered');});}};});}());;(function(){'use strict';var mod=angular.module('ods.core');var crossBrowserTranslation={" ":"Spacebar","ArrowUp":"Up","ArrowDown":"Down","ArrowLeft":"Left","ArrowRight":"Right","Escape":"Esc","Delete":"Del"};mod.directive('odsKeyboard',function(){return{restrict:'AE',link:function(scope,elem,attrs){var key=attrs.odsKeyboardKey;var expr=attrs.odsKeyboardExpression||attrs.ngClick;var preventDefault=attrs.odsKeyboardPreventDefault||false;if(angular.isUndefined(key))return;if(angular.isUndefined(expr))return;if(key==="Space")
key=" ";var cb=function(e){if(e.key===key||(key in crossBrowserTranslation&&e.key===crossBrowserTranslation[key])){if(!(e.target.tagName==='INPUT'||e.target.tagName==='SELECT'||e.target.tagName==='TEXTAREA'||(e.target.contentEditable&&e.target.contentEditable==='true'))){scope.$evalAsync(expr);if(preventDefault){e.preventDefault();}}}else{return;}}
$(document).on("keydown",cb);scope.$on('$destroy',function(){$(document).off("keydown",cb);});}};});}());;(function(){'use strict';angular.module('ui.keypress',[]).factory('keypressHelper',['$parse',function keypress($parse){var keysByCode={8:'backspace',9:'tab',13:'enter',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'insert',46:'delete'};var capitaliseFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1);};return function(mode,scope,elm,attrs){var params,combinations=[];params=scope.$eval(attrs['ui'+capitaliseFirstLetter(mode)]);angular.forEach(params,function(v,k){var combination,expression;expression=$parse(v);angular.forEach(k.split(' '),function(variation){combination={expression:expression,keys:{}};angular.forEach(variation.split('-'),function(value){combination.keys[value]=true;});combinations.push(combination);});});elm.bind(mode,function(event){var metaPressed=!!(event.metaKey&&!event.ctrlKey);var altPressed=!!event.altKey;var ctrlPressed=!!event.ctrlKey;var shiftPressed=!!event.shiftKey;var keyCode=event.keyCode;if(!shiftPressed&&keyCode>=97&&keyCode<=122){keyCode=keyCode-32;}
angular.forEach(combinations,function(combination){var mainKeyPressed=combination.keys[keysByCode[keyCode]]||combination.keys[String.fromCharCode(keyCode)];var metaRequired=!!combination.keys.meta;var altRequired=!!combination.keys.alt;var ctrlRequired=!!combination.keys.ctrl;var shiftRequired=!!combination.keys.shift;if(mainKeyPressed&&(metaRequired===metaPressed)&&(altRequired===altPressed)&&(ctrlRequired===ctrlPressed)&&(shiftRequired===shiftPressed)){scope.$apply(function(){combination.expression(scope,{'$event':event});});}});});};}]);angular.module('ui.keypress').directive('uiKeydown',['keypressHelper',function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper('keydown',scope,elm,attrs);}};}]);angular.module('ui.keypress').directive('uiKeypress',['keypressHelper',function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper('keypress',scope,elm,attrs);}};}]);angular.module('ui.keypress').directive('uiKeyup',['keypressHelper',function(keypressHelper){return{link:function(scope,elm,attrs){keypressHelper('keyup',scope,elm,attrs);}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsLanguageSwitcher',['config',function(config){return{restrict:'A',link:function(scope,element){var language=element.attr('ods-language-switcher');var changeLanguage=function(){var $form=$('<form/>',{id:'tmpLangForm',method:'POST',action:'/i18n/setlang/'});$form.append($('<input/>',{type:'hidden',name:'language',value:language}));$('body').append($form);$form.submit();};element.on('click',function(event){event.preventDefault();changeLanguage();});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');var adjustBodyScrollbars=function(isModalDisplayed){if(isModalDisplayed){var properties={'position':'fixed','width':'100%'};if(document.body.scrollHeight>document.body.clientHeight){properties['top']=-$(window).scrollTop();properties['overflow-y']='scroll';}
$('body').css(properties);}else{var scrollTop=-parseInt(document.body.style.top||0);$('body').css({'position':'','overflow-y':'','width':'','top':''});$('html,body').scrollTop(scrollTop);}};mod.directive('odsModal',['$rootScope','$timeout','$document',function($rootScope,$timeout,$document){return{restrict:'E',transclude:true,scope:{'name':'@','bodyClass':'@','title':'@','titleIcon':'@'},template:''+'<div class="ods-modal" ng-if="displayed" title="" >'+'    <div class="ods-modal__backdrop ods-modal__backdrop--animate-in"></div>'+'    <div class="ods-modal__window ods-modal__window--animate-in {{bodyClass}}" '+'         role="dialog" '+'         aria-labelledby="ods-modal-title">'+'       <div class="ods-modal__header">'+'           <h1 class="ods-modal__title" '+'               id="ods-modal-title" '+'               ng-if="title">'+'               <i ng-if="titleIcon" ng-class="[titleIcon]" aria-hidden="true"></i>'+'               {{title}}'+'           </h1>'+'           <button type="button" ng-click="cancelModal()" class="ods-modal__close-button" aria-label="Close dialog"><i class="odsui-delete"></i></button>'+'           <div class="ods-modal__wizard-steps" ng-if="steps.length">'+'               <div class="ods-modal__wizard-step"'+'                    ng-repeat="step in steps"'+'                    ng-class="{\'ods-modal__wizard-step--active\': $index + 1 === activeStep}">'+'                   <div class="ods-modal__wizard-step-number">{{ $index + 1 }}</div>'+'                   <div class="ods-modal__wizard-step-label">{{ step }}</div>'+'               </div>'+'           </div>'+'       </div>'+'       <div class="ods-modal__inner ods-modal__loading" ng-show="loading">'+'           <div ng-repeat="message in loadingMessageLines">{{ message }}</div>'+'           <ods-progress-bar mode="infinite"></ods-progress-bar>'+'       </div>'+'       <div class="ods-modal__inner ods-modal__content" ng-hide="loading" ng-transclude></div>'+'   </div>'+'</div>',link:function(scope,element){scope.loading=false;var capitalizedName=scope.name[0].toUpperCase()+scope.name.substr(1);var eventTarget;var loadingStartedAt;var loadingMinDisplayTime=1000;var getRemainingLoadingTime=function(){return Math.max(0,loadingMinDisplayTime-(Date.now()-loadingStartedAt));};var hidingDisabled=false;var disableHiding=function(){hidingDisabled=true;element.find('.ods-modal__close-button').hide();};var enableHiding=function(){hidingDisabled=false;element.find('.ods-modal__close-button').show();};var handleKeyDown=function(event){if(hidingDisabled){return;}
scope.$apply(function(){if(event.keyCode===27){if(event.isDefaultPrevented())return;event.preventDefault();cancelModal();}});};var showModal=function(event){if(!angular.isUndefined(event)){eventTarget=event.target;}
scope.displayed=true;$('body').addClass('modal-open');$document.on('keydown',handleKeyDown);scope.$emit('showModal',scope.name);};var cancelModal=function(callback){$timeout(function(){element.find('.ods-modal__window').removeClass('ods-modal__window--animate-in').addClass('ods-modal__window--animate-out');element.find('.ods-modal__backdrop').removeClass('ods-modal__backdrop--animate-in').addClass('ods-modal__backdrop--animate-out');$timeout(function(){scope.displayed=false;$('body').removeClass('modal-open');$document.off('keydown',handleKeyDown);scope.$emit('hideModal',scope.name);if(!angular.isUndefined(eventTarget)){eventTarget.focus();}
if(scope.loading){stopLoadingState();}
if(callback){callback();}},200)},scope.loading?getRemainingLoadingTime():0);};var startLoadingState=function(message,blocking){var contentElement=element.find('.ods-modal__content'),loadingElement=element.find('.ods-modal__loading');loadingElement.css('height',contentElement.height());scope.loadingMessageLines=message||translate('Loading');if(!angular.isArray(scope.loadingMessageLines)){scope.loadingMessageLines=[scope.loadingMessageLines];}
loadingStartedAt=Date.now();scope.loading=true;if(blocking){disableHiding();}};var stopLoadingState=function(callback){$timeout(function(){element.find('.ods-modal__loading').css('height','');scope.loading=false;enableHiding();if(callback){callback();}},getRemainingLoadingTime())};scope.cancelModal=cancelModal;scope.$parent['show'+capitalizedName]=showModal;scope.$parent['hide'+capitalizedName]=cancelModal;scope.$parent['start'+capitalizedName+'LoadingState']=startLoadingState;scope.$parent['stop'+capitalizedName+'LoadingState']=stopLoadingState;$rootScope.$on('show'+capitalizedName,function(event,clickEvent){showModal(clickEvent);});$rootScope.$on('hide'+capitalizedName,function(){cancelModal();});scope.$watch('displayed',function(nv){scope.$parent[scope.name+'Displayed']=scope.displayed;adjustBodyScrollbars(nv);});},controller:function($scope){$scope.steps=[];$scope.activeStep=1;this.registerStep=function(stepLabel){$scope.steps.push(stepLabel);return $scope.steps.length;};$scope.$watch('displayed',function(){$scope.steps=[];$scope.activeStep=1;});var nextStep=function(){$scope.activeStep=Math.min($scope.steps.length,$scope.activeStep+1);};$scope.nextStep=nextStep;this.nextStep=nextStep;this.previousStep=function(){$scope.activeStep=Math.max(0,$scope.activeStep-1);};this.isStepActive=function(stepNumber){return $scope.activeStep===stepNumber;};}};}]);mod.directive('odsModalStep',function(){return{restrict:'E',replace:true,transclude:true,scope:true,require:'^odsModal',template:'<div class="ods-modal__inner" ng-show="isActive()" ng-transclude></div>',link:function(scope,element,attrs,odsModalCtrl){var stepNumber=odsModalCtrl.registerStep(attrs.label);scope.$parent.nextModalStep=odsModalCtrl.nextStep;scope.$parent.previousModalStep=odsModalCtrl.previousStep;scope.isActive=function(){return odsModalCtrl.isStepActive(stepNumber);};}};});mod.directive('odsModalBody',['$timeout',function($timeout){return{restrict:'E',replace:true,transclude:true,scope:true,require:'^?odsModal',template:''+'<div class="ods-modal__body ods-modal__inner">'+'   <div class="ods-modal__body-top-shadow" ng-class="{\'hidden\': atTop}"></div>'+'   <div class="ods-modal__scrollable-content">'+'       <div class="u-ods-padding-normal" ods-transclude></div>'+'   </div>'+'   <div class="ods-modal__body-bottom-shadow" ng-class="{\'hidden\': atBottom}"></div>'+'</div>',link:function(scope,element,attrs,ctrl,transclude){scope.atTop=false;scope.atBottom=false;transclude(scope.$parent,function(clone){element.find('[ods-transclude]').append(clone);});var contentElement=element.find('.ods-modal__scrollable-content')[0];var setInnerShadows=function(){scope.atTop=contentElement.scrollTop===0;scope.atBottom=contentElement.scrollHeight===contentElement.offsetHeight||contentElement.scrollHeight<(contentElement.offsetHeight+contentElement.scrollTop+1);if(scope.$applyAsync){scope.$applyAsync();}else{$timeout(function(){});}};contentElement.addEventListener('scroll',setInnerShadows);scope.$watch(function(){return contentElement.scrollHeight;},setInnerShadows);setInnerShadows();}}}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('multipleField',function(){return{restrict:'E',require:['ngModel','^?form'],template:''+'<div class="multiple-field">'+'   <div ng-repeat="item in items track by $index">'+'       <div class="ods-form__addon-wrapper">'+'           <input type="text"'+'                   class="ods-form__control"'+'                   ng-disabled="odsDisabled"'+'                   ng-model-onchange ng-model="items[$index]"'+'                   ng-change="cleanupEmptyItems(items)"'+'                   ng-readonly="readonly"'+'                   datalist-values="values"'+'                   datalist-values-language="valuesLanguage" />'+'           <button class="ods-button ods-form__addon"'+'                   ng-if="!odsDisabled" '+'                   type="button" '+'                   aria-label="Remove" '+'                   translate="aria-label" '+'                   ng-click="removeItem($index)">'+'               <i class="icon-remove fa fa-remove" aria-hidden="true"></i>'+'           </button>'+'       </div>'+'   </div>'+'   <div class="input-append">'+'       <form>'+'           <div class="ods-form__addon-wrapper">'+'               <input type="text"'+'                   class="ods-form__control add"'+'                   ng-model="newItem"'+'                   ng-disabled="odsDisabled"'+'                   datalist-values="values"'+'                   datalist-values-language="valuesLanguage" />'+'               <button class="ods-button ods-form__addon" disabled>'+'                   <i class="icon-plus fa fa-plus" aria-hidden="true"></i>'+'               </button>'+'           </div>'+'       </form>'+'   </div>'+'</div>',replace:true,scope:{modelitems:'=ngModel','readonly':'=ngReadonly','values':'=','valuesLanguage':'=',required:'@',odsDisabled:'='},link:function(scope,element,attrs,ctrls){var ngModel=ctrls[0],formController=ctrls[1];var checkValidity=function(){if(scope.required===true){ngModel.$setValidity('required',scope.items&&scope.items.length>0);}};scope.$watch('modelitems',function(nv){if(nv){if(angular.isString(nv)){scope.items=[nv];}else{scope.items=nv;}}
checkValidity();},true);scope.$watch('items',function(nv){if(nv&&angular.isArray(nv)){scope.modelitems=nv;}
checkValidity();},true);scope.cleanupEmptyItems=function(items){for(var i=0;i<items.length;i++){if(!items[i]){items.splice(i,1);return;}}};scope.newItem='';scope.removeItem=function(index){scope.items.splice(index,1);if(formController){formController.$setDirty();}
checkValidity();};var addFunction=function(){if(scope.newItem){element.find('div.input-append > button').prop('disabled',true);if(!scope.items){scope.items=[];}
if(scope.items.indexOf(scope.newItem)<0){scope.items.push(scope.newItem);}
scope.newItem='';scope.$apply();}};element.find('input.add').on('blur',addFunction);element.find('form').on('submit',addFunction);element.find('input.add:last').on('keyup',function(){element.find('div.input-append  button').prop('disabled',$(this).val()==='');});}};});})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('namedQueriesField',function(){return{restrict:'E',require:['ngModel','^?form'],template:''+'<div class="query-field">'+'   <div ng-repeat="(key, value) in namedQueries">'+'       <div class="ods-form__addon-wrapper">'+'           <label>{{ key }}</label>'+'           <input type="text"'+'                   class="ods-form__control"'+'                   ng-disabled="odsDisabled"'+'                   ng-model-onchange'+'                   ng-model="namedQueries[key]"'+'                   ng-change="cleanupEmptyNamedQueries()"'+'                   ng-readonly="readonly" />'+'           <button class="ods-button ods-form__addon"'+'                   ng-if="!odsDisabled" '+'                   type="button" '+'                   aria-label="Remove" '+'                   translate="aria-label" '+'                   ng-click="removeItem(key)">'+'               <i class="icon-remove fa fa-remove" aria-hidden="true"></i>'+'           </button>'+'       </div>'+'   </div>'+'</div>',replace:true,scope:{namedQueries:'=ngModel',readonly:'=ngReadonly',odsDisabled:'=',},link:function($scope,_,$ctrls){var formController=$ctrls[1];$scope.cleanupEmptyNamedQueries=function(){angular.forEach($scope.namedQueries,function(value,key){if(!value){delete $scope.namedQueries[key];return;}})};$scope.removeItem=function(key){delete $scope.namedQueries[key];if(formController){formController.$setDirty();}};}};});})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsNoDirty',function(){return{require:'ngModel',link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$setDirty=angular.noop;}};});}());;(function(){'use strict';var app=angular.module('ods.core');app.directive('odsNotificationHandler',['odsNotificationService','translate','$timeout','gettextCatalog',function(odsNotificationService,translate,$timeout,gettextCatalog){return{restrict:'E',replace:true,template:''+'<div class="ods-notification-handler" ng-show="notificationList.length">'+'    <div ng-repeat="notification in notificationList" '+'         class="ods-notification-handler__notification ods-notification-handler__notification--{{ notification.type }}">'+'        <div class="ods-notification-handler__notification-header">'+'            <div class="ods-notification-handler__notification-title"> '+'                <i class="fa" '+'                   ng-class="{\'fa-exclamation-circle\': notification.type != \'success\', \'fa-check\': notification.type == \'success\' }"></i> '+'                {{ notification.title }}'+'            </div>'+'            <i class="fa fa-close ods-notification-handler__notification-close" '+'               ng-click="removeNotification(notification)"></i>'+'        </div>'+'        <div class="ods-notification-handler__notification-message" '+'             >{{ notification.message }}</div>'+'        <pre class="ods-notification-handler__notification-stacktrace" '+'             ng-if="notification.stacktrace" '+'             ng-bind="notification.stacktrace"></pre>'+'    </div>'+'</div>',scope:true,link:function(scope){var lastNotification=null;scope.notificationList=[];var checkNotificationList=function(){scope.notificationList=scope.notificationList.filter(function(notification){return!notification.handled;});};scope.$watchCollection('notificationList',checkNotificationList);scope.removeNotification=function(notification){scope.notificationList.splice(scope.notificationList.indexOf(notification),1);if(angular.equals(notification,lastNotification)){lastNotification=null;}};var formatNotification=function(notification){notification.errorcode=notification.errorcode||0;if(notification.errorcode===10001){notification.type='quota';notification.title=translate('Quota exceeded');notification.message=gettextCatalog.getString(notification.error,notification,"API error message");notification.message=format_string(notification.message,notification);}else if([10002,10003,10004,10005,10006].indexOf(notification.errorcode)>-1){notification.type='quota';notification.title=translate('Too many requests');notification.message=translate('Unfortunately, you have exceeded a security quota limit. Please retry later, or contact domain administrator.');notification.message=gettextCatalog.getString(notification.error,notification,"API error message");notification.message=format_string(notification.message,notification);}else if(notification.errorcode===10010){notification.type='quota';notification.title=translate('Domain currently under maintenance');notification.message=notification.error;}else if(notification.errorcode===10011){notification.type='quota';notification.title=translate('License expired');notification.message=notification.error;}else if(notification.error_key){notification.title=translate('Error');notification.message=gettextCatalog.getString(notification.message,null,"API error message");}else{if(!notification.title){notification.title=notification.type=='success'?translate('Success'):translate('Error');}else{notification.title=translate(notification.title);}
if(notification.error){notification.message=translate(notification.error);}else if(!notification.message||notification.message.trim()[0]==='<'){notification.message=translate('Error while contacting the service.');}else{notification.message=translate(notification.message);}}
return notification;};var notificationHandler=function(notification){formatNotification(notification);if(!lastNotification||!angular.equals(notification,lastNotification)){scope.notificationList.push(notification);if(notification.type==='success'){$timeout(function(){notification.handled=true;checkNotificationList();},5000);}}
lastNotification=notification;};odsNotificationService.registerForNotifications(notificationHandler);var onKeyDown=function(event){if(event.defaultPrevented||(event.key!=='Escape'&&event.key!=='Esc'))return;event.preventDefault();scope.notificationList=[];scope.$apply();};window.addEventListener('keydown',onKeyDown);scope.$on('$destroy',function(){window.removeEventListener('keydown',onKeyDown);});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsPagesList',['ODSWidgetsConfig',function(ODSWidgetsConfig){return{restrict:'E',replace:true,scope:true,template:''+'<ul class="ods-pages-list">'+'    <ods-page-enumerator>'+'        <li class="ods-pages-list__page">'+'            <a ng-href="{{ page.url }}">{{ page.title[language] || page.slug }}</a>'+'            <div ng-bind="page.description || \'No description available.\'|translate"></div>'+'        </li>'+'    </ods-page-enumerator>'+'</ul>',controller:function($scope){$scope.language=ODSWidgetsConfig.language;}};}]);mod.directive('odsPageEnumerator',['PageAPI',function(PageAPI){return{restrict:'E',scope:true,transclude:true,template:''+'<div class="ods-page-enumerator">'+'    <div inject class="ods-page-enumerator__page" ng-repeat="page in pages"></div>'+'</div>',link:function(scope){scope.pages=[];PageAPI.list().then(function(response){var pagesResponse=response.data;var pages=[];angular.forEach(pagesResponse.pages,function(pageResponse){pages.push(pageResponse.page);});scope.pages=pages;});}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsPagination',[function(){return{restrict:'E',replace:true,scope:{currentPage:'=',lastPage:'=',loadPageCallback:'&'},template:''+'<nav role="pagination" aria-label="Pagination navigation" translate="aria-label">'+'   <ul class="ods-pagination">'+'        <li class="ods-pagination__item">'+'            <button class="ods-button ods-pagination__page ods-pagination__page--{{ digits }}"'+'                    ng-disabled="currentPage == 1"'+'                    ng-click="loadPreviousPage()">'+'               <i class="fa fa-angle-left"></i>'+'           </button>'+'       </li>'+'       <li class="ods-pagination__item"'+'          ng-show="displayLeftEllipsis">'+'            <button class="ods-button ods-pagination__page ods-pagination__page--{{ digits }}"'+'                    type="button"'+'                    ng-class="{\'ods-button--primary\': page == 1}"'+'                    ng-click="loadPage(1)">'+'               1'+'            </button>'+'       </li>'+'       <li class="ods-pagination__ellipsis ods-pagination__ellipsis--{{ digits }}"'+'            ng-show="displayLeftEllipsis">'+'           <i class="fa fa-ellipsis-h"></i>'+'       </li>'+'       <li class="ods-pagination__item">'+'            <button class="ods-button ods-pagination__page ods-pagination__page--{{ digits }}"'+'                    type="button"'+'                    ng-class="{\'ods-button--primary\': page == currentPage}"'+'                   ng-repeat="page in displayedPageNumbers"'+'                   ng-click="loadPage(page)">'+'               {{ page }}'+'           </button>'+'       </li>'+'       <li class="ods-pagination__ellipsis ods-pagination__ellipsis--{{ digits }}" '+'            ng-show="displayRightEllipsis">'+'           <i class="fa fa-ellipsis-h"></i>'+'       </li>'+'       <li class="ods-pagination__item"'+'            ng-show="displayRightEllipsis">'+'           <button class="ods-button ods-pagination__page ods-pagination__page--{{ digits }}"'+'                    type="button"'+'                    ng-class="{\'ods-button--primary\': page == lastPage}"'+'                   ng-click="loadPage(lastPage)">'+'               {{ lastPage }}'+'           </button>'+'       </li>'+'       <li class="ods-pagination__item">'+'            <button class="ods-button ods-pagination__page ods-pagination__page--{{ digits }}"'+'                    ng-disabled="currentPage == lastPage"'+'                    ng-click="loadNextPage()">'+'               <i class="fa fa-angle-right"></i>'+'           </button>'+'       </li>'+'   </ul>'+'</nav>',link:function(scope){scope.displayedPageNumbers=[];scope.digits=1;scope.displayLeftEllipsis=false;scope.displayRightEllispsis=false;var setPaginationItems=function(){var start=1;var end=scope.lastPage;scope.displayLeftEllipsis=(scope.lastPage>7)&&(scope.currentPage>3);scope.displayRightEllipsis=(scope.lastPage>7)&&((scope.lastPage-scope.currentPage)>3);if(scope.displayLeftEllipsis&&scope.displayRightEllipsis){start=scope.currentPage-1;end=scope.currentPage+1;}else if(scope.displayLeftEllipsis){start=scope.lastPage-4;end=scope.lastPage;}else if(scope.displayRightEllipsis){start=1;end=5;}
scope.displayedPageNumbers=[];for(var i=start;i<=end;i++){scope.displayedPageNumbers.push(i);}};var setPaginationItemsWidth=function(){scope.digits=(scope.lastPage+'').length;};scope.loadPreviousPage=function(){scope.loadPageCallback({page:Math.max(1,scope.currentPage-1)});};scope.loadPage=function(page){scope.loadPageCallback({page:page});};scope.loadNextPage=function(){scope.loadPageCallback({page:Math.min(scope.lastPage,scope.currentPage+1)});};scope.$watchGroup(['currentPage','lastPage'],function(nv,ov){if(!angular.equals(nv,ov)||(nv&&scope.displayedPageNumbers.length===0)){setPaginationItems();setPaginationItemsWidth();}});scope.$watch('lastPage',function(nv,ov){if(nv!=ov){setPaginationItemsWidth();}});setPaginationItems();setPaginationItemsWidth();}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsPictopicker',['config','$window','$compile','translate','$document','PickerHelper',function(config,$window,$compile,translate,$document,pickerHelper){var pictos=null;return{restrict:'E',require:'ngModel',controller:function($scope,$http){var q="";var lang=config.LANGUAGE;$scope.iconsCount=0;$scope.filterPictos=function(q){q=ODS.StringUtils.slugify(ODS.StringUtils.normalize(q));$scope.filteredIconsCount=0;if(q!==""){$scope.filteredCategories=[];$scope.filteredIconsCount=0;angular.forEach(pictos.categories,function(category){var pushedCategory=false;for(var i=0;i<category.keywords_cat.length;i++){if(ODS.StringUtils.slugify(ODS.StringUtils.normalize(category.keywords_cat[i])).indexOf(q)>-1){$scope.filteredCategories.push({title:category.title,icons:category.icons});pushedCategory=true;$scope.filteredIconsCount+=category.icons.length;break;}}
if(!pushedCategory){$scope.filteredCategories.push({title:category.title,icons:[]});angular.forEach(category.icons,function(icon){for(var i=0;i<icon.keywords.length;i++){if(ODS.StringUtils.slugify(ODS.StringUtils.normalize(icon.keywords[i])).indexOf(q)>-1){$scope.filteredCategories[$scope.filteredCategories.length-1].icons.push(icon);$scope.filteredIconsCount+=1;break;}}});}});document.getElementById('ods-pictopicker__popup__icons-list').scrollTop=0;}else{$scope.filteredCategories=pictos.categories;$scope.filteredIconsCount=$scope.iconsCount;if(document.getElementById('ods-pictopicker__popup__icons-list')!==null){document.getElementById('ods-pictopicker__popup__icons-list').scrollTop=0;}}};$scope.countIcons=function(categories){var count=0;angular.forEach(categories,function(category){count+=category.icons.length;});return count;};var promise=$http.get('/static/pictos/img/set-v3/'+lang+'.json');promise.then(function(response){if(response.status===200){pictos=response.data;$scope.iconsCount=$scope.countIcons(pictos.categories);$scope.filterPictos(q);$scope.initRender();}else{console.log('Error while trying to get icons metadatas from the server');}});},replace:true,scope:{color:'=',defaultValue:'@',odsDisabled:'=',placeholder:'@',required:'=?',currentPictoUrl:'='},link:function(scope,element,attrs,ngModel){var pickerButton;var template='<div class="ods-pictopicker__button-container">'+'   <button type="button" class="ods-button ods-pictopicker__button" ng-click="togglePicker($event)" aria-label="{{ariaLabel}}">'+'       <div ng-show="currentPicto" class="ods-pictopicker__button-picto"><ods-map-picto class="" classes="\'chosen-picto \'" name="{{currentPicto}}" ></ods-map-picto></div>'+'       <span ng-show="currentPicto" class="ods-pictopicker__button-label">{{currentPictoName}}</span>'+'       <span ng-hide="currentPicto" class="no-chosen-picto ods-pictopicker__button-label" ng-bind="iconPlaceholder"></span>'+'       <i class="odsui-bottom ods-pictopicker__button-arrow"></i>'+'   </button>'+'</div>';element.replaceWith($compile(template)(scope));scope.q='';scope.initRender=function(){ngModel.$render();};scope.scrollTo=function(target){var elementToScroll=document.getElementById(target);if(elementToScroll!==null){elementToScroll.scrollIntoView();}};scope.iconPlaceholder=scope.placeholder||translate('No icon');var templatePopupHTML=''+'<div class="ods-picker ods-pictopicker">'+'   <div class="ods-picker__arrow"></div>'+'   <div class="ods-picker__header">'+'       <div class="ods-pictopicker__search">'+'           <i class="fa fa-search ods-pictopicker__search-icon" aria-hidden="true"></i>'+'           <input class="ods-pictopicker__search-input" type="search" ng-model="q" ng-change="filterPictos(q)" ng-model-options="{ debounce: 200 }" placeholder="Search an icon" translate="placeholder" autofocus/>'+'           <button type="button" ng-if="q" class="ods-pictopicker__search-clear" aria-label="Clear search box." translate="aria-label" ng-click="clearInput()">'+'           <i class="fa fa-times-circle" aria-hidden="true"></i>'+'           </button>'+'       </div>'+'       <div class="ods-pictopicker__search-count">{{filteredIconsCount}} / {{iconsCount}}</div>'+'   </div>'+'   <div class="ods-picker__content ods-pictopicker__icon-list" id="ods-pictopicker__popup__icons-list">'+'       <div id="ods-pictopicker__icon-list-top"></div>'+'       <div ng-hide="required" class="ods-pictopicker__icon-list--empty" id="ods-pictopicker__popup-no_icon">'+'           <p class="ods-pictopicker__icon-list__title--empty" translate>No icon</p>'+'           <div class="ods-pictopicker__icon-list__item" ng-click="select(\'\')" ng-class="{\'no-picto\': true, \'active\': \'\' === currentPicto}"'+'               ng-mouseenter="previewNoPicto()"'+'               ng-mouseleave="hidePreview()" tabindex="0" ng-keypress="checkIconKey($event, \'\')" aria-label="No icon" role="button" translate="aria-label">'+'               <img src="/static/pictos/img/set-v3/pictos/no_picto.svg" class="ods-pictopicker__icon-list__img"/>'+'           </div>'+'       </div>'+'       <div class="ods-pictopicker__icon-list__group" ng-if="filteredCategories" ng-repeat="category in filteredCategories track by category.title" '+'           id="ods-pictopicker__icon-list__group">'+'           <p class="ods-pictopicker__icon-list__title" ng-bind="category.title"></p>'+'           <div class="ods-pictopicker__icon-list__item" title="{{picto.label}}" ng-repeat="picto in category.icons track by picto.filename" '+'               ng-click="select(picto)" ng-class="{\'active\': picto.name === currentPicto}"'+'               ng-mouseenter="previewPicto(picto)"'+'               ng-mouseleave="hidePreview()" tabindex="0" role="button" aria-label="{{picto.name}}" translate="aria-label" ng-keypress="checkIconKey($event, picto)">'+'               <img ng-src="/static/pictos/img/set-v3/pictos/{{picto.filename}}.svg" class="ods-pictopicker__icon-list__img"/>'+'           </div>'+'       </div>'+'   </div>'+'   <div class="ods-picker__preview ods-pictopicker__preview">'+'       <div ng-if="isOldIcon && !selectedPicto && !showPreview && !showNoIconPreview">'+'           <div>Select an icon</div>'+'       </div>'+'       <div ng-if="selectedPicto && !showPreview && !showNoIconPreview && !isOldIcon">'+'           <div class="ods-pictopicker__preview-icon" ng-click="scrollTo(picto.filename)">'+'               <img ng-src="/static/pictos/img/set-v3/pictos/{{selectedPicto}}.svg" />'+'           </div>'+'           <span>'+'               <div ng-bind="selectedPictoName"></div>'+'           </span>'+'       </div>'+'       <div ng-if="!selectedPicto && !showPreview && !showNoIconPreview && !isOldIcon">'+'           <div class="ods-pictopicker__preview-icon" ng-click="scrollTo(\'ods-pictopicker__popup__icons-list__top\')">'+'               <img src="/static/pictos/img/set-v3/pictos/no_picto.svg" />'+'           </div>'+'           <span ods-pictopicker__popup__selected-icon__no-icon translate>No icon</span>'+'       </div>'+'       <div ng-if="showPreview">'+'           <div class="ods-pictopicker__preview-icon--preview" ng-click="scrollTo(picto.filename)">'+'               <img ng-src="/static/pictos/img/set-v3/pictos/{{pictoPreview}}.svg" />'+'           </div>'+'           <span>'+'               <div ng-bind="pictoPreviewName"></div>'+'           </span>'+'       </div>'+'       <div ng-if="showNoIconPreview">'+'           <div class="ods-pictopicker__preview-icon--preview" ng-click="scrollTo(picto.filename)">'+'               <img src="/static/pictos/img/set-v3/pictos/no_picto.svg" />'+'           </div>'+'           <span>'+'               <div translate>No icon</div>'+'           </span>'+'       </div>'+'   </div>'+'   <div class="ods-picker__actions">'+'       <button type="button" ng-click="close()" class="ods-button ods-button--link ods-pictopicker__popup__cancel-button" '+'               tabindex="0" aria-label="Close icon picker" translate="aria-label"><span translate>Cancel</span></button>'+'       <button class="ods-button ods-button--primary" ng-click="validate(picto)" tabindex="0" type="button">'+'           <i class="odsui-valid" aria-hidden="true"></i> <span translate>Select icon</span>'+'       </button>'+'   </div>'+'</div>';var popup;var clickAnywhereToClose=function(){closePicker();};var openPicker=function(event){scope.activeButton=$(event.target);var templatePopup=$compile(templatePopupHTML);pickerButton=$(event.target);popup=templatePopup(scope);$($window.document.body).append(popup);pickerHelper.positionPicker(pickerButton,popup);popup.on('click',function(e){e.stopPropagation();});event.stopPropagation();$($window.document).on('click',clickAnywhereToClose);if(angular.isUndefined(scope.currentPicto)){scope.selectedPicto='';}else if(scope.currentPicto.startsWith('ods-')){scope.selectedPicto=scope.currentPicto.replace('ods-','');}else{scope.isOldIcon=true;}
scope.selectedPictoName=scope.currentPictoName;$document.keydown(function(event){if(event.keyCode===27){closePicker();}});$('#ods-pictopicker__popup__icons-list').on('wheel',function(event){var iconList=$('#ods-pictopicker__popup__icons-list'),iconListTop=$('#ods-pictopicker__icon-list-top'),height=iconList.height()+iconListTop.height(),scrollHeight=iconList.get(0).scrollHeight;if((iconList.scrollTop()===(scrollHeight-height)&&event.originalEvent.deltaY>0)||(iconList.scrollTop()===0&&event.originalEvent.deltaY<0)){event.preventDefault();}});};var closePicker=function(){$($window.document).off('click',clickAnywhereToClose);$(document).off('keyup',keyUp);popup.remove();popup=null;scope.clearInput();scope.activeButton.focus();$(document).unbind('keydown');};scope.checkIconKey=function(event,picto){if(event.keyCode===13){scope.select(picto);}};scope.togglePicker=function(event){if(!popup){if(!scope.odsDisabled){openPicker(event);}}else{closePicker();}};scope.close=function(){closePicker();};function keyUp(event){if(event.which==27){closePicker();}else if(event.which==13){scope.validate();}}
element.on('click',function(e){e.stopPropagation();});scope.select=function(picto){scope.showPreview=false;scope.showNoIconPreview=false;scope.isOldIcon=false;if(picto!==""){scope.selectedPictoName=picto.name;scope.selectedPicto=picto.filename;}else{scope.selectedPicto='';}};scope.previewPicto=function(picto){scope.showPreview=true;scope.showNoIconPreview=false;scope.pictoPreview=picto.filename;scope.pictoPreviewName=picto.name;};scope.previewNoPicto=function(){scope.showNoIconPreview=true;scope.pictoPreview='no_picto.svg';scope.pictoPreviewName='';};scope.hidePreview=function(){scope.showPreview=false;scope.showNoIconPreview=false;};scope.validate=function(){if(!scope.isOldIcon){if(scope.selectedPicto===''){scope.currentPicto=scope.selectedPicto;}else{scope.currentPicto='ods-'+scope.selectedPicto;}
scope.currentPictoName=scope.selectedPictoName;ngModel.$setViewValue(scope.currentPicto);}
closePicker();};scope.clearInput=function(){scope.q="";scope.filteredCategories=pictos.categories;scope.scrollTo('ods-pictopicker__popup-icons_list-top');scope.filteredIconsCount=scope.iconsCount;$(".ods-pictopicker__popup__search__input").focus();};var getPictoName=function(picto){if(pictos!==null){angular.forEach(pictos.categories,function(category){angular.forEach(category.icons,function(icon){if('ods-'+icon.filename===picto){scope.currentPictoName=icon.name;}});});if(angular.isUndefined(scope.currentPictoName)){scope.currentPictoName=picto;}}};ngModel.$render=function(){if(ngModel.$viewValue){scope.currentPicto=ngModel.$viewValue.replace('-ods','');getPictoName(ngModel.$viewValue);}else if(!angular.isUndefined(scope.currentPictoUrl)&&scope.currentPictoUrl!==null){if(scope.currentPictoUrl.includes('set-v3')){scope.currentPicto='ods-'+scope.currentPictoUrl.split('/').pop().replace('.svg','');getPictoName(scope.currentPicto);}else if(scope.currentPictoUrl.includes('set-v2')){scope.isOldIcon=true;scope.currentPicto=scope.currentPictoUrl.split('/').pop().replace('.svg','');scope.currentPictoName=scope.currentPicto;}}else{scope.currentPicto=scope.defaultValue;scope.currentPictoName=scope.defaultValue;}
scope.ariaLabel=format_string(translate('Current icon is {iconName}. Open icon picker'),{iconName:scope.currentPictoName});};}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsRangeInput',['$timeout','translate','$compile',function($timeout,translate,$compile){return{restrict:'E',replace:true,scope:{ngModel:'=',min:'=',max:'=',step:'=',selectableMin:'=',minValuePosition:'=?',maxValuePosition:'=?',editableValue:'=',iconMin:'@',iconMax:'@',iconMinTitle:'@?',iconMaxTitle:'@?',ariaLabelText:'@'},require:'ngModel',link:function(scope,element,attrs,ngModelCtrl){var template='<div class="ods-range-input">'+'    <i class="ods-range-input__icon ods-range-input__icon--min" ng-if="iconMin" title="{{ iconMinTitle }}" ng-class="iconMin" aria-hidden="true"></i>'+'    <input type="range"'+'           min="{{ actualMin }}"'+'           max="{{ max }}"'+'           step="{{ step }}"'+'           class="ods-range-input__range-input"'+'           ng-change="onRangeChange()"'+'           ng-model-options="{ debounce: 0 }"'+'           ng-model="values.internalRange"'+'           aria-label="{{rangeLabel}}"'+'           title="{{ values.internalRange }}">'+'    <i class="ods-range-input__icon ods-range-input__icon--max" ng-if="iconMax" title="{{ iconMaxTitle }}" ng-class="iconMax" aria-hidden="true"></i>'+'    <input class="ods-range-input__value-input" '+'          ng-change="onValueChange()" '+'          ng-if="editableValue" '+'          type="number" '+'          ng-model="values.internalValue"'+'          ng-model-options="{ debounce: 0 }"'+'          ng-blur="onValueBlur()"'+'          min="{{ actualMin }}" '+'          max="{{ max }}" '+'          step="{{ step }}"'+'          aria-label="{{inputLabel}}">'+'</div>';var newElement=angular.element(template);element.replaceWith(newElement);$compile(newElement)(scope);var inputElement=element.find('.ods-range-input__input');scope.values={};if(angular.isDefined(scope.selectableMin)){scope.actualMin=scope.selectableMin;}else{scope.actualMin=scope.min;}
scope.rangeLabel=format_string(translate('{label} slider'),{label:scope.ariaLabelText});scope.inputLabel=format_string(translate('{label} input'),{label:scope.ariaLabelText});var isValueInvalid=function(){return isNaN(scope.values.internalValue)||scope.values.internalValue<scope.actualMin||scope.values.internalValue>scope.max;};scope.onRangeChange=function(){var num=scope.values.internalRange;scope.values.internalValue=num;ngModelCtrl.$setViewValue(num);};scope.onValueChange=function(){if(isValueInvalid()){return;}
scope.values.internalRange=scope.values.internalValue;ngModelCtrl.$setViewValue(scope.values.internalValue);};scope.onValueBlur=function(){if(isValueInvalid()){scope.onRangeChange();}};ngModelCtrl.$render=function(){scope.values.internalValue=ngModelCtrl.$modelValue;scope.values.internalRange=ngModelCtrl.$modelValue;};scope.$watch('selectableMin',function(newValue,oldValue){if(newValue!==oldValue){inputElement.css({width:((scope.max-newValue)/(scope.max-scope.min)*100)+'%'});scope.actualMin=newValue;if(newValue>=scope.ngModel){scope.ngModel=newValue;}}});scope.$watch('minValuePosition',function(newValue,oldValue){if(newValue!==oldValue){if(newValue>=scope.ngModel){scope.ngModel=newValue;}}});scope.$watch('maxValuePosition',function(newValue,oldValue){if(newValue!==oldValue){if(newValue<=scope.ngModel){scope.ngModel=newValue;}}});$timeout(function(){newElement.find('.ods-range-input__range-input').val(scope.values.internalRange);});}};}]);})();;(function(){"use strict";var mod=angular.module('ods.core');mod.directive('odsResourceDownloadConditions',['config','$window','$compile',function(config,$window,$compile){var overlayTemplate=''+'<div class="ods-resource-download-conditions__overlay">'+'   <div class="ods-resource-download-conditions__message">'+'       <span class="ods-resource-download-conditions__text" translate>Before downloading this resource, you need to read and accept the <a href="/conditions/" target="_blank">terms and conditions</a>.</span>'+'       <div class="ods-resource-download-conditions__buttons">'+'           <a href="#" class="js-button-accept ods-resource-download-conditions__button ods-button ods-button--primary" translate>I accept</a>'+'           <a href="#" class="js-button-refuse ods-resource-download-conditions__button ods-button" translate>I don\'t accept</a>'+'       </div>'+'   </div>'+'</div>';var storageKey=config.DOMAIN_ID+'@resourceDownloadConditions';var storeAcceptance=function(){localStorage.setItem(storageKey,true);};var isAcceptanceStored=function(){return!!localStorage.getItem(storageKey);};return{restrict:'A',scope:{},link:function(scope,element,attrs){if(element[0].tagName.toLowerCase()!=='a'){console.warn('ods-resource-download-conditions should be on a <a> tag');}
if(!config.RESOURCE_DOWNLOAD_CONDITIONS){return;}
if(isAcceptanceStored()){return;}
element.on('click',function(e){if(isAcceptanceStored()){return true;}
e.preventDefault();var overlay=$compile(overlayTemplate)(scope);angular.element($window.document.body).append(overlay);overlay.on('click',function(e){overlay.remove();});overlay.find('.ods-resource-download-conditions__message').on('click',function(e){e.stopPropagation();});overlay.find('.js-button-accept').on('click',function(e){storeAcceptance();angular.element(e.currentTarget).attr('href',element.attr('href'));overlay.remove();});overlay.find('.js-button-refuse').on('click',function(e){overlay.remove();return false;});});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsSearchInput',['$timeout',function($timeout){return{restrict:'E',replace:true,require:'ngModel',scope:{submit:'&',placeholder:'@',default:'=?',inputClasses:'@?',width:'@'},template:''+'<div class="ods-search-input">'+'    <div class="ods-search-input__input-area">'+'       <div class="ods-form__addon-wrapper ods-form__addon-wrapper--{{ width }}">'+'           <input type="text"'+'                   class="ods-search-input__input ods-form__control {{ inputClasses }}"'+'                   ng-model="model"'+'                   ng-keydown="$event.which === 13 && submit()"'+'                   placeholder="{{ placeholder || (\'Search...\'|translate)}}">'+'           <button class="ods-button ods-form__addon"'+'               type="button"'+'               ng-click="submit()">'+'               <i class="fa fa-search"></i>'+'           </button>'+'       </div>'+'       <button class="ods-search-input__reset"'+'               ng-show="model"'+'               ng-click="resetModel()">'+'           <i class="fa fa-times-circle" aria-hidden="true"></i>'+'       </button>'+'    </div>'+'</div>',link:function(scope,element,attrs,ngModelCtrl){if(angular.isDefined(attrs.autofocus)){element.find('.ods-search-input__input')[0].focus();}
if(!angular.isDefined(scope.submit)){scope.submit=function(){ngModelCtrl.$setViewValue(scope.model);};}
ngModelCtrl.$render=function(){scope.model=ngModelCtrl.$viewValue;};scope.$watch('model',function(nv){ngModelCtrl.$setViewValue(nv);});scope.resetModel=function(){if(angular.isDefined(scope.default)){scope.model=scope.default;}else{scope.model=null;}
$timeout(scope.submit);};}};}]);})();;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsSuggestions',function($timeout,$window){return{restrict:'E',transclude:true,template:''+'<div class="ods-suggestions" tabindex="-1">'+'    <input class="ods-suggestions__input" '+'           type="text" '+'           autocomplete="false" '+'           placeholder="{{ placeholder }}" '+'           ng-model="ngModel" '+'           ng-trim="false" '+'           ng-disabled="odsDisabled" '+'           ng-focus="autofocus" />'+'    <ul class="ods-suggestions__items"'+'        ng-class="{\'ods-suggestions__items--visible\': items.length > 1 || items[0].value !== ngModel}">'+'        <li ng-repeat="item in items" '+'            class="ods-suggestions__item"'+'            ng-class="{\'ods-suggestions__item--active\': $index == itemsIndex}" '+'            ng-click="setSuggestion()" '+'            ng-show="{{ filterItem(item) }}"'+'            inject>'+'            <span ng-bind-html="item._highlightResult.value.value"></span>'+'        </li>'+'    </ul>'+'</div>',replace:true,scope:{ngModel:'=',sourceCallback:'&',selectionCallback:'&',placeholder:'@',odsDisabled:'=?',autofocus:'=?',filter:'&'},link:function(scope,element,attrs){if(!angular.isDefined(scope.autofocus)){scope.autofocus=false;}
if(!angular.isUndefined(scope.filter())){scope.filterItem=scope.filter();}else{scope.filterItem=function(item){return true;};}
scope.items=[];scope.itemsIndex=-1;scope.hasFocus=false;var inputElement=element.find('.ods-suggestions__input');var itemsElement=element.find('.ods-suggestions__items');scope.safeApply=function(fn){var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest')
this.$eval(fn);else
this.$apply(fn);};inputElement.on('focus',function(){scope.hasFocus=true;scope.itemsIndex=-1;scope.getSuggestions();scope.$apply();});$($window.document.body).on('click.suggestions',function(e){if(!$(e.target).closest(element).length){scope.hasFocus=false;scope.$apply();}});$($window.document.body).on('click',function(e){if(!jQuery(e.target).hasClass('ods-suggestions')&&jQuery(e.target).parents('.ods-suggestions').length===0){scope.items=[];scope.$apply();}});element.on('mouseenter','.ods-suggestions__item',function(e){scope.itemsIndex=element.find('.ods-suggestions__item').index(this);scope.$apply();});inputElement.on('keydown',function(e){if(e.keyCode==38){scope.itemsIndex=Math.max(scope.itemsIndex-1,-1);scope.$apply();}
if(e.keyCode==40){scope.itemsIndex=Math.min(scope.itemsIndex+1,scope.items.length-1);scope.$apply();}
if((e.keyCode==38||e.keyCode==40)&&scope.itemsIndex>=0){var current_item=element.find('.ods-suggestions__item').eq(scope.itemsIndex);var offset=current_item.position().top;var step=current_item.height();if(offset<step){itemsElement.scrollTop(Math.max(itemsElement.scrollTop()-step,0));}else if(offset>itemsElement.height()-step){itemsElement.scrollTop(itemsElement.scrollTop()+step);}
e.preventDefault();}
if(e.keyCode==13){scope.setSuggestion();scope.$apply();}
if(e.keyCode==27){scope.items=[];scope.$apply();}});scope.setSuggestion=function(){if(scope.itemsIndex>=0){if(attrs.selectionCallback){scope.selectionCallback({value:scope.items[scope.itemsIndex]});scope.ngModel='';}else{scope.ngModel=scope.items[scope.itemsIndex];}
scope.items=[];}
inputElement.blur();};scope.getSuggestions=function(){if(scope.ngModel){scope.sourceCallback({q:scope.ngModel}).then(function(response){scope.items=response.data.hits;});}else{scope.items=[];}};scope.$watch('ngModel',function(nv,ov){if(nv!==ov){if(!scope.odsDisabled){scope.getSuggestions();scope.itemsIndex=-1;}}});}};});})();;(function(){'use strict';var mod=angular.module('ods.core');function parseUrl(url){var a=document.createElement('a');a.href=url;return a;}
mod.directive('odsTabs',function(){return{restrict:'E',transclude:true,scope:{syncToUrl:'@',syncToUrlMode:'@',syncToObject:'=',pathPrefix:'=?',name:'@',layout:'@?',collapsible:'=?',defaultCollapsed:'=?',defaultTab:'@'},template:''+'<div class="ods-tabs" ng-show="panes.length" role="tablist">'+'    <div class="ods-tabs__tabs">'+'        <a href=""'+'           ng-click="selectTab(pane, true)"'+'           ng-keypress="checkKey($event, pane)"'+'           ng-repeat="pane in panes"'+'           ng-class="{\'ods-tabs__tab--active\': pane.selected,'+'                      \'ods-tabs__tab--disabled\': pane.disabled,'+'                      \'ods-tabs__tab--horizontal\': !layout || layout == \'horizontal\','+'                      \'ods-tabs__tab--simple-nav\': layout == \'simple-nav\'}"'+'           class="ods-tabs__tab {{ pane.slug }} {{ pane.tabClass }}"'+'           ng-hide="pane.hidden"'+'           ods-tooltip="This feature is not available in your plan"'+'           translate="ods-tooltip"'+'           ods-tooltip-disabled="!pane.disabled"'+'           ods-tooltip-direction="bottom"'+'           role="tab">'+'            <i ng-show="pane.icon" class="fa fa-{{ pane.icon }}" aria-hidden="true"></i>'+'            {{ pane.title }}'+'            <i ng-show="pane.disabled" class="fa fa-lock ods-pane-lock__icon" aria-hidden="true"></i>'+'            <span ng-if="pane.count|isDefined">({{pane.count}})</span>'+'        </a>'+'    </div>'+'    <div ng-transclude></div>'+'</div>',replace:true,controller:['$scope','$location','$element',function($scope,$location,$element){var panes=$scope.panes=[];var selectedIndex;$scope.syncToUrlMode=$scope.syncToUrlMode==='path'?'path':'hash';$scope.pathPrefix=$scope.pathPrefix||'';$scope.linkingDone=false;$scope.collapsible=($scope.collapsible===true);$scope.defaultCollapsed=($scope.defaultCollapsed===true);$scope.checkKey=function(event,pane){if(event.keyCode===13){$scope.selectTab(pane,true);}};$scope.selectTab=function(pane,userSelection){if(!pane.selected&&!pane.disabled){angular.forEach(panes,function(p){p.selected=false;});pane.selected=true;if($scope.syncToUrl!=='false'){if(!userSelection){$location.replace();}
if($scope.syncToUrlMode==='hash'){$location.hash(pane.slug);}else{$location.path($scope.pathPrefix+pane.slug+'/');}}
if($scope.syncToObject){$scope.syncToObject.tab=pane.slug;}
selectedIndex=$.map(panes,function(p){return p.selected;}).indexOf(true);$scope.$emit('tabSelected',{'tabsName':$scope.name,'selection':pane.slug});}else if($scope.collapsible){angular.forEach(panes,function(p){p.selected=false;});}
$element.find('a.ods-tabs__tab.'+pane.slug).blur();};this.selectTab=$scope.selectTab;this.addPane=function(pane,index){if(angular.isUndefined(index)){panes.push(pane);}else{panes.splice(index,0,pane);}
if($scope.linkingDone&&typeof selectedIndex==="undefined"){$scope.selectTab(pane);}};$scope.$on('selectTab',function(e,name,slug){if(name===$scope.name){$scope.selectTab(panes.filter(function(p){return p.slug===slug;})[0],false);}});$scope.selectDefaultTab=function(){if(!($scope.collapsible&&$scope.defaultCollapsed)){var pane;if($scope.syncToUrl!=='false'){pane=extractPaneFromUrl($location.url());}
if((!pane||pane.disabled)&&$scope.defaultTab){angular.forEach($scope.panes,function(p){if(!pane&&$scope.defaultTab===p.slug){pane=p;}});}
if(!pane||pane.disabled){pane=$scope.panes[0];}
if(pane){$scope.selectTab(pane,false);}}};$scope.$watch(function(){return $.map(panes,function(p){return p.visible;});},function(nv,ov){if($scope.panes[selectedIndex]&&!$scope.panes[selectedIndex].visible){if(nv&&nv.indexOf(true)>=0){$scope.select($scope.panes[nv.indexOf(true)]);}}},true);this.getLayout=function(){return angular.isDefined($scope.layout)?$scope.layout:'horizontal';};var extractPaneFromUrl=function(url){var paneSlug,pane;if($scope.syncToUrlMode==='hash'){paneSlug=parseUrl(url).hash.replace("#","");}else{var urlParts=parseUrl(url).pathname.split('/');paneSlug=urlParts[urlParts.length-2];}
angular.forEach($scope.panes,function(p){if(!pane&&paneSlug===p.slug){pane=p;}});return pane;};if($scope.syncToUrl!=='false'){$scope.$on('$locationChangeSuccess',function(e,newUrl,oldUrl){var newPane=extractPaneFromUrl(newUrl);if(newPane&&newPane.slug!==$scope.panes[selectedIndex].slug){$scope.selectTab(newPane,false);}});}}],link:function(scope){scope.selectDefaultTab();scope.linkingDone=true;}};});mod.directive('odsPane',['translate','$filter',function(translate,$filter){return{require:'^odsTabs',restrict:'E',transclude:true,template:''+'<div class="ods-tabs__pane" role="tabpanel"'+'     ng-class="{\'ods-tabs__pane--active\':struct.selected,'+'                \'ods-tabs__pane--disabled\':struct.disabled,'+'                \'ods-tabs__pane--horizontal\': !layout || layout == \'horizontal\','+'                \'ods-tabs__pane--simple-nav\': layout == \'simple-nav\'}">'+'    <div ng-if="shown || !struct.autoUnload" title="" ng-transclude>'+'    </div>'+'</div>',replace:true,scope:true,link:function(scope,element,attrs,tabsCtrl){if(scope.$eval(attrs.doNotRegister)===true){scope.shown=false;scope.struct={autoUnload:true,hidden:true};return;}
scope.layout=tabsCtrl.getLayout();scope.struct={title:translate(attrs.title),slug:attrs.slug||$filter('slugify')(attrs.title),icon:attrs.icon,hidden:(('ngShow'in attrs&&!scope.$eval(attrs.ngShow))||('ngHide'in attrs&&scope.$eval(attrs.ngHide))),tabClass:attrs.tabClass,autoUnload:attrs.paneAutoUnload=='true',disabled:('ngDisabled'in attrs&&scope.$eval(attrs.ngDisabled)),};var position;var parent=element[0].parentNode;for(var i=0;i<parent.children.length;i++){if(parent.children[i]===element[0]){position=i;break;}}
tabsCtrl.addPane(scope.struct,position);scope.$watch(function(){return(('ngShow'in attrs&&!scope.$eval(attrs.ngShow))||('ngHide'in attrs&&scope.$eval(attrs.ngHide)));},function(nv,ov){scope.struct.hidden=nv;});scope.$watch(attrs.count,function(nv){if(angular.isDefined(nv)){scope.struct.count=nv;}},true);scope.$watch(function(){return attrs.icon;},function(nv){if(angular.isDefined(nv)){scope.struct.icon=nv;}},true);scope.$watch(function(){return(('ngDisabled'in attrs&&scope.$eval(attrs.ngDisabled)));},function(nv,ov){scope.struct.disabled=nv;});scope.$watch(function(){return attrs.tabClass;},function(nv){if(angular.isDefined(nv)){scope.struct.tabClass=nv;}},true);scope.$watch('struct.selected',function(nv){if(nv){scope.$applyAsync(function(){scope.shown=true;});}else{scope.shown=false;}});}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsTooltip',['$compile','$window','gettextCatalog','$interpolate','$sce',function($compile,$window,gettextCatalog,$interpolate,$sce){var tooltip=$('<div class="ods-tooltip"></div>').hide();$(document.body).append(tooltip);return{require:'odsTooltip',restrict:'A',controller:function($scope,$element,$attrs){var ctrl=this;$scope.$watch(function(){return[$attrs.odsTooltip,$attrs.translatePlural]},function(nv){ctrl.rawTextTooltip=$attrs.odsTooltip;ctrl.rawTextTooltipPlural=$attrs.translatePlural;},true);},link:function(scope,element,attrs,ctrl){var timeout,tooltipText;function showTooltip(content,position,e){if(content===''){return;}
tooltip[0].innerHTML='';tooltip.append($sce.getTrustedHtml(content));scope.$apply();if(['left','right','top','bottom'].indexOf(position)<0){if(e.clientX<$($window).width()/2){position='right';}else{position='left';}}
angular.forEach(['left','right','top','bottom'],function(direction){tooltip.removeClass('ods-tooltip--'+direction);});switch(position){case'left':tooltip.addClass('ods-tooltip--left');tooltip.css({left:'',right:$($window).width()-element.offset().left,top:element.offset().top,bottom:''});break;case'right':tooltip.addClass('ods-tooltip--right');tooltip.css({left:element.offset().left+element.outerWidth(),right:'',top:element.offset().top,bottom:''});break;case'top':tooltip.addClass('ods-tooltip--top');tooltip.css({left:element.offset().left+element.outerWidth()/2,right:'',top:'',bottom:$($window).height()-element.offset().top});break;case'bottom':tooltip.addClass('ods-tooltip--bottom');tooltip.css({left:element.offset().left+element.outerWidth()/2,right:'',top:element.offset().top+element.outerHeight(),bottom:''});break;}
tooltip.show();scope.$watch(attrs.odsTooltipDisabled,function(newValue,oldValue){if(!!newValue){tooltip.hide();}});}
var buildAndShowTooltip=function(e){if(attrs.translate&&attrs.translate==="ods-tooltip"){if(angular.isDefined(attrs.translateN)){tooltipText=gettextCatalog.getPlural(scope.$eval(attrs.translateN),ctrl.rawTextTooltip,ctrl.rawTextTooltipPlural,scope,attrs.translateContext||null);}else{tooltipText=gettextCatalog.getString(ctrl.rawTextTooltip,scope,attrs.translateContext||null);}}else{tooltipText=$interpolate(ctrl.rawTextTooltip)(scope);}
if(!tooltipText){return;}
if(!scope.$eval(attrs.odsTooltipDisabled)){var delay=attrs.hasOwnProperty('odsTooltipDelay')?attrs.odsTooltipDelay:200;if(angular.isDefined(delay)&&delay!==''){timeout=setTimeout(function(){if(attrs.hasOwnProperty('odsTooltipTemplate')&&scope.$eval(attrs.odsTooltipTemplate)){showTooltip(scope.$eval(attrs.odsTooltipTemplate),attrs.odsTooltipDirection,e);}else{showTooltip(tooltipText,attrs.odsTooltipDirection,e);}},attrs.hasOwnProperty('odsTooltipDelay')?attrs.odsTooltipDelay:200);}}};element.on('mouseenter',buildAndShowTooltip);scope.$on('refresh-tooltip',buildAndShowTooltip);element.on('mouseleave',function(e){if(timeout){clearTimeout(timeout);}
tooltip.hide();tooltip[0].innerHTML='';});element.on('focusout',function(){tooltip.hide();});element.on('$destroy',function(){tooltip.hide();});}};}]);mod.directive('odsDisabledTooltip',['$compile','gettextCatalog',function($compile,gettextCatalog){return{controller:function($scope,$element,$attrs){$scope.rawTextDisabledTooltip=$attrs.odsDisabledTooltipText;$scope.rawTextTooltipPlural=$attrs.translatePlural;},link:function(scope,element,attrs){var classes='';if(attrs.odsDisabledTooltipWrapperClass){classes=' '+ODS.StringUtils.escapeHTML(attrs.odsDisabledTooltipWrapperClass);}
element.wrap('<span class="ods-disabled-tooltip'+classes+'" style="display: '+element.css('display')+';"></span>');var tooltipScope=scope.$new(false);if(angular.isUndefined(attrs.odsDisabledTooltipDelay)){tooltipScope.delay=200;}else{tooltipScope.delay=parseInt(attrs.odsDisabledTooltipDelay,10);}
if(attrs.translate&&attrs.translate==="ods-disabled-tooltip-text"){if(angular.isDefined(attrs.translateN)){tooltipScope.text=gettextCatalog.getPlural(scope.$eval(attrs.translateN),scope.rawTextDisabledTooltip,scope.rawTextTooltipPlural,scope,attrs.translateContext||null);}else{tooltipScope.text=gettextCatalog.getString(scope.rawTextDisabledTooltip,scope,attrs.translateContext||null);}}else{tooltipScope.text=scope.rawTextDisabledTooltip;}
tooltipScope.template=scope.$eval(attrs.odsDisabledTooltipTemplate);tooltipScope.direction=attrs.odsDisabledTooltipDirection;scope.$watch(attrs.odsDisabledTooltip,function(nv,ov){tooltipScope.disabledTooltip=nv;element.prop("disabled",nv);});if(scope.rawTextTooltipPlural){element.parent().append($compile('<div ng-show="disabledTooltip" class="ods-disabled-tooltip__overlay" ods-tooltip="{{text}}" translate="ods-tooltip" translate-plural="'+ODS.StringUtils.escapeHTML(scope.rawTextTooltipPlural)+'" translate-n="'+ODS.StringUtils.escapeHTML(attrs.translateN)+'" ods-tooltip-template="template" ods-tooltip-direction="direction" ods-tooltip-delay="{{delay}}"></div>')(tooltipScope));}else{element.parent().append($compile('<div ng-show="disabledTooltip" class="ods-disabled-tooltip__overlay" ods-tooltip="{{text}}" translate="ods-tooltip" ods-tooltip-template="template" ods-tooltip-direction="{{ direction }}" ods-tooltip-delay="{{delay}}"></div>')(tooltipScope));}}};}]);}());;(function(){'use strict';var mod=angular.module('ods.core');mod.directive('odsValueOverModel',function(){return{restrict:'A',require:'ngModel',link:function(scope,element,attrs,ngModel){ngModel.$setViewValue(attrs.value);ngModel.$setPristine();}};});}());;